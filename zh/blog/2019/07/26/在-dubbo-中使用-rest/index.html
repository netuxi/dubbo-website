<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.78.2"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>在 Dubbo 中使用 REST | Apache Dubbo</title><meta property="og:title" content="在 Dubbo 中使用 REST"><meta property="og:description" content="本文介绍了如何在 Dubbo 中发布 RESTful 服务"><meta property="og:type" content="article"><meta property="og:url" content="/zh/blog/2019/07/26/%E5%9C%A8-dubbo-%E4%B8%AD%E4%BD%BF%E7%94%A8-rest/"><meta property="article:published_time" content="2019-07-26T00:00:00+00:00"><meta property="article:modified_time" content="2020-11-19T11:04:44+08:00"><meta property="og:site_name" content="Apache Dubbo"><meta itemprop=name content="在 Dubbo 中使用 REST"><meta itemprop=description content="本文介绍了如何在 Dubbo 中发布 RESTful 服务"><meta itemprop=datePublished content="2019-07-26T00:00:00+00:00"><meta itemprop=dateModified content="2020-11-19T11:04:44+08:00"><meta itemprop=wordCount content="1843"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="在 Dubbo 中使用 REST"><meta name=twitter:description content="本文介绍了如何在 Dubbo 中发布 RESTful 服务"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-112489517-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preload href=/scss/main.min.8b180b4f9c3e92478ac4794f7583d0b2a7c043e9717486d0407c2dfdf725043f.css as=style><link href=/scss/main.min.8b180b4f9c3e92478ac4794f7583d0b2a7c043e9717486d0407c2dfdf725043f.css rel=stylesheet integrity><script src=/js/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 321.39 78.54"><title id="title19">DUBBO LOGO</title><path class="cls-1" d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25H68.46zm21.24-28h8.6V31H89.7zm0 22.25h8.6v8.6H89.7zM33.24 7.25H4.06v64H33.24c10.95.0 19.3-7.18 23.29-17.15a45.12 45.12.0 002.38-14.87A45.12 45.12.0 0056.53 24.4C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63H30.34a3.44 3.44.0 00-3.44 3.44V53.23a3.44 3.44.0 003.44 3.44h3.33v4.63h-8.3a6.87 6.87.0 01-6.87-6.87V24.12a6.87 6.87.0 016.87-6.87h8.3zM285.51 6.06c-17.05.0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21S302.56 6.06 285.51 6.06zm7.59 48.36a6.87 6.87.0 01-6.87 6.87h-8.3V56.67h3.33a3.44 3.44.0 003.44-3.44V25.31a3.44 3.44.0 00-3.44-3.44h-3.33V17.25h8.3a6.87 6.87.0 016.87 6.87zm-53.4-17.56A17.39 17.39.0 00227.31 7.25H195.1v64h32.21a19.44 19.44.0 0012.38-34.44zM211.63 61.29h-6.08l18.68-44h6.08zM177 36.85A17.39 17.39.0 00164.65 7.25H132.43v64h32.21A19.44 19.44.0 00177 36.85zM149 61.29h-6.08l18.68-44h6.08z" style="fill:#fff;fill-opacity:1"/></svg></span><span class="text-uppercase font-weight-bold">Apache Dubbo</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/docs/><span>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/blog/><span class=active>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/community/><span>社区</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 站内搜索…" aria-label=站内搜索… autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/blog/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">博客</a></li><ul><li class="collapse show" id=zhblog><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/blog/news/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">技术分享</a></li><ul><li class="collapse show" id=zhblognews><a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20200511e4bb8e-2019-e588b0-2020apache-dubbo-e5b9b4e5baa6e59b9ee9a1bee4b88ee680bbe7bb93 href=/zh/blog/2020/05/11/%E4%BB%8E-2019-%E5%88%B0-2020apache-dubbo-%E5%B9%B4%E5%BA%A6%E5%9B%9E%E9%A1%BE%E4%B8%8E%E6%80%BB%E7%BB%93/>从 2019 到 2020，Apache Dubbo 年度回顾与总结</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191202dubboe6b58be8af95e9aa8ce8af81 href=/zh/blog/2019/12/02/dubbo%E6%B5%8B%E8%AF%95%E9%AA%8C%E8%AF%81/>Dubbo测试验证</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191130dubbo-e59ca8-service-mesh-e4b88be79a84e6809de88083e5928ce696b9e6a188 href=/zh/blog/2019/11/30/dubbo-%E5%9C%A8-service-mesh-%E4%B8%8B%E7%9A%84%E6%80%9D%E8%80%83%E5%92%8C%E6%96%B9%E6%A1%88/>Dubbo 在 Service Mesh 下的思考和方案</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191102dubboe69c8de58aa1e7abafe5bc82e6ada5e68ea5e58fa3e79a84e5ae9ee78eb0e8838ce699afe5928ce5ae9ee8b7b5 href=/zh/blog/2019/11/02/dubbo%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%82%E6%AD%A5%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%83%8C%E6%99%AF%E5%92%8C%E5%AE%9E%E8%B7%B5/>Dubbo服务端异步接口的实现背景和实践</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191101dubboe5aea2e688b7e7abafe5bc82e6ada5e68ea5e58fa3e79a84e5ae9ee78eb0e8838ce699afe5928ce5ae9ee8b7b5 href=/zh/blog/2019/11/01/dubbo%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%BC%82%E6%AD%A5%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%83%8C%E6%99%AF%E5%92%8C%E5%AE%9E%E8%B7%B5/>Dubbo客户端异步接口的实现背景和实践</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191028dubbo-e59ca8e8b7a8e8afade8a880e5928ce58d8fe8aeaee7a9bfe9808fe680a7e696b9e59091e4b88ae79a84e68ea2e7b4a2e694afe68c81-http2-grpc-e5928c-protobuf href=/zh/blog/2019/10/28/dubbo-%E5%9C%A8%E8%B7%A8%E8%AF%AD%E8%A8%80%E5%92%8C%E5%8D%8F%E8%AE%AE%E7%A9%BF%E9%80%8F%E6%80%A7%E6%96%B9%E5%90%91%E4%B8%8A%E7%9A%84%E6%8E%A2%E7%B4%A2%E6%94%AF%E6%8C%81-http/2-grpc-%E5%92%8C-protobuf/>支持 HTTP/2 gRPC 和 Protobuf</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191022e69cace59cb0e5ad98e6a0b9e5928ce69cace59cb0e4bcaae8a385 href=/zh/blog/2019/10/22/%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9%E5%92%8C%E6%9C%AC%E5%9C%B0%E4%BC%AA%E8%A3%85/>本地存根和本地伪装</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191017dubbo-e4b8ade79a84-url-e7bb9fe4b880e6a8a1e59e8b href=/zh/blog/2019/10/17/dubbo-%E4%B8%AD%E7%9A%84-url-%E7%BB%9F%E4%B8%80%E6%A8%A1%E5%9E%8B/>Dubbo 中的 URL 统一模型</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20191001e7a094e7a9b6-dubbo-e7bd91e58da1e59cb0e59d80e6b3a8e5868ce697b6e79a84e4b880e782b9e6809de88083 href=/zh/blog/2019/10/01/%E7%A0%94%E7%A9%B6-dubbo-%E7%BD%91%E5%8D%A1%E5%9C%B0%E5%9D%80%E6%B3%A8%E5%86%8C%E6%97%B6%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/>研究 Dubbo 网卡地址注册时的一点思考</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190826service-test href=/zh/blog/2019/08/26/service-test/>Dubbo Admin服务测试功能</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190811e4bdbfe794a8apache-skywalking-incubator-e5819ae58886e5b883e5bc8fe8b79fe8b8aa href=/zh/blog/2019/08/11/%E4%BD%BF%E7%94%A8apache-skywalking-incubator-%E5%81%9A%E5%88%86%E5%B8%83%E5%BC%8F%E8%B7%9F%E8%B8%AA/>使用Apache Skywalking (Incubator) 做分布式跟踪</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190811e69cace59cb0e8b083e794a8 href=/zh/blog/2019/08/11/%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8/>本地调用</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-zhblog20190726e59ca8-dubbo-e4b8ade4bdbfe794a8-rest href=/zh/blog/2019/07/26/%E5%9C%A8-dubbo-%E4%B8%AD%E4%BD%BF%E7%94%A8-rest/>在 Dubbo 中使用 REST</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190622e4bdbfe794a8-dubbo-e8bf9ee68ea5e5bc82e69e84e5beaee69c8de58aa1e4bd93e7b3bb href=/zh/blog/2019/06/22/%E4%BD%BF%E7%94%A8-dubbo-%E8%BF%9E%E6%8E%A5%E5%BC%82%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BD%93%E7%B3%BB/>使用 Dubbo 连接异构微服务体系</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190502dubboe58fafe689a9e5b195e69cbae588b6e6ba90e7a081e8a7a3e69e90 href=/zh/blog/2019/05/02/dubbo%E5%8F%AF%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/>Dubbo可扩展机制源码解析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190501dubbo-e4b880e887b4e680a7hashe8b49fe8bdbde59d87e8a1a1e5ae9ee78eb0e58996e69e90 href=/zh/blog/2019/05/01/dubbo-%E4%B8%80%E8%87%B4%E6%80%A7hash%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E5%89%96%E6%9E%90/>Dubbo 一致性Hash负载均衡实现剖析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190425dubboe58fafe689a9e5b195e69cbae588b6e5ae9ee68898 href=/zh/blog/2019/04/25/dubbo%E5%8F%AF%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6%E5%AE%9E%E6%88%98/>Dubbo可扩展机制实战</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190203e68f90e5898dife588a4e696ade5b8aee58aa9cpue58886e694afe9a284e6b58b href=/zh/blog/2019/02/03/%E6%8F%90%E5%89%8Dif%E5%88%A4%E6%96%AD%E5%B8%AE%E5%8A%A9cpu%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B/>提前if判断帮助CPU分支预测</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190202e5bd93dubboe98187e4b88aarthase68e92e69fa5e997aee9a298e79a84e5ae9ee8b7b5 href=/zh/blog/2019/02/02/%E5%BD%93dubbo%E9%81%87%E4%B8%8Aarthas%E6%8E%92%E6%9F%A5%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9E%E8%B7%B5/>当Dubbo遇上Arthas：排查问题的实践</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190126e98187e8a781dubbo href=/zh/blog/2019/01/26/%E9%81%87%E8%A7%81dubbo/>遇见Dubbo</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190117e5a682e4bd95e4bdbfe794a8fescare4bf9de8af81dubboe5beaee69c8de58aa1e997b4e79a84e4b880e887b4e680a7 href=/zh/blog/2019/01/17/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8fescar%E4%BF%9D%E8%AF%81dubbo%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%97%B4%E7%9A%84%E4%B8%80%E8%87%B4%E6%80%A7/>如何使用Fescar保证Dubbo微服务间的一致性</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190107e696b0e78988-dubbo-admin-e4bb8be7bb8d href=/zh/blog/2019/01/07/%E6%96%B0%E7%89%88-dubbo-admin-%E4%BB%8B%E7%BB%8D/>新版 Dubbo Admin 介绍</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190107e6b585e8b088-rpc href=/zh/blog/2019/01/07/%E6%B5%85%E8%B0%88-rpc/>浅谈 RPC</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20190105dubbo-e59ca8e7939ce5ad90e4ba8ce6898be8bda6e79a84e5ae9ee8b7b5 href=/zh/blog/2019/01/05/dubbo-%E5%9C%A8%E7%93%9C%E5%AD%90%E4%BA%8C%E6%89%8B%E8%BD%A6%E7%9A%84%E5%AE%9E%E8%B7%B5/>Dubbo 在瓜子二手车的实践</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20181210e7acace4ba94e5b18adubboe5bc80e58f91e88085e6b299e9be99e59ca8e69dade5b79ee68890e58a9fe4b8bee58a9e href=/zh/blog/2018/12/10/%E7%AC%AC%E4%BA%94%E5%B1%8Adubbo%E5%BC%80%E5%8F%91%E8%80%85%E6%B2%99%E9%BE%99%E5%9C%A8%E6%9D%AD%E5%B7%9E%E6%88%90%E5%8A%9F%E4%B8%BE%E5%8A%9E/>第五届Dubbo开发者沙龙在杭州成功举办</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20181107dubbo-e89e8de59088-nacos-e68890e4b8bae6b3a8e5868ce4b8ade5bf83 href=/zh/blog/2018/11/07/dubbo-%E8%9E%8D%E5%90%88-nacos-%E6%88%90%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/>Dubbo 融合 Nacos 成为注册中心</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20181027dubboe69c8de58aa1e58886e7bb84e5928ce78988e69cace8819ae59088 href=/zh/blog/2018/10/27/dubbo%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BB%84%E5%92%8C%E7%89%88%E6%9C%AC%E8%81%9A%E5%90%88/>Dubbo服务分组和版本聚合</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20181005dubbo-e58d8fe8aeaee8afa6e8a7a3 href=/zh/blog/2018/10/05/dubbo-%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3/>Dubbo 协议详解</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180930dubboe4b88ekubernetese99b86e68890 href=/zh/blog/2018/09/30/dubbo%E4%B8%8Ekubernetes%E9%9B%86%E6%88%90/>Dubbo与Kubernetes集成</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180920dubbo-mesh-service-meshe79a84e5ae9ee8b7b5e4b88ee68ea2e7b4a2 href=/zh/blog/2018/09/20/dubbo-mesh-service-mesh%E7%9A%84%E5%AE%9E%E8%B7%B5%E4%B8%8E%E6%8E%A2%E7%B4%A2/>Dubbo Mesh ｜ Service Mesh的实践与探索</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180902e5a682e4bd95e58786e5a487apache-release href=/zh/blog/2018/09/02/%E5%A6%82%E4%BD%95%E5%87%86%E5%A4%87apache-release/>如何准备Apache Release</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180902e5a682e4bd95e59fbae4ba8edubboe5ae9ee78eb0e585a8e5bc82e6ada5e8b083e794a8e993be href=/zh/blog/2018/09/02/%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8Edubbo%E5%AE%9E%E7%8E%B0%E5%85%A8%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8%E9%93%BE/>如何基于Dubbo实现全异步调用链</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180826e7acace59b9be5b18adubboe5bc80e58f91e88085e6b299e9be99e4ba8e8e69c8826e697a5e59ca8e68890e983bde4b8bee8a18c href=/zh/blog/2018/08/26/%E7%AC%AC%E5%9B%9B%E5%B1%8Adubbo%E5%BC%80%E5%8F%91%E8%80%85%E6%B2%99%E9%BE%99%E4%BA%8E8%E6%9C%8826%E6%97%A5%E5%9C%A8%E6%88%90%E9%83%BD%E4%B8%BE%E8%A1%8C/>第四届Dubbo开发者沙龙于8月26日在成都举行</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180822dubbo-e99b86e7bea4e5aeb9e99499 href=/zh/blog/2018/08/22/dubbo-%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99/>Dubbo 集群容错</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180822springe5ba94e794a8e5bfabe9809fe99b86e68890dubbo-hystrix href=/zh/blog/2018/08/22/spring%E5%BA%94%E7%94%A8%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90dubbo-hystrix/>Spring应用快速集成Dubbo + Hystrix</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180819dubbo-e78eb0e69c89e5bf83e8b7b3e696b9e6a188e680bbe7bb93e4bba5e58f8ae694b9e8bf9be5bbbae8aeae href=/zh/blog/2018/08/19/dubbo-%E7%8E%B0%E6%9C%89%E5%BF%83%E8%B7%B3%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93%E4%BB%A5%E5%8F%8A%E6%94%B9%E8%BF%9B%E5%BB%BA%E8%AE%AE/>Dubbo 现有心跳方案总结以及改进建议</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180815dubbo27-e4b889e5a4a7e696b0e789b9e680a7e8afa6e8a7a3 href=/zh/blog/2018/08/15/dubbo2.7-%E4%B8%89%E5%A4%A7%E6%96%B0%E7%89%B9%E6%80%A7%E8%AF%A6%E8%A7%A3/>Dubbo2.7 三大新特性详解</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814dubbo-e4bc98e99b85e5819ce69cba href=/zh/blog/2018/08/14/dubbo-%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA/>Dubbo 优雅停机</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814dubbo-e585b3e4ba8ee5908ce6ada5e5bc82e6ada5e8b083e794a8e79a84e587a0e7a78de696b9e5bc8f href=/zh/blog/2018/08/14/dubbo-%E5%85%B3%E4%BA%8E%E5%90%8C%E6%AD%A5/%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/>Dubbo 关于同步/异步调用的几种方式</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814dubbo-e59fbae69cace794a8e6b395-dubbo-consumer-e9858de7bdae href=/zh/blog/2018/08/14/dubbo-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95-dubbo-consumer-%E9%85%8D%E7%BD%AE/>Dubbo 基本用法 - Dubbo Consumer 配置</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814dubbo-e59fbae7a180e794a8e6b395-provider-e9858de7bdae href=/zh/blog/2018/08/14/dubbo-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95-provider-%E9%85%8D%E7%BD%AE/>Dubbo 基础用法 - Provider 配置</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814dubboe79a84e6b39be58c96e8b083e794a8 href=/zh/blog/2018/08/14/dubbo%E7%9A%84%E6%B3%9B%E5%8C%96%E8%B0%83%E7%94%A8/>Dubbo的泛化调用</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814spring-boot-dubboe5ba94e794a8e590afe5819ce6ba90e7a081e58886e69e90 href=/zh/blog/2018/08/14/spring-boot-dubbo%E5%BA%94%E7%94%A8%E5%90%AF%E5%81%9C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/>Spring Boot Dubbo应用启停源码分析</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814e4bb8ee8b7a8e8afade8a880e8b083e794a8e588b0dubbo2js href=/zh/blog/2018/08/14/%E4%BB%8E%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B0%83%E7%94%A8%E5%88%B0dubbo2.js/>从跨语言调用到dubbo2.js</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180814e9809ae8bf87qose5afb9e69c8de58aa1e8bf9be8a18ce58aa8e68081e68ea7e588b6 href=/zh/blog/2018/08/14/%E9%80%9A%E8%BF%87qos%E5%AF%B9%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8C%E5%8A%A8%E6%80%81%E6%8E%A7%E5%88%B6/>通过QoS对服务进行动态控制</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180810dubboe79a84e8b49fe8bdbde59d87e8a1a1 href=/zh/blog/2018/08/10/dubbo%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/>Dubbo的负载均衡</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180807dubbo-e6b3a8e8a7a3e9a9b1e58aa8 href=/zh/blog/2018/08/07/dubbo-%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8/>Dubbo 注解驱动</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180807e59ca8-dubbo-e4b8ade4bdbfe794a8e6b3a8e8a7a3 href=/zh/blog/2018/08/07/%E5%9C%A8-dubbo-%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3/>在 Dubbo 中使用注解</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180807e59ca8-dubbo-e5ba94e794a8e4b8ade4bdbfe794a8-zookeeper href=/zh/blog/2018/08/07/%E5%9C%A8-dubbo-%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8-zookeeper/>在 Dubbo 应用中使用 Zookeeper</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20180807dubbo-101 href=/zh/blog/2018/08/07/dubbo-101/>第一个 Dubbo 应用</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/blog/releases/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">版本发布</a></li><ul><li class=collapse id=zhblogreleases><a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20200518275-e58a9fe883bde8a7a3e69e90 href=/zh/blog/2020/05/18/2.7.5-%E5%8A%9F%E8%83%BD%E8%A7%A3%E6%9E%90/>2.7.5</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhblog20200518e8bf87e5be80e78988e69cac href=/zh/blog/2020/05/18/%E8%BF%87%E5%BE%80%E7%89%88%E6%9C%AC/>过往版本</a></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/apache/dubbo-website/edit/master/content/zh/blog/news/dubbo-rest.md target=_blank><i class="fa fa-edit fa-fw"></i>编辑此页</a>
<a href="https://github.com/apache/dubbo-website/new/master/content/zh/blog/news/dubbo-rest.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i>添加子页面</a>
<a href="https://github.com/apache/dubbo-website/issues/new?title=%e5%9c%a8%20Dubbo%20%e4%b8%ad%e4%bd%bf%e7%94%a8%20REST" target=_blank><i class="fab fa-github fa-fw"></i>提交文档问题</a>
<a href=https://github.com/apache/dubbo/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i>提交项目问题</a></div><nav id=TableOfContents><ul><li><a href=#什么是-rest>什么是 REST</a></li><li><a href=#在-dubbo-中使用-rest>在 Dubbo 中使用 REST</a><ul><li><a href=#背景>背景</a></li><li><a href=#基本用法>基本用法</a></li><li><a href=#进阶>进阶</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class="btn btn-lg -bg-orange td-rss-button d-none d-lg-block" href=/zh/blog/news/index.xml target=_blank>RSS <i class="fa fa-rss ml-2"></i></a><div class=td-content><h1>在 Dubbo 中使用 REST</h1><div class=lead>本文介绍了如何在 Dubbo 中发布 RESTful 服务</div><div class="td-byline mb-4"><time datetime=2019-07-26 class=text-muted>Friday, July 26, 2019</time></div><h2 id=什么是-rest>什么是 REST</h2><p>REST 是 Roy Thomas Fielding <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> 在 2000 年他的博士论文 <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> “架构风格以及基于网络的软件架构设计” 中提出来的一个概念。REST 是 <strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer 的缩写，翻译过来就是 “表现层状态转化”。REST 就是 Roy 在这篇论文中提出的面向互联网的软件所应当具备的架构风格。</p><p>按照 REpresentational State Transfer 的字面意思，可以把应用看成是一个虚拟的状态机，软件提供的不是服务而是一系列的<strong>资源</strong>，对这些资源的访问通过<strong>统一的操作</strong>来访问，而返回的结果代表了资源状态的一次跃迁。REST 是一种架构风格，如果一个软件架构符合 REST 风格，就可以称之为 RESTful 架构。这个架构应当具备以下一些设计上的约束：资源具有唯一标示、资源之间有关联关系、使用标准的方式来访问、资源有多种表现形式、无状态交互。</p><p>举例来说，一个简单的静态 HTML 页面的网站就很好的符合了 RESTful 架构风格。访问 <a href=http://acme.com/accounts>http://acme.com/accounts</a> 返回一个包含所有账号的页面，选取其中一个链接 <a href=http://acme.com/accounts/1>http://acme.com/accounts/1</a> 又会返回包含用户 1 的详细信息。爬虫软件在这种场景下工作的很好，当知道了某个网站的首页地址后，可以自举发现这个网站上所有关联的网页。更重要的是，这种访问形式不依赖网站提供的任何客户端，而是仅仅通过 HTTP 标准的访问方式完成的。可以说，HTML 这种超媒体文档的组织形式就是资源的表现层状态迁移的一种形式。</p><p>对于一个提供服务的动态网站来说，可以按照类似的思路将其 RESTful 化：</p><ul><li><p>GET <a href=http://acme.com/accounts>http://acme.com/accounts</a> 返回所有账号信息</p></li><li><p>POST <a href=http://acme.com/accounts>http://acme.com/accounts</a> 创建一个新的账号</p></li><li><p>GET <a href=http://acme.com/accounts/1>http://acme.com/accounts/1</a> 返回账号 1 的信息</p></li><li><p>DELETE <a href=http://acme.com/accounts/1>http://acme.com/accounts/1</a> 删除账号 1</p></li><li><p>PUT <a href=http://acme.com/accounts/1>http://acme.com/accounts/1</a> 更新账号 1 信息</p></li></ul><p>其中的思路是利用 HTTP 协议的标准方法 POST、DELETE、PUT、GET 来表达对于一个资源的增删改查 (CRUD) 操作，利用 URL 来表示一个资源的唯一标识。对资源访问的错误码也复用 HTTP 协议的状态码。返回结果通常由 json 或 XML 来表示，如果其中包换了对关联资源的访问方式 (所谓的表现层状态迁移) ，这种类型的 RESTful 应用可以进一步的称之为 <em>hypermedia as the engine of application state</em> (HATEOAS) 应用 <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>。</p><p><img src=/imgs/blog/rest-sample.png alt=micro-image></p><p><em>source: <a href=https://www.nginx.com/wp-content/uploads/2016/04/micro-image.png>https://www.nginx.com/wp-content/uploads/2016/04/micro-image.png</a></em></p><p>这里需要注意的是，按照 Roy 的定义，RESTful 架构风格与 HTTP 协议并没有什么强关联关系。但是，基于 HTTP 的 RESTful 架构风格是实现起来最自然，也是目前使用最广泛的一种实现，我们称之为 RESTful HTTP。同样的，在下文中将会专注在 HTTP 的场景下介绍如何在 Dubbo 框架中将服务暴露成 Restful 架构。</p><h2 id=在-dubbo-中使用-rest>在 Dubbo 中使用 REST</h2><h3 id=背景>背景</h3><p>随着微服务的流行以及多语言互操作诉求日益增多，在 Dubbo 中暴露 REST 服务变成了一个不容忽视的诉求。为了在 Dubbo 中暴露 REST 服务，通常有两种做法，一种是直接依赖 Sprng REST 或者其他 REST 框架来直接暴露，另一种是通过 Dubbo 框架内置的 REST 能力暴露。两种做法各有优缺点，主要体现在前者与微服务体系中的服务发现组件能够更好的工作，而后者可以无缝的享受到 Dubbo 体系中的服务发现以及服务治理的能力。本文关注的是如何使用后者来暴露 REST 服务。</p><p>自 <code>2.6.0</code> 开始，Dubbo 合并了当当网捐献的 DubboX <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> 中的主要特性，其中就包括了基于 RESTeasy <code>3.0.19.Final</code> 的 REST 支持，具备 JAXRS 2.0 规范中所有的能力。</p><h3 id=基本用法>基本用法</h3><p>在以下的例子中，展示了如何通过最传统的 Spring XML 配置的方式来快速的暴露和调用一个 REST 服务。其中底层的 server 使用的是 netty，服务注册发现基于 Zookeeper。</p><blockquote><p>注：本章节讨论的示例可以通过 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/basic>https://github.com/beiwei30/dubbo-rest-samples/tree/master/basic</a> 来获得</p></blockquote><h4 id=1-maven-依赖>1. Maven 依赖</h4><p>首先需要在项目中引入 dubbo all-in-one 的依赖以及 RESTEasy 相关的必要依赖。因为在本例中使用 Zookeeper 作为服务发现，还需要引入 Zookeeper client 相关的依赖。为了方便使用，第三方的依赖可以通过框架提供的 BOM 文件 <code>dubbo-dependencies-bom</code> 来引入。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#268bd2>&lt;properties&gt;</span>
        <span style=color:#268bd2>&lt;dubbo.version&gt;</span>2.6.5<span style=color:#268bd2>&lt;/dubbo.version&gt;</span>
    <span style=color:#268bd2>&lt;/properties&gt;</span>

    <span style=color:#268bd2>&lt;dependencyManagement&gt;</span>
        <span style=color:#268bd2>&lt;dependencies&gt;</span>
            <span style=color:#268bd2>&lt;dependency&gt;</span>
                <span style=color:#268bd2>&lt;groupId&gt;</span>com.alibaba<span style=color:#268bd2>&lt;/groupId&gt;</span>
                <span style=color:#268bd2>&lt;artifactId&gt;</span>dubbo-dependencies-bom<span style=color:#268bd2>&lt;/artifactId&gt;</span>
                <span style=color:#268bd2>&lt;version&gt;</span>${dubbo.version}<span style=color:#268bd2>&lt;/version&gt;</span>
                <span style=color:#268bd2>&lt;type&gt;</span>pom<span style=color:#268bd2>&lt;/type&gt;</span>
                <span style=color:#268bd2>&lt;scope&gt;</span>import<span style=color:#268bd2>&lt;/scope&gt;</span>
            <span style=color:#268bd2>&lt;/dependency&gt;</span>
        <span style=color:#268bd2>&lt;/dependencies&gt;</span>
    <span style=color:#268bd2>&lt;/dependencyManagement&gt;</span>

    <span style=color:#268bd2>&lt;dependencies&gt;</span>
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>com.alibaba<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>dubbo<span style=color:#268bd2>&lt;/artifactId&gt;</span>
            <span style=color:#268bd2>&lt;version&gt;</span>${dubbo.version}<span style=color:#268bd2>&lt;/version&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#586e75>&lt;!-- REST support dependencies --&gt;</span>
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>io.netty<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>netty-all<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.jboss.resteasy<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>resteasy-jaxrs<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.jboss.resteasy<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>resteasy-client<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.jboss.resteasy<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>resteasy-netty4<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>javax.validation<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>validation-api<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.jboss.resteasy<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>resteasy-jackson-provider<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.jboss.resteasy<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>resteasy-jaxb-provider<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>javax.servlet<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>javax.servlet-api<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>

        <span style=color:#586e75>&lt;!-- zookeeper client dependency --&gt;</span>
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.apache.curator<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>curator-framework<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
    <span style=color:#268bd2>&lt;/dependencies&gt;</span>
</code></pre></div><h4 id=2-定义服务接口>2. 定义服务接口</h4><p>定义一个服务接口 <code>UserService</code>，该接口提供两个功能，一个是获取指定 User 的详细信息，另一个是新注册一个用户。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Path</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;users&#34;</span><span style=color:#719e07>)</span> <span style=color:#586e75>// #1
</span><span style=color:#586e75></span><span style=color:#268bd2>@Consumes</span><span style=color:#719e07>({</span>MediaType<span style=color:#719e07>.</span>APPLICATION_JSON<span style=color:#719e07>,</span> MediaType<span style=color:#719e07>.</span>TEXT_XML<span style=color:#719e07>})</span> <span style=color:#586e75>// #2
</span><span style=color:#586e75></span><span style=color:#268bd2>@Produces</span><span style=color:#719e07>({</span>MediaType<span style=color:#719e07>.</span>APPLICATION_JSON<span style=color:#719e07>,</span> MediaType<span style=color:#719e07>.</span>TEXT_XML<span style=color:#719e07>})</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>interface</span> <span style=color:#268bd2>UserService</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>@GET</span> <span style=color:#586e75>// #3
</span><span style=color:#586e75></span>    <span style=color:#268bd2>@Path</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;{id: \\d+}&#34;</span><span style=color:#719e07>)</span>
    User <span style=color:#268bd2>getUser</span><span style=color:#719e07>(</span><span style=color:#268bd2>@PathParam</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;id&#34;</span><span style=color:#719e07>)</span> Long id<span style=color:#719e07>);</span>

    <span style=color:#268bd2>@POST</span> <span style=color:#586e75>// #4
</span><span style=color:#586e75></span>    <span style=color:#268bd2>@Path</span><span style=color:#719e07>(</span><span style=color:#2aa198>&#34;register&#34;</span><span style=color:#719e07>)</span>
    Long <span style=color:#268bd2>registerUser</span><span style=color:#719e07>(</span>User user<span style=color:#719e07>);</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>通过在接口上用 JaxRS 标准的 annotation 来修饰，我们规定了该服务在 REST 下的访问形式：</p><ol><li><code>@Path("users")</code> 定义了 UserService 通过 &lsquo;/users&rsquo; 来访问</li><li>在类级别上定义 <code>@Consumers</code> 和 <code>@Produces</code> 来规定参数以及返回值的类型为 XML 和 JSON。在类级别上定义之后，就可以不用在方法级别上进一步定义了</li><li>getUser 方法上通过 <code>@GET</code> 定义了接受的 HTTP 方法为 GET，通过 <code>@Path</code> 来规定参数是来自于 URL 中的 path。&lsquo;GET /users/1&rsquo; 等同于调用 &lsquo;getUser(1)&rsquo;</li><li>registerUser 方法上通过 <code>@POST</code> 定义了接受的 HTTP 方法为 POST，通过将 JSON 或 XML 格式的 User 数据 POST 到 &lsquo;/users/register&rsquo; 上来创建一个 User</li></ol><p>在 Dubbo 中，将 REST 相关的 annotation 定义在接口或者实现上都是可以的。这个在设计上是个权衡问题。Annotation 定义在实现类上可以保证接口的纯净，否则对于不需要通过 REST 方式调用的 Dubbo 调用方来说将需要强制依赖 JaxRS 的库，但是同时，对于需要通过 REST 方式调用的 Dubbo 调用方来说，就需要自己来处理 REST 调用相关的细节了。Annotation 定义在接口上，框架会自动处理掉 REST 调用相关的细节，并和 Dubbo 的服务发现以及服务治理功能能够很好的结合起来。在本例中采用了在接口上定义 JaxRS annotation 的形式。</p><h4 id=3-实现服务接口>3. 实现服务接口</h4><p>为了简洁，这里给出的接口的实现只是简单的返回了接口需要的类型的示例，在真实的系统中，逻辑可能会比较复杂。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>UserServiceImpl</span> <span style=color:#268bd2>implements</span> UserService <span style=color:#719e07>{</span>
    <span style=color:#268bd2>private</span> <span style=color:#268bd2>final</span> AtomicLong id <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> AtomicLong<span style=color:#719e07>();</span>

    <span style=color:#268bd2>public</span> User <span style=color:#268bd2>getUser</span><span style=color:#719e07>(</span>Long id<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> <span style=color:#719e07>new</span> User<span style=color:#719e07>(</span>id<span style=color:#719e07>,</span> <span style=color:#2aa198>&#34;username-&#34;</span> <span style=color:#719e07>+</span> id<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>

    <span style=color:#268bd2>public</span> Long <span style=color:#268bd2>registerUser</span><span style=color:#719e07>(</span>User user<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> id<span style=color:#719e07>.</span>incrementAndGet<span style=color:#719e07>();</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=4-装配服务>4. 装配服务</h4><p>如上所述，本例展示的是如何通过传统的 Spring XML 的方式来装配并暴露 Dubbo 服务。需要指出的是，这里展示了如何同时暴露两种不同的协议，一种是 REST，另一种是原生的 Dubbo 协议。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#719e07>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style=color:#268bd2>&lt;beans</span> xmlns=<span style=color:#2aa198>&#34;http://www.springframework.org/schema/beans&#34;</span>
       xmlns:xsi=<span style=color:#2aa198>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       xmlns:dubbo=<span style=color:#2aa198>&#34;http://code.alibabatech.com/schema/dubbo&#34;</span>
       xsi:schemaLocation=<span style=color:#2aa198>&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&#34;</span><span style=color:#268bd2>&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:application</span> name=<span style=color:#2aa198>&#34;rest-provider&#34;</span><span style=color:#268bd2>/&gt;</span> <span style=color:#586e75>&lt;!-- #1 --&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:registry</span> address=<span style=color:#2aa198>&#34;zookeeper://127.0.0.1:2181&#34;</span><span style=color:#268bd2>/&gt;</span> <span style=color:#586e75>&lt;!-- #2 --&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:protocol</span> name=<span style=color:#2aa198>&#34;rest&#34;</span> port=<span style=color:#2aa198>&#34;8080&#34;</span> server=<span style=color:#2aa198>&#34;netty&#34;</span><span style=color:#268bd2>/&gt;</span> <span style=color:#586e75>&lt;!-- #3 --&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:protocol</span> name=<span style=color:#2aa198>&#34;dubbo&#34;</span> server=<span style=color:#2aa198>&#34;netty4&#34;</span><span style=color:#268bd2>/&gt;</span> <span style=color:#586e75>&lt;!-- #4 --&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:service</span> interface=<span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.api.UserService&#34;</span> protocol=<span style=color:#2aa198>&#34;rest,dubbo&#34;</span> ref=<span style=color:#2aa198>&#34;userService&#34;</span><span style=color:#268bd2>/&gt;</span>  <span style=color:#586e75>&lt;!-- #5 --&gt;</span>
    <span style=color:#268bd2>&lt;bean</span> id=<span style=color:#2aa198>&#34;userService&#34;</span> class=<span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.impl.UserServiceImpl&#34;</span><span style=color:#268bd2>/&gt;</span>
<span style=color:#268bd2>&lt;/beans&gt;</span> <span style=color:#586e75>&lt;!-- #6 --&gt;</span>
</code></pre></div><ol><li>定义了该应用的名字为 <code>rest-provider</code></li><li>定义了服务注册通过 Zookeeper，并且 URL 为 &ldquo;zookeeper://127.0.0.1:2181&rdquo;</li><li>在端口 8080 上以 REST 方式暴露服务，底层的传输使用的是 netty</li><li>在默认端口 20880 上以原生 Dubbo 方式暴露服务，底层的传输方式是 netty</li><li>将 ‘userService' 的 Spring bean （也就是 UserServiceImpl）暴露为 UserService 服务，支持的协议既包括了 REST 也包括了 Dubbo</li><li>将 UserServiceImpl 注册成 &lsquo;userService&rsquo; 的 Spring bean</li></ol><h4 id=5-服务提供方的启动类>5. 服务提供方的启动类</h4><p>简单的通过 ClassPathXmlApplicationContext 来加载刚刚配置的 Spring XML 配置 &lsquo;rest-provider.xml&rsquo; 即可启动 Dubbo 服务端</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>RestProvider</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> IOException <span style=color:#719e07>{</span>
        ClassPathXmlApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ClassPathXmlApplicationContext<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;spring/rest-provider.xml&#34;</span><span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>
        System<span style=color:#719e07>.</span>in<span style=color:#719e07>.</span>read<span style=color:#719e07>();</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=6-启动服务端>6. 启动服务端</h4><p>由于本例依赖 Zookeeper 做服务注册发现，在启动 RestProvider 之前，需要先启动一个 Zookeeper 服务器。之后就可以之间运行 RestProvider 了。通过以下的输出日志，我们可以知道 UserService 以两种方式对外暴露了同一个服务，其中：</p><ul><li>REST: rest://192.168.2.132:8080/org.apache.dubbo.samples.rest.api.UserService</li><li>Dubbo: dubbo://192.168.2.132:20880/org.apache.dubbo.samples.rest.api.UserServic</li></ul><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>...
<span style=color:#719e07>[</span>01/01/19 07:18:56:056 CST<span style=color:#719e07>]</span> main  INFO config.AbstractConfig:  <span style=color:#719e07>[</span>DUBBO<span style=color:#719e07>]</span> Export dubbo service org.apache.dubbo.samples.rest.api.UserService to url rest://192.168.2.132:8080/org.apache.dubbo.samples.rest.api.UserService?anyhost<span style=color:#719e07>=</span>true&amp;<span style=color:#268bd2>application</span><span style=color:#719e07>=</span>rest-provider&amp;bean.name<span style=color:#719e07>=</span>org.apache.dubbo.samples.rest.api.UserService&amp;bind.ip<span style=color:#719e07>=</span>192.168.2.132&amp;bind.port<span style=color:#719e07>=</span>8080&amp;<span style=color:#268bd2>dubbo</span><span style=color:#719e07>=</span>2.0.2&amp;<span style=color:#268bd2>generic</span><span style=color:#719e07>=</span>false&amp;<span style=color:#268bd2>interface</span><span style=color:#719e07>=</span>org.apache.dubbo.samples.rest.api.UserService&amp;<span style=color:#268bd2>methods</span><span style=color:#719e07>=</span>getUser,registerUser&amp;<span style=color:#268bd2>pid</span><span style=color:#719e07>=</span>27386&amp;<span style=color:#268bd2>server</span><span style=color:#719e07>=</span>netty&amp;<span style=color:#268bd2>side</span><span style=color:#719e07>=</span>provider&amp;<span style=color:#268bd2>timestamp</span><span style=color:#719e07>=</span>1546341536194, dubbo version: 2.6.5, current host: 192.168.2.132
...
<span style=color:#719e07>[</span>01/01/19 07:18:57:057 CST<span style=color:#719e07>]</span> main  INFO config.AbstractConfig:  <span style=color:#719e07>[</span>DUBBO<span style=color:#719e07>]</span> Export dubbo service org.apache.dubbo.samples.rest.api.UserService to url dubbo://192.168.2.132:20880/org.apache.dubbo.samples.rest.api.UserService?anyhost<span style=color:#719e07>=</span>true&amp;<span style=color:#268bd2>application</span><span style=color:#719e07>=</span>rest-provider&amp;bean.name<span style=color:#719e07>=</span>org.apache.dubbo.samples.rest.api.UserService&amp;bind.ip<span style=color:#719e07>=</span>192.168.2.132&amp;bind.port<span style=color:#719e07>=</span>20880&amp;<span style=color:#268bd2>dubbo</span><span style=color:#719e07>=</span>2.0.2&amp;<span style=color:#268bd2>generic</span><span style=color:#719e07>=</span>false&amp;<span style=color:#268bd2>interface</span><span style=color:#719e07>=</span>org.apache.dubbo.samples.rest.api.UserService&amp;<span style=color:#268bd2>methods</span><span style=color:#719e07>=</span>getUser,registerUser&amp;<span style=color:#268bd2>pid</span><span style=color:#719e07>=</span>27386&amp;<span style=color:#268bd2>server</span><span style=color:#719e07>=</span>netty4&amp;<span style=color:#268bd2>side</span><span style=color:#719e07>=</span>provider&amp;<span style=color:#268bd2>timestamp</span><span style=color:#719e07>=</span>1546341537392, dubbo version: 2.6.5, current host: 192.168.2.132
...
</code></pre></div><p>也可以通过 zkCli 访问 Zookeeper 服务器来验证。'/dubbo/org.apache.dubbo.samples.rest.api.UserService/providers' 路径下返回了一个数组 [dubbo://&mldr;, rest:.//&mldr;]。数组的第一个元素是 ’dubbo‘ 打头的，而第二个元素是 &lsquo;rest&rsquo; 打头的。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#719e07>[</span>zk: localhost:2181<span style=color:#719e07>(</span>CONNECTED<span style=color:#719e07>)</span> 10<span style=color:#719e07>]</span> ls /dubbo/org.apache.dubbo.samples.rest.api.UserService/providers
<span style=color:#719e07>[</span>dubbo%3A%2F%2F192.168.2.132%3A20880%2Forg.apache.dubbo.samples.rest.api.UserService%3Fanyhost%3Dtrue%26application%3Drest-provider%26bean.name%3Dorg.apache.dubbo.samples.rest.api.UserService%26dubbo%3D2.0.2%26generic%3Dfalse%26interface%3Dorg.apache.dubbo.samples.rest.api.UserService%26methods%3DgetUser%2CregisterUser%26pid%3D27386%26server%3Dnetty4%26side%3Dprovider%26timestamp%3D1546341537392, rest%3A%2F%2F192.168.2.132%3A8080%2Forg.apache.dubbo.samples.rest.api.UserService%3Fanyhost%3Dtrue%26application%3Drest-provider%26bean.name%3Dorg.apache.dubbo.samples.rest.api.UserService%26dubbo%3D2.0.2%26generic%3Dfalse%26interface%3Dorg.apache.dubbo.samples.rest.api.UserService%26methods%3DgetUser%2CregisterUser%26pid%3D27386%26server%3Dnetty%26side%3Dprovider%26timestamp%3D1546341536194<span style=color:#719e07>]</span>

</code></pre></div><p>可以简单的通过 &lsquo;curl&rsquo; 在命令行验证刚才暴露出来的 REST 服务：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ curl http://localhost:8080/users/1
<span style=color:#719e07>{</span><span style=color:#2aa198>&#34;id&#34;</span>:1,<span style=color:#2aa198>&#34;name&#34;</span>:<span style=color:#2aa198>&#34;username-1&#34;</span><span style=color:#719e07>}</span>
$ curl -X POST -H <span style=color:#2aa198>&#34;Content-Type: application/json&#34;</span> -d <span style=color:#2aa198>&#39;{&#34;id&#34;:1,&#34;name&#34;:&#34;Larry Page&#34;}&#39;</span> http://localhost:8080/users/register
<span style=color:#2aa198>1</span>
</code></pre></div><h4 id=7-装配调用端>7. 装配调用端</h4><p>Dubbo 调用方只需要依赖服务的接口，通过以下方式装配好 Dubbo Consumer，即可发起调用。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#719e07>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style=color:#268bd2>&lt;beans</span> xmlns=<span style=color:#2aa198>&#34;http://www.springframework.org/schema/beans&#34;</span>
       xmlns:xsi=<span style=color:#2aa198>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       xmlns:dubbo=<span style=color:#2aa198>&#34;http://code.alibabatech.com/schema/dubbo&#34;</span>
       xsi:schemaLocation=<span style=color:#2aa198>&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&#34;</span><span style=color:#268bd2>&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:application</span> name=<span style=color:#2aa198>&#34;rest-consumer&#34;</span><span style=color:#268bd2>/&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:registry</span> address=<span style=color:#2aa198>&#34;zookeeper://127.0.0.1:2181&#34;</span><span style=color:#268bd2>/&gt;</span>
    <span style=color:#268bd2>&lt;dubbo:reference</span> id=<span style=color:#2aa198>&#34;userService&#34;</span> interface=<span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.api.UserService&#34;</span> protocol=<span style=color:#2aa198>&#34;rest&#34;</span><span style=color:#268bd2>/&gt;</span> <span style=color:#586e75>&lt;!-- #1 --&gt;</span>
<span style=color:#268bd2>&lt;/beans&gt;</span>
</code></pre></div><ol><li>&lsquo;userService&rsquo; 配置的 protocol 为 “rest"，将通过 REST 协议调用服务端</li></ol><p>需要特别指出的是，这里显示的指定 protocol=&ldquo;rest&rdquo; 在通常情况下不是必须的。这里需要显示指定的原因是我们例子中服务端同时暴露了多种协议，这里指定使用 rest 是为了确保调用方走 REST 协议。</p><h4 id=8-发起调用>8. 发起调用</h4><p>简单的通过 ClassPathXmlApplicationContext 来加载刚刚配置的 Spring XML 配置 &lsquo;rest-consumer.xml&rsquo; 即可发起对 RestProvider 所提供的 UserService 的 REST 服务的调用。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>RestConsumer</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        ClassPathXmlApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ClassPathXmlApplicationContext<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;spring/rest-consumer.xml&#34;</span><span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>

        UserService userService <span style=color:#719e07>=</span> context<span style=color:#719e07>.</span>getBean<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;userService&#34;</span><span style=color:#719e07>,</span> UserService<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>out<span style=color:#719e07>.</span>println<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;&gt;&gt;&gt; &#34;</span> <span style=color:#719e07>+</span> userService<span style=color:#719e07>.</span>getUser<span style=color:#719e07>(</span>1L<span style=color:#719e07>));</span>

        User user <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> User<span style=color:#719e07>(</span>2L<span style=color:#719e07>,</span> <span style=color:#2aa198>&#34;Larry Page&#34;</span><span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>out<span style=color:#719e07>.</span>println<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;&gt;&gt;&gt; &#34;</span> <span style=color:#719e07>+</span> userService<span style=color:#719e07>.</span>registerUser<span style=color:#719e07>(</span>user<span style=color:#719e07>));</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><p>这里分别展示了对 &lsquo;getUser&rsquo; 和 &lsquo;registerUser&rsquo; 的调用，输出结果如下：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt;&gt;&gt; User<span style=color:#719e07>{</span><span style=color:#268bd2>id</span><span style=color:#719e07>=</span>1, <span style=color:#268bd2>name</span><span style=color:#719e07>=</span><span style=color:#2aa198>&#39;username-1&#39;</span><span style=color:#719e07>}</span>
&gt;&gt;&gt; <span style=color:#2aa198>2</span>
</code></pre></div><h3 id=进阶>进阶</h3><h4 id=a-在-rest-中使用-annotation>A. 在 REST 中使用 Annotation</h4><p>在 Dubbo 中使用 annotation 而不是 Spring XML 来暴露和引用服务，对于 REST 协议来说并没有什么不同。有关如何使用 annotation 更详细的用法，请参阅《在 Dubbo 中使用注解》章节。这里主要展示一下与上面基于 Spring XML 配置的例子不同之处。</p><blockquote><p>注：本章节讨论的示例可以通过 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/annotation>https://github.com/beiwei30/dubbo-rest-samples/tree/master/annotation</a> 来获得</p></blockquote><h5 id=1-使用-java-configuration-来配置服务提供方的-protocolregistryapplication>1. 使用 Java Configuration 来配置服务提供方的 protocol、registry、application</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#268bd2>@Configuration</span>
    <span style=color:#268bd2>@EnableDubbo</span><span style=color:#719e07>(</span>scanBasePackages <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.impl&#34;</span><span style=color:#719e07>)</span> <span style=color:#586e75>// #1
</span><span style=color:#586e75></span>    <span style=color:#268bd2>static</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ProviderConfiguration</span> <span style=color:#719e07>{</span>
        <span style=color:#268bd2>@Bean</span> <span style=color:#586e75>// #2
</span><span style=color:#586e75></span>        <span style=color:#268bd2>public</span> ProtocolConfig <span style=color:#268bd2>protocolConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
            ProtocolConfig protocolConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ProtocolConfig<span style=color:#719e07>();</span>
            protocolConfig<span style=color:#719e07>.</span>setName<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;rest&#34;</span><span style=color:#719e07>);</span>
            protocolConfig<span style=color:#719e07>.</span>setPort<span style=color:#719e07>(</span>8080<span style=color:#719e07>);</span>
            protocolConfig<span style=color:#719e07>.</span>setServer<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;netty&#34;</span><span style=color:#719e07>);</span>
            <span style=color:#719e07>return</span> protocolConfig<span style=color:#719e07>;</span>
        <span style=color:#719e07>}</span>

        <span style=color:#268bd2>@Bean</span> <span style=color:#586e75>// #3
</span><span style=color:#586e75></span>        <span style=color:#268bd2>public</span> RegistryConfig <span style=color:#268bd2>registryConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
            RegistryConfig registryConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> RegistryConfig<span style=color:#719e07>();</span>
            registryConfig<span style=color:#719e07>.</span>setProtocol<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;zookeeper&#34;</span><span style=color:#719e07>);</span>
            registryConfig<span style=color:#719e07>.</span>setAddress<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;localhost&#34;</span><span style=color:#719e07>);</span>
            registryConfig<span style=color:#719e07>.</span>setPort<span style=color:#719e07>(</span>2181<span style=color:#719e07>);</span>
            <span style=color:#719e07>return</span> registryConfig<span style=color:#719e07>;</span>
        <span style=color:#719e07>}</span>

        <span style=color:#268bd2>@Bean</span>
        <span style=color:#268bd2>public</span> ApplicationConfig <span style=color:#268bd2>applicationConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
            ApplicationConfig applicationConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ApplicationConfig<span style=color:#719e07>();</span>
            applicationConfig<span style=color:#719e07>.</span>setName<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;rest-provider&#34;</span><span style=color:#719e07>);</span>
            <span style=color:#719e07>return</span> applicationConfig<span style=color:#719e07>;</span>
        <span style=color:#719e07>}</span>
    <span style=color:#719e07>}</span>
</code></pre></div><ol><li>通过 <code>@EnableDubbo</code> 来指定需要扫描 Dubbo 服务的包名，在本例中，UserServiceImpl 在 &ldquo;org.apache.dubbo.samples.rest.impl&rdquo; 下</li><li>通过提供一个 ProtocolConfig 的 Spring Bean 来指定服务提供方按照 REST 来暴露服务</li><li>通过提供一个 RegistryConfig 的 Spring Bean 来指定服务提供方所使用的服务注册机制</li></ol><h5 id=2-使用-service-来申明-dubbo-服务>2. 使用 @Service 来申明 Dubbo 服务</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Service</span> <span style=color:#586e75>// #1
</span><span style=color:#586e75></span><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>UserServiceImpl</span> <span style=color:#268bd2>implements</span> UserService <span style=color:#719e07>{</span>
    <span style=color:#719e07>...</span>
<span style=color:#719e07>}</span>
</code></pre></div><ol><li>简单的使用 <code>@Service</code> 或者 <code>@Service(protocol = "rest")</code> 修饰 &ldquo;UserServiceImpl&rdquo; 来申明一个 Dubbo 服务，这里 <code>protocol = "rest"</code> 不是必须提供的，原因是通过 Java Configuration 只配置了一个 ProtocolConfig 的示例，在这种情况下，Dubbo 会自动装配该协议到服务中</li></ol><h5 id=3-服务提供方启动类>3. 服务提供方启动类</h5><p>通过使用 <code>ProviderConfiguration</code> 来初始化一个 <code>AnnotationConfigApplicationContext</code> 实例，就可以完全摆脱 Spring XML 的配置文件，完全借助 annotation 来装配好一个 Dubbo 的服务提供方。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>RestProvider</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#268bd2>throws</span> IOException <span style=color:#719e07>{</span>
        AnnotationConfigApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> AnnotationConfigApplicationContext<span style=color:#719e07>(</span>ProviderConfiguration<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>
        System<span style=color:#719e07>.</span>in<span style=color:#719e07>.</span>read<span style=color:#719e07>();</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h5 id=4-使用-java-configuration-来配置服务消费方的-registryapplication>4. 使用 Java Configuration 来配置服务消费方的 registry、application</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    <span style=color:#268bd2>@Configuration</span>
    <span style=color:#268bd2>@EnableDubbo</span><span style=color:#719e07>(</span>scanBasePackages <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.comp&#34;</span><span style=color:#719e07>)</span> <span style=color:#586e75>// #1
</span><span style=color:#586e75></span>    <span style=color:#268bd2>@ComponentScan</span><span style=color:#719e07>({</span><span style=color:#2aa198>&#34;org.apache.dubbo.samples.rest.comp&#34;</span><span style=color:#719e07>})</span> <span style=color:#586e75>// #2
</span><span style=color:#586e75></span>    <span style=color:#268bd2>static</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>ConsumerConfiguration</span> <span style=color:#719e07>{</span>
        <span style=color:#268bd2>@Bean</span> <span style=color:#586e75>// #3
</span><span style=color:#586e75></span>        <span style=color:#268bd2>public</span> RegistryConfig <span style=color:#268bd2>registryConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
            RegistryConfig registryConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> RegistryConfig<span style=color:#719e07>();</span>
            registryConfig<span style=color:#719e07>.</span>setProtocol<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;zookeeper&#34;</span><span style=color:#719e07>);</span>
            registryConfig<span style=color:#719e07>.</span>setAddress<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;localhost&#34;</span><span style=color:#719e07>);</span>
            registryConfig<span style=color:#719e07>.</span>setPort<span style=color:#719e07>(</span>2181<span style=color:#719e07>);</span>
            <span style=color:#719e07>return</span> registryConfig<span style=color:#719e07>;</span>
        <span style=color:#719e07>}</span>

        <span style=color:#268bd2>@Bean</span>
        <span style=color:#268bd2>public</span> ApplicationConfig <span style=color:#268bd2>applicationConfig</span><span style=color:#719e07>()</span> <span style=color:#719e07>{</span>
            ApplicationConfig applicationConfig <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> ApplicationConfig<span style=color:#719e07>();</span>
            applicationConfig<span style=color:#719e07>.</span>setName<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;rest-consumer&#34;</span><span style=color:#719e07>);</span>
            <span style=color:#719e07>return</span> applicationConfig<span style=color:#719e07>;</span>
        <span style=color:#719e07>}</span>
    <span style=color:#719e07>}</span>
</code></pre></div><ol><li>通过 <code>@EnableDubbo</code> 来指定需要扫描 Dubbo 服务引用 <code>@Reference</code> 的包名。在本例中，UserService 的引用在 &ldquo;org.apache.dubbo.samples.rest.comp&rdquo; 下</li><li>通过 <code>@ComponentScan</code> 来指定需要扫描的 Spring Bean 的包名。在本例中，包含 UserService 引用的类 UserServiceComponent 本身需要是一个 Spring Bean，以方便调用，所以，这里指定的包名也是 &ldquo;org.apache.dubbo.samples.rest.comp&rdquo;</li><li>通过提供一个 RegistryConfig 的 Spring Bean 来指定服务消费方所使用的服务发现机制</li></ol><p>这里提到的 UserServiceComponent 的 Spring Bean 定义如下：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>@Component</span>
<span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>UserServiceComponent</span> <span style=color:#268bd2>implements</span> UserService <span style=color:#719e07>{</span> <span style=color:#586e75>// #1
</span><span style=color:#586e75></span>    <span style=color:#268bd2>@Reference</span>
    <span style=color:#268bd2>private</span> UserService userService<span style=color:#719e07>;</span>


    <span style=color:#268bd2>@Override</span>
    <span style=color:#268bd2>public</span> User <span style=color:#268bd2>getUser</span><span style=color:#719e07>(</span>Long id<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> userService<span style=color:#719e07>.</span>getUser<span style=color:#719e07>(</span>id<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>

    <span style=color:#268bd2>@Override</span>
    <span style=color:#268bd2>public</span> Long <span style=color:#268bd2>registerUser</span><span style=color:#719e07>(</span>User user<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        <span style=color:#719e07>return</span> userService<span style=color:#719e07>.</span>registerUser<span style=color:#719e07>(</span>user<span style=color:#719e07>);</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><ol><li>这里比较好的实践是让这个 Spring Bean 也继承 <code>UserService</code> 接口，这样在调用的时候也可以面向接口编程</li></ol><h5 id=5-服务调用方启动类>5. 服务调用方启动类</h5><p>通过使用 <code>ConsumerConfiguration</code> 来初始化一个 <code>AnnotationConfigApplicationContext</code> 实例，就可以完全摆脱 Spring XML 的配置文件，完全借助 annotation 来装配好一个 Dubbo 的服务消费方。然后就可以通过查找 <code>UserServiceComponent</code> 类型的 Spring Bean 来发起远程调用。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#268bd2>public</span> <span style=color:#268bd2>class</span> <span style=color:#268bd2>RestConsumer</span> <span style=color:#719e07>{</span>
    <span style=color:#268bd2>public</span> <span style=color:#268bd2>static</span> <span style=color:#dc322f>void</span> <span style=color:#268bd2>main</span><span style=color:#719e07>(</span>String<span style=color:#719e07>[]</span> args<span style=color:#719e07>)</span> <span style=color:#719e07>{</span>
        AnnotationConfigApplicationContext context <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> AnnotationConfigApplicationContext<span style=color:#719e07>(</span>ConsumerConfiguration<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        context<span style=color:#719e07>.</span>start<span style=color:#719e07>();</span>

        UserService userService <span style=color:#719e07>=</span> context<span style=color:#719e07>.</span>getBean<span style=color:#719e07>(</span>UserServiceComponent<span style=color:#719e07>.</span>class<span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>out<span style=color:#719e07>.</span>println<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;&gt;&gt;&gt; &#34;</span> <span style=color:#719e07>+</span> userService<span style=color:#719e07>.</span>getUser<span style=color:#719e07>(</span>1L<span style=color:#719e07>));</span>

        User user <span style=color:#719e07>=</span> <span style=color:#719e07>new</span> User<span style=color:#719e07>(</span>2L<span style=color:#719e07>,</span> <span style=color:#2aa198>&#34;Larry Page&#34;</span><span style=color:#719e07>);</span>
        System<span style=color:#719e07>.</span>out<span style=color:#719e07>.</span>println<span style=color:#719e07>(</span><span style=color:#2aa198>&#34;&gt;&gt;&gt; &#34;</span> <span style=color:#719e07>+</span> userService<span style=color:#719e07>.</span>registerUser<span style=color:#719e07>(</span>user<span style=color:#719e07>));</span>
    <span style=color:#719e07>}</span>
<span style=color:#719e07>}</span>
</code></pre></div><h4 id=b-让协议跑在不同的服务器上>B. 让协议跑在不同的服务器上</h4><p>目前 REST 协议在 Dubbo 中可以跑在五种不同的 server 上，分别是：</p><ul><li>&ldquo;netty&rdquo;: 直接基于 netty 框架的 rest server，通过 <code>&lt;dubbo:protocol name="rest" server="netty"/></code> 来配置</li><li>&ldquo;tomcat&rdquo;: 基于嵌入式 tomcat 的 rest server，通过 <code>&lt;dubbo:protocol name="rest" server="tomcat"/></code> 来配置</li><li>&ldquo;jetty&rdquo;: <strong>默认选项</strong>，基于嵌入式 jetty 的 rest server，通过 <code>&lt;dubbo:protocol name="rest" server="jetty"/></code> 来配置</li><li>&ldquo;sunhttp&rdquo;: 使用 JDK 内置的 Sun HTTP server 作为 rest server，通过 <code>&lt;dubbo:protocol name="rest" server="sunhttp"/></code> 来配置，仅推荐在开发环境中使用</li><li>&ldquo;servlet”: 采用外部应用服务器的 servlet 容器来做 rest server，这个时候，除了配置 <code>&lt;dubbo:protocol name="rest" server="servlet"/></code> 之外，还需要在 web.xml 中做额外的配置</li></ul><p>由于以上的例子展示了 &ldquo;netty&rdquo; 作为 rest server，下面演示一下使用嵌入式 tomcat 的 rest server 的用法。</p><blockquote><p>注：本章节讨论的示例可以通过 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/tomcat>https://github.com/beiwei30/dubbo-rest-samples/tree/master/tomcat</a> 来获得</p></blockquote><h5 id=1-增加-tomcat-相关的依赖>1. 增加 Tomcat 相关的依赖</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.apache.tomcat.embed<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>tomcat-embed-core<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.apache.tomcat.embed<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>tomcat-embed-logging-juli<span style=color:#268bd2>&lt;/artifactId&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
</code></pre></div><h5 id=2-配置-protocol-使用-tomcat-作为-rest-server>2. 配置 protocol 使用 tomcat 作为 REST server</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#268bd2>&lt;dubbo:protocol</span> name=<span style=color:#2aa198>&#34;rest&#34;</span> port=<span style=color:#2aa198>&#34;8080&#34;</span> server=<span style=color:#2aa198>&#34;tomcat&#34;</span><span style=color:#268bd2>/&gt;</span>
</code></pre></div><p>启动服务提供方之后，在以下的输出将会出现与嵌入式 Tomcat 相关的日志信息：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Jan 01, <span style=color:#2aa198>2019</span> 10:15:12 PM org.apache.catalina.core.StandardContext setPath
WARNING: A context path must either be an empty string or start with a <span style=color:#2aa198>&#39;/&#39;</span> and <span style=color:#719e07>do</span> not end with a <span style=color:#2aa198>&#39;/&#39;</span>. The path <span style=color:#719e07>[</span>/<span style=color:#719e07>]</span> does not meet these criteria and has been changed to <span style=color:#719e07>[]</span>
Jan 01, <span style=color:#2aa198>2019</span> 10:15:13 PM org.apache.coyote.AbstractProtocol init
INFO: Initializing ProtocolHandler <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;http-nio-8080&#34;</span><span style=color:#719e07>]</span>
Jan 01, <span style=color:#2aa198>2019</span> 10:15:13 PM org.apache.tomcat.util.net.NioSelectorPool getSharedSelector
INFO: Using a shared selector <span style=color:#719e07>for</span> servlet write/read
Jan 01, <span style=color:#2aa198>2019</span> 10:15:13 PM org.apache.catalina.core.StandardService startInternal
INFO: Starting service <span style=color:#719e07>[</span>Tomcat<span style=color:#719e07>]</span>
Jan 01, <span style=color:#2aa198>2019</span> 10:15:13 PM org.apache.catalina.core.StandardEngine startInternal
INFO: Starting Servlet Engine: Apache Tomcat/8.5.31
Jan 01, <span style=color:#2aa198>2019</span> 10:15:13 PM org.apache.coyote.AbstractProtocol start
INFO: Starting ProtocolHandler <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;http-nio-8080&#34;</span><span style=color:#719e07>]</span>
</code></pre></div><h4 id=c-使用外部的-servlet-容器>C. 使用外部的 Servlet 容器</h4><p>进一步的，还可以使用外部的 servlet 容器来启动 Dubbo 的 REST 服务。</p><blockquote><p>注：本章节讨论的示例可以通过 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/servlet>https://github.com/beiwei30/dubbo-rest-samples/tree/master/servlet</a> 来获得</p></blockquote><h5 id=1-修改-pomxml-改变打包方式>1. 修改 pom.xml 改变打包方式</h5><p>因为使用的是外部的 servlet 容器，需要将打包方式修改为 &ldquo;war&rdquo;</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#268bd2>&lt;packaging&gt;</span>war<span style=color:#268bd2>&lt;/packaging&gt;</span>
</code></pre></div><h5 id=2-修改-rest-providerxml>2. 修改 rest-provider.xml</h5><p>配置 &ldquo;server&rdquo; 为 &ldquo;servlet&rdquo; 表示将使用外部的 servlet 容器。并配置 &ldquo;contextpath&rdquo; 为 &ldquo;"，原因是在使用外部 servlet 容器时，Dubbo 的 REST 支持需要知道被托管的 webapp 的 contextpath 是什么。这里我们计划通过 root context path 来部署应用，所以配置其为 &ldquo;"。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#268bd2>&lt;dubbo:protocol</span> name=<span style=color:#2aa198>&#34;rest&#34;</span> port=<span style=color:#2aa198>&#34;8080&#34;</span> server=<span style=color:#2aa198>&#34;servlet&#34;</span> contextpath=<span style=color:#2aa198>&#34;&#34;</span><span style=color:#268bd2>/&gt;</span>
</code></pre></div><h5 id=3-配置-web-infwebxml>3. 配置 WEB-INF/web.xml</h5><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#719e07>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style=color:#268bd2>&lt;web-app</span> xmlns=<span style=color:#2aa198>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
         xmlns:xsi=<span style=color:#2aa198>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         xsi:schemaLocation=<span style=color:#2aa198>&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span>
         version=<span style=color:#2aa198>&#34;3.1&#34;</span><span style=color:#268bd2>&gt;</span>
    <span style=color:#268bd2>&lt;context-param&gt;</span> <span style=color:#586e75>&lt;!-- #1 --&gt;</span>
        <span style=color:#268bd2>&lt;param-name&gt;</span>contextConfigLocation<span style=color:#268bd2>&lt;/param-name&gt;</span>
        <span style=color:#268bd2>&lt;param-value&gt;</span>/WEB-INF/classes/spring/rest-provider.xml<span style=color:#268bd2>&lt;/param-value&gt;</span>
    <span style=color:#268bd2>&lt;/context-param&gt;</span>

    <span style=color:#268bd2>&lt;listener&gt;</span>
        <span style=color:#268bd2>&lt;listener-class&gt;</span>com.alibaba.dubbo.remoting.http.servlet.BootstrapListener<span style=color:#268bd2>&lt;/listener-class&gt;</span>
    <span style=color:#268bd2>&lt;/listener&gt;</span>

    <span style=color:#268bd2>&lt;listener&gt;</span>
        <span style=color:#268bd2>&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span style=color:#268bd2>&lt;/listener-class&gt;</span>
    <span style=color:#268bd2>&lt;/listener&gt;</span>

    <span style=color:#268bd2>&lt;servlet&gt;</span> <span style=color:#586e75>&lt;!-- #2 --&gt;</span>
        <span style=color:#268bd2>&lt;servlet-name&gt;</span>dispatcher<span style=color:#268bd2>&lt;/servlet-name&gt;</span>
        <span style=color:#268bd2>&lt;servlet-class&gt;</span>com.alibaba.dubbo.remoting.http.servlet.DispatcherServlet<span style=color:#268bd2>&lt;/servlet-class&gt;</span>
        <span style=color:#268bd2>&lt;load-on-startup&gt;</span>1<span style=color:#268bd2>&lt;/load-on-startup&gt;</span>
    <span style=color:#268bd2>&lt;/servlet&gt;</span>
    <span style=color:#268bd2>&lt;servlet-mapping&gt;</span>
        <span style=color:#268bd2>&lt;servlet-name&gt;</span>dispatcher<span style=color:#268bd2>&lt;/servlet-name&gt;</span>
        <span style=color:#268bd2>&lt;url-pattern&gt;</span>/api/*<span style=color:#268bd2>&lt;/url-pattern&gt;</span>
    <span style=color:#268bd2>&lt;/servlet-mapping&gt;</span>


</code></pre></div><ol><li>配置 Dubbo 和 Spring 相关的 ContextListener，打开 Dubbo HTTP 支持，以及通过 rest-provider.xml 来装配 Dubbo 服务</li><li>配置 Dubbo HTTP 所需的 DiapatcherServlet</li></ol><p>这样做之后，不再需要 RestProvider 来启动 Dubbo 服务，可以将其从工程中删掉。对应的，现在 Dubbo 的服务将会随着 Servlet 容器的启动而启动。启动完毕之后，可以通过类似 &ldquo;http://localhost:8080/api/users/1&rdquo; 来访问暴露出的 REST 服务。需要注意的是，这个例子里假定了服务提供方的 WAR 包部署在 root context path 上，所以当该应用通过 IDE 配置的 tomcat server 启动时，需要指定 Application Context 为 &ldquo;/"。</p><h4 id=d-增加-swagger-支持>D. 增加 Swagger 支持</h4><p>在上面使用外部 Servlet 容器的例子的基础上，讨论如何暴露 Swagger OpenApi 以及如何继承 Swagger UI。</p><blockquote><p>注：本章节讨论的示例可以通过 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/servlet>https://github.com/beiwei30/dubbo-rest-samples/tree/master/servlet</a> 来获得</p></blockquote><h5 id=1-暴露-swagger-openapi>1. 暴露 Swagger OpenApi</h5><p>增加 swagger 相关依赖，以便通过 &ldquo;http://localhost:8080/openapi.json&rdquo; 来访问 REST 服务的描述</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#268bd2>&lt;properties&gt;</span>
        <span style=color:#268bd2>&lt;swagger.version&gt;</span>2.0.6<span style=color:#268bd2>&lt;/swagger.version&gt;</span>
    <span style=color:#268bd2>&lt;/properties&gt;</span>

	<span style=color:#268bd2>&lt;dependencies&gt;</span> 
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>io.swagger.core.v3<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>swagger-jaxrs2<span style=color:#268bd2>&lt;/artifactId&gt;</span>
            <span style=color:#268bd2>&lt;version&gt;</span>${swagger.version}<span style=color:#268bd2>&lt;/version&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>io.swagger.core.v3<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>swagger-jaxrs2-servlet-initializer<span style=color:#268bd2>&lt;/artifactId&gt;</span>
            <span style=color:#268bd2>&lt;version&gt;</span>${swagger.version}<span style=color:#268bd2>&lt;/version&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
    <span style=color:#268bd2>&lt;/dependencies&gt;</span>
</code></pre></div><p>修改 WEB-INF/web.xml，增加 openapi servlet 的配置</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#268bd2>&lt;web-app&gt;</span>
    ...
	<span style=color:#268bd2>&lt;servlet&gt;</span> <span style=color:#586e75>&lt;!-- #3 --&gt;</span>
        <span style=color:#268bd2>&lt;servlet-name&gt;</span>openapi<span style=color:#268bd2>&lt;/servlet-name&gt;</span>
        <span style=color:#268bd2>&lt;servlet-class&gt;</span>io.swagger.v3.jaxrs2.integration.OpenApiServlet<span style=color:#268bd2>&lt;/servlet-class&gt;</span>
    <span style=color:#268bd2>&lt;/servlet&gt;</span>
    <span style=color:#268bd2>&lt;servlet-mapping&gt;</span>
        <span style=color:#268bd2>&lt;servlet-name&gt;</span>openapi<span style=color:#268bd2>&lt;/servlet-name&gt;</span>
        <span style=color:#268bd2>&lt;url-pattern&gt;</span>/openapi.json<span style=color:#268bd2>&lt;/url-pattern&gt;</span>
        <span style=color:#268bd2>&lt;url-pattern&gt;</span>/openapi.yaml<span style=color:#268bd2>&lt;/url-pattern&gt;</span>
    <span style=color:#268bd2>&lt;/servlet-mapping&gt;</span>
<span style=color:#268bd2>&lt;/web-app&gt;</span>
</code></pre></div><p>重新启动应用之后，可以通过访问 &ldquo;http://localhost:8080/openapi.json&rdquo; 或者 &ldquo;http://localhost:8080/openapi.yaml&rdquo; 来访问暴露出的 openapi 的契约，以下是 yaml 格式的表述：</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#268bd2>openapi</span>: <span style=color:#2aa198>3.0.1</span>
<span style=color:#268bd2>paths</span>:
  /api/users/{id}:
    <span style=color:#268bd2>get</span>:
      <span style=color:#268bd2>operationId</span>: getUser
      <span style=color:#268bd2>parameters</span>:
      - <span style=color:#268bd2>name</span>: id
        <span style=color:#268bd2>in</span>: path
        <span style=color:#268bd2>required</span>: <span style=color:#cb4b16>true</span>
        <span style=color:#268bd2>schema</span>:
          <span style=color:#268bd2>type</span>: integer
          <span style=color:#268bd2>format</span>: int64
      <span style=color:#268bd2>responses</span>:
        <span style=color:#268bd2>default</span>:
          <span style=color:#268bd2>description</span>: default response
          <span style=color:#268bd2>content</span>:
            <span style=color:#268bd2>application/json</span>:
              <span style=color:#268bd2>schema</span>:
                <span style=color:#268bd2>$ref</span>: <span style=color:#2aa198>&#39;#/components/schemas/User&#39;</span>
            <span style=color:#268bd2>text/xml</span>:
              <span style=color:#268bd2>schema</span>:
                <span style=color:#268bd2>$ref</span>: <span style=color:#2aa198>&#39;#/components/schemas/User&#39;</span>
  <span style=color:#268bd2>/api/users/register</span>:
    <span style=color:#268bd2>post</span>:
      <span style=color:#268bd2>operationId</span>: registerUser
      <span style=color:#268bd2>requestBody</span>:
        <span style=color:#268bd2>description</span>: a user to register
        <span style=color:#268bd2>content</span>:
          <span style=color:#268bd2>application/json</span>:
            <span style=color:#268bd2>schema</span>:
              <span style=color:#268bd2>$ref</span>: <span style=color:#2aa198>&#39;#/components/schemas/User&#39;</span>
          <span style=color:#268bd2>text/xml</span>:
            <span style=color:#268bd2>schema</span>:
              <span style=color:#268bd2>$ref</span>: <span style=color:#2aa198>&#39;#/components/schemas/User&#39;</span>
      <span style=color:#268bd2>responses</span>:
        <span style=color:#268bd2>default</span>:
          <span style=color:#268bd2>description</span>: default response
          <span style=color:#268bd2>content</span>:
            <span style=color:#268bd2>application/json</span>:
              <span style=color:#268bd2>schema</span>:
                <span style=color:#268bd2>type</span>: integer
                <span style=color:#268bd2>format</span>: int64
            <span style=color:#268bd2>text/xml</span>:
              <span style=color:#268bd2>schema</span>:
                <span style=color:#268bd2>type</span>: integer
                <span style=color:#268bd2>format</span>: int64
<span style=color:#268bd2>components</span>:
  <span style=color:#268bd2>schemas</span>:
    <span style=color:#268bd2>User</span>:
      <span style=color:#268bd2>type</span>: object
      <span style=color:#268bd2>properties</span>:
        <span style=color:#268bd2>id</span>:
          <span style=color:#268bd2>type</span>: integer
          <span style=color:#268bd2>format</span>: int64
        <span style=color:#268bd2>name</span>:
          <span style=color:#268bd2>type</span>: string
</code></pre></div><h5 id=2-集成-swagger-ui>2. 集成 Swagger UI</h5><p>在 pom.xml 中继续增加 swagger-ui 的依赖，这里使用的是 webjars 的版本，从集成的角度来说更加简洁。webjars 的工作机制可以参阅 webjars 官网 <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>    <span style=color:#268bd2>&lt;properties&gt;</span>
        <span style=color:#268bd2>&lt;swagger.webjar.version&gt;</span>3.20.3<span style=color:#268bd2>&lt;/swagger.webjar.version&gt;</span>
    <span style=color:#268bd2>&lt;/properties&gt;</span>
    <span style=color:#268bd2>&lt;dependencies&gt;</span> 
        <span style=color:#268bd2>&lt;dependency&gt;</span>
            <span style=color:#268bd2>&lt;groupId&gt;</span>org.webjars<span style=color:#268bd2>&lt;/groupId&gt;</span>
            <span style=color:#268bd2>&lt;artifactId&gt;</span>swagger-ui<span style=color:#268bd2>&lt;/artifactId&gt;</span>
            <span style=color:#268bd2>&lt;version&gt;</span>${swagger.webjar.version}<span style=color:#268bd2>&lt;/version&gt;</span>
        <span style=color:#268bd2>&lt;/dependency&gt;</span>
    <span style=color:#268bd2>&lt;/dependencies&gt;</span>
</code></pre></div><p>在工程的 webapp/WEB-INF 根目录下增加一个 HTML 文件，内容如下。HTML 文件名可以为任何名字，没有硬性要求，如果该文件被命名为 &ldquo;swagger-ui.html&rdquo;，那么你可以通过访问 “http://localhost:8080/swagger-ui.html&rdquo; 来访问 swagger UI。本例为了演示方便起见，将其命名为 &ldquo;index.html&rdquo;，这样当访问 &ldquo;http://localhost:8080&rdquo; 时，就可以很方便的得到 swagger UI 的页面。</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=color:#719e07>&lt;!DOCTYPE html&gt;</span>
&lt;<span style=color:#268bd2>html</span> lang<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;en&#34;</span>&gt;
&lt;<span style=color:#268bd2>head</span>&gt;
    &lt;<span style=color:#268bd2>meta</span> charset<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;UTF-8&#34;</span>&gt;
    &lt;<span style=color:#268bd2>title</span>&gt;API UI&lt;/<span style=color:#268bd2>title</span>&gt;
    &lt;<span style=color:#268bd2>link</span> rel<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;stylesheet&#34;</span> type<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;text/css&#34;</span> href<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;webjars/swagger-ui/3.20.3/swagger-ui.css&#34;</span> &gt;
    &lt;<span style=color:#268bd2>link</span> rel<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;icon&#34;</span> type<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;image/png&#34;</span> href<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;webjars/swagger-ui/3.20.3/favicon-32x32.png&#34;</span> sizes<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;32x32&#34;</span> /&gt;
    &lt;<span style=color:#268bd2>link</span> rel<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;icon&#34;</span> type<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;image/png&#34;</span> href<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;webjars/swagger-ui/3.20.3/favicon-16x16.png&#34;</span> sizes<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;16x16&#34;</span> /&gt;
    &lt;<span style=color:#268bd2>style</span>&gt;
        <span style=color:#268bd2>html</span>
        {
            <span style=color:#719e07>box-sizing</span>: <span style=color:#cb4b16>border-box</span>;
            <span style=color:#719e07>overflow</span>: <span style=color:#719e07>-moz-</span>scrollbars-vertical;
            <span style=color:#719e07>overflow-y</span>: <span style=color:#cb4b16>scroll</span>;
        }

        <span style=color:#719e07>*,</span>
        <span style=color:#719e07>*</span>:<span style=color:#268bd2>before</span><span style=color:#719e07>,</span>
        <span style=color:#719e07>*</span>:<span style=color:#268bd2>after</span>
        {
            <span style=color:#719e07>box-sizing</span>: <span style=color:#cb4b16>inherit</span>;
        }

        <span style=color:#268bd2>body</span>
        {
            <span style=color:#719e07>margin</span>:<span style=color:#2aa198>0</span>;
            <span style=color:#719e07>background</span>: <span style=color:#2aa198>#fafafa</span>;
        }
    &lt;/<span style=color:#268bd2>style</span>&gt;
&lt;/<span style=color:#268bd2>head</span>&gt;

&lt;<span style=color:#268bd2>body</span>&gt;
&lt;<span style=color:#268bd2>div</span> id<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;swagger-ui&#34;</span>&gt;&lt;/<span style=color:#268bd2>div</span>&gt;

&lt;<span style=color:#268bd2>script</span> src<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;webjars/swagger-ui/3.20.3/swagger-ui-bundle.js&#34;</span>&gt; &lt;/<span style=color:#268bd2>script</span>&gt;
&lt;<span style=color:#268bd2>script</span> src<span style=color:#719e07>=</span><span style=color:#2aa198>&#34;webjars/swagger-ui/3.20.3/swagger-ui-standalone-preset.js&#34;</span>&gt; &lt;/<span style=color:#268bd2>script</span>&gt;
&lt;<span style=color:#268bd2>script</span>&gt;
    <span style=color:#b58900>window</span>.onload <span style=color:#719e07>=</span> <span style=color:#268bd2>function</span> () {
        <span style=color:#b58900>window</span>.ui <span style=color:#719e07>=</span> SwaggerUIBundle({
            url<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;openapi.json&#34;</span>,
            dom_id<span style=color:#719e07>:</span> <span style=color:#2aa198>&#39;#swagger-ui&#39;</span>,
            deepLinking<span style=color:#719e07>:</span> <span style=color:#cb4b16>true</span>,
            presets<span style=color:#719e07>:</span> [
                SwaggerUIBundle.presets.apis,
                SwaggerUIStandalonePreset
            ],
            plugins<span style=color:#719e07>:</span> [
                SwaggerUIBundle.plugins.DownloadUrl
            ],
            layout<span style=color:#719e07>:</span> <span style=color:#2aa198>&#34;StandaloneLayout&#34;</span>
        });
    };
&lt;/<span style=color:#268bd2>script</span>&gt;

&lt;/<span style=color:#268bd2>body</span>&gt;
&lt;/<span style=color:#268bd2>html</span>&gt;

</code></pre></div><p>再次重启服务器，并访问 &ldquo;http://localhost:8080&rdquo; 时，将会看到 swagger UI 页面的展示：</p><p><img src=../../img/blog/swagger-ui.png alt=swagger-ui></p><p>通过 Swagger UI 可以很方便的浏览当前服务器提供的 REST 服务的文档信息，甚至可以直接调用来做服务测试。以 &lsquo;/api/users/{id}&rsquo; 为例，测试结果如下图所示：</p><p><img src=../../img/blog/swagger-ui-execute.png alt=swagger-ui-execute></p><h2 id=总结>总结</h2><p>本文主要关注了在 Dubbo 中支持 REST 协议的情况。首先探索了 REST 概念的起源，澄清了 REST 是一种适合互联网的软件架构风格，进一步的说明了 REST 风格的架构可以与 HTTP 协议无关，但是 HTTP 协议的确是 REST 风格架构的最常用甚至是最佳的组合和搭档。然后讨论了如何在 Dubbo 中开发 REST HTTP 的几种典型用法，其中包括了通过不同的配置，如传统的 Spring XML，完全通过 annotation 来配置两种典型的用法，本文中没有涉及到的还有纯 API 编程方式，Spring Boot 配置方式也是完全可以的，因为篇幅原因没有提及；还讨论了如何通过不同的 REST server 来暴露 REST HTTP 服务，包括了 embedded tomcat，netty，以及外置的 servlet 容器等几种用法。最后，在外置的 servlet 容器的基础上，进一步的讨论了如何通过 Swagger 暴露 openAPI 以及集成 Swagger UI 的方法。</p><p>本文没有涉及的内容包含但不限于国际化支持、Dubbo REST 更高阶的注入扩展的用法、以及 Dubbo REST 支持未来的规划。其中 Dubbo REST 扩展的支持可以参考 <a href=https://github.com/beiwei30/dubbo-rest-samples/tree/master/extensions>https://github.com/beiwei30/dubbo-rest-samples/tree/master/extensions</a> 中的演示。以后有机会会开专门的篇幅来探讨更高级的 Swagger 的支持、以及对未来的展望。</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=http://en.wikipedia.org/wiki/Roy_Fielding>http://en.wikipedia.org/wiki/Roy_Fielding</a> <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm>http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm</a> <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://martinfowler.com/articles/richardsonMaturityModel.html>https://martinfowler.com/articles/richardsonMaturityModel.html</a> <a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href=https://github.com/dangdangdotcom/dubbox>https://github.com/dangdangdotcom/dubbox</a> <a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p><a href=https://www.webjars.org/documentation#servlet3>https://www.webjars.org/documentation#servlet3</a> <a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/zh/blog/2019/06/22/%E4%BD%BF%E7%94%A8-dubbo-%E8%BF%9E%E6%8E%A5%E5%BC%82%E6%9E%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BD%93%E7%B3%BB/ class="btn btn-primary"><span class=mr-1>←</span> 上一页</a></li><a href=/zh/blog/2019/08/11/%E6%9C%AC%E5%9C%B0%E8%B0%83%E7%94%A8/ class="btn btn-primary">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Dubbo mailing list archive" aria-label="Dubbo mailing list archive"><a class=text-white target=_blank rel="noopener noreferrer" href=https://lists.apache.org/list.html?dev@dubbo.apache.org><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/ApacheDubbo><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/apache/dubbo><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Subscribe to mailing list" aria-label="Subscribe to mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=mailto://dev-subscribe@dubbo.apache.org><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. All Rights Reserved</small></div></div></div></footer><div class="row pt-2 pb-2"><div class="container-fluid mx-sm-5"><div class=text-center id=my-footer><img style=float:left src=/imgs/apache_logo.png><ul><li><a href=http://www.apache.org>Foundation</a></li><li><a href=http://www.apache.org/licenses/>License</a></li><li><a href=https://www.apache.org/security/>Security</a></li><li><a href=http://www.apache.org/events/current-event>Events</a></li><li><a href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a href=http://www.apache.org/foundation/thanks.html>Thanks</a></li></ul></div></div></div></div><script src=/js/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js></script><script>docsearch({apiKey:'38eff7758162fbf70f2b8484932e62ae',indexName:'apache_dubbo',inputSelector:'.td-search-input',debug:false,});</script></body></html>