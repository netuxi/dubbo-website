<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文介绍了 Dubbo 服务导出的过程和实现细节"><link rel=icon href=assets/images/dubbo.svg><link rel="shortcut icon" href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.3"><title>服务导出 - Apache Dubbo</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6fb40bf7.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.cef4c379.min.css><meta name=theme-color content=#3f51b5><link rel=stylesheet href=../../../../css/dropdown.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-112489517-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property=og:type content=website><meta property=og:title content="Apache Dubbo - 服务导出"><meta property=og:description content="Apache Dubbo™ 是一款微服务框架（Microservices Framework），它提供高性能 RPC 通信、服务发现、流量管理等服务治理能力，为你提供构建大规模微服务集群所需的全套解决方案。"><meta property=og:url content=None><meta property=og:image content=assets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Apache Dubbo - 服务导出"><meta name=twitter:description content="Apache Dubbo™ 是一款微服务框架（Microservices Framework），它提供高性能 RPC 通信、服务发现、流量管理等服务治理能力，为你提供构建大规模微服务集群所需的全套解决方案。"><meta name=twitter:image content=assets/images/banner.png><link rel=stylesheet href=../../../../assets/stylesheets/overrides.011ebae6.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> <aside class=md-announce> <div class="md-announce__inner md-grid md-typeset"> <a href=https://dubbo.apache.org/en-us/docs/3.0/user/preface/background/ > Details of the next generation <strong>Dubbo 3.0</strong> <span class="twemoji twitter"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.73 11.93c0 1.72-.02 1.83-.23 2.07-.19.17-.38.23-.76.23l-.51.01-.03-2.27-.02-2.27h.52c.35 0 .6.07.77.21.24.21.26.25.26 2.02M22 7.5v9c0 1.11-.89 2-2 2H4c-1.11 0-2-.89-2-2v-9c0-1.11.89-2 2-2h16c1.11 0 2 .89 2 2M8.93 11.73c-.03-1.84-.05-1.99-.29-2.39-.4-.68-.85-.84-2.36-.84H5v7h1.21c1.33 0 1.89-.17 2.29-.71.41-.53.5-.98.43-3.06m4.19-3.23h-1.48c-1.49 0-1.5 0-1.71.28S9.7 9.21 9.7 12v2.96l.27.27c.25.27.31.27 1.71.27h1.44v-1.19l-1.09-.04-1.1-.03V12.6l.68-.03.66-.04v-1.19h-1.39V9.7h2.24V8.5m5.88.06c0-.06-.3-.06-.66-.06l-.68.06-.59 2.35c-.38 1.48-.62 2.27-.67 2.13-.08-.27-1.14-4.44-1.14-4.49 0-.05-.31-.05-.68-.05h-.69l.41 1.55c.2.87.59 2.28.81 3.15.34 1.35.46 1.65.75 1.94.2.22.45.36.61.36.33 0 .76-.34.9-.73C17.5 14.5 19 8.69 19 8.56z"/></svg> </span> </a> </div> </aside> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../../../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg width=20px height=20px role=img viewbox="-2.24 -0.24 324.74 78.74"><title>Dubbo logo</title><defs><lineargradient id=a x1=4.06 x2=316.39 y1=39.27 y2=39.27 gradientunits=userSpaceOnUse><stop offset=0 stop-color=#8953ff /><stop offset=1 stop-color=#00e0e3 /></lineargradient></defs><path fill=url(#a) d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25h-50.9zm21.24-28h8.6V31h-8.6zm0 22.25h8.6v8.6h-8.6zM33.24 7.25H4.06v64h29.18c10.95 0 19.3-7.18 23.29-17.15a45.12 45.12 0 0 0 2.38-14.87 45.12 45.12 0 0 0-2.38-14.83C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63h-3.33a3.44 3.44 0 0 0-3.44 3.44v27.91a3.44 3.44 0 0 0 3.44 3.44h3.33v4.63h-8.3a6.87 6.87 0 0 1-6.87-6.87V24.12a6.87 6.87 0 0 1 6.87-6.87h8.3zM285.51 6.06c-17.05 0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21-13.83-33.21-30.88-33.21zm7.59 48.36a6.87 6.87 0 0 1-6.87 6.87h-8.3v-4.62h3.33a3.44 3.44 0 0 0 3.44-3.44V25.31a3.44 3.44 0 0 0-3.44-3.44h-3.33v-4.62h8.3a6.87 6.87 0 0 1 6.87 6.87zm-53.4-17.56a17.39 17.39 0 0 0-12.39-29.61H195.1v64h32.21a19.44 19.44 0 0 0 12.38-34.44zm-28.07 24.43h-6.08l18.68-44h6.08zM177 36.85a17.39 17.39 0 0 0-12.35-29.6h-32.22v64h32.21A19.44 19.44 0 0 0 177 36.85zm-28 24.44h-6.08l18.68-44h6.08z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> 服务导出 </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <!-- Home page --> <li class=md-tabs__item> <a href=../../../.. class="md-tabs__link md-tabs__link--active"> 首页 </a> </li> <!-- Main navigation item with nested items --> <!-- Home page --> <li class="md-tabs__item md-tabs_csr"> <a class="md-tabs__link md-tabs__link--active">文档</a> <ul class="md-tabs__list md-sub-tabs_bn"> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../2.7/user/preface/background/ class=md-tabs__link>2.7</a> </li> <!-- Render item --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../user/preface/background/ class=md-tabs__link>3.0</a> </li> <!-- Render item --> </ul> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../blog/dubbo-practice-from-guazi/ class=md-sub-tabs_link>Blog</a> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../developers/guide_dev/ class=md-sub-tabs_link>开发者指引</a> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../blog/download/ class=md-sub-tabs_link>下载</a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg width=20px height=20px role=img viewbox="-2.24 -0.24 324.74 78.74"><title>Dubbo logo</title><defs><lineargradient id=a x1=4.06 x2=316.39 y1=39.27 y2=39.27 gradientunits=userSpaceOnUse><stop offset=0 stop-color=#8953ff /><stop offset=1 stop-color=#00e0e3 /></lineargradient></defs><path fill=url(#a) d="M68.46 50.38c0 14.06 11.39 22.11 25.45 22.11s25.45-8.05 25.45-22.11V7.25h-50.9zm21.24-28h8.6V31h-8.6zm0 22.25h8.6v8.6h-8.6zM33.24 7.25H4.06v64h29.18c10.95 0 19.3-7.18 23.29-17.15a45.12 45.12 0 0 0 2.38-14.87 45.12 45.12 0 0 0-2.38-14.83C52.84 14.62 44.19 7.25 33.24 7.25zm.43 14.63h-3.33a3.44 3.44 0 0 0-3.44 3.44v27.91a3.44 3.44 0 0 0 3.44 3.44h3.33v4.63h-8.3a6.87 6.87 0 0 1-6.87-6.87V24.12a6.87 6.87 0 0 1 6.87-6.87h8.3zM285.51 6.06c-17.05 0-30.88 10.28-30.88 33.21s13.83 33.21 30.88 33.21 30.88-10.28 30.88-33.21-13.83-33.21-30.88-33.21zm7.59 48.36a6.87 6.87 0 0 1-6.87 6.87h-8.3v-4.62h3.33a3.44 3.44 0 0 0 3.44-3.44V25.31a3.44 3.44 0 0 0-3.44-3.44h-3.33v-4.62h8.3a6.87 6.87 0 0 1 6.87 6.87zm-53.4-17.56a17.39 17.39 0 0 0-12.39-29.61H195.1v64h32.21a19.44 19.44 0 0 0 12.38-34.44zm-28.07 24.43h-6.08l18.68-44h6.08zM177 36.85a17.39 17.39 0 0 0-12.35-29.6h-32.22v64h32.21A19.44 19.44 0 0 0 177 36.85zm-28 24.44h-6.08l18.68-44h6.08z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/config-center/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/build/ title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/design/ title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/SPI/ title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/implementation/ title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/protocol/ title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/filter/ title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/invoker-listener/ title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/exporter-listener/ title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/cluster/ title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/router/ title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/load-balance/ title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/merger/ title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/registry/ title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/monitor/ title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/extension-factory/ title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/proxy-factory/ title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/compiler/ title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/dispatcher/ title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/threadpool/ title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/serialize/ title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/remoting/ title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/exchanger/ title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/networker/ title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/telnet-handler/ title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/status-checker/ title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/container/ title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/page/ title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/cache/ title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/validation/ title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/logger-adapter/ title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/impls/config-center/ title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/contract/ title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/coding/ title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/code-detail/ title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/general-knowledge/ title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/expansibility/ title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/configuration/ title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/robustness/ title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/dummy/ title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/principals/extension/ title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/release/ title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/contribution/ title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/checklist/ title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/code-smell/ title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/dev/TCK/ title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 源码导读 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=源码导读 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 源码导读 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/dubbo-spi/ title="Dubbo SPI" class=md-nav__link> Dubbo SPI </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/adaptive-extension/ title=自适应拓展机制 class=md-nav__link> 自适应拓展机制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/export-service/ title=服务导出 class=md-nav__link> 服务导出 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/refer-service/ title=服务引入 class=md-nav__link> 服务引入 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/directory/ title=服务字典 class=md-nav__link> 服务字典 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/router/ title=服务路由 class=md-nav__link> 服务路由 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/cluster/ title=集群 class=md-nav__link> 集群 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/source_code_guide/service-invoking-process/ title=服务调用过程 class=md-nav__link> 服务调用过程 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-4 type=checkbox id=nav-1-4> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-4> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/admin/introduction/ title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/admin/serviceSearch/ title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/admin/serviceGovernance/ title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/admin/serviceTest/ title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> User's Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="User's Guide" data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> User's Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> Preface <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Preface data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Preface </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/background/ title=Bakcground class=md-nav__link> Bakcground </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> Blog <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-practice-from-guazi/ title=dubbo在瓜子二手车的实践 class=md-nav__link> dubbo在瓜子二手车的实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/apache-dubbo-2019-2020/ title=2019-2020回顾 class=md-nav__link> 2019-2020回顾 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/2.7.5-release/ title="2.7.5 里程碑版本正式发布：支持 gRPC、性能提升 30%" class=md-nav__link> 2.7.5 里程碑版本正式发布：支持 gRPC、性能提升 30% </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/Dubbo-supporting-gRPC-HTTP2-and-protobuf/ title="Dubbo 在跨语言和协议穿透性方向上的探索：支持 HTTP/2 gRPC 和 Protobuf" class=md-nav__link> Dubbo 在跨语言和协议穿透性方向上的探索：支持 HTTP/2 gRPC 和 Protobuf </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/connect-heterogeneous-microservices/ title="使用 Dubbo 连接异构微服务体系" class=md-nav__link> 使用 Dubbo 连接异构微服务体系 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/service-test/ title=服务测试 class=md-nav__link> 服务测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_server/ title=Dubbo服务端异步接口的实现背景和实践 class=md-nav__link> Dubbo服务端异步接口的实现背景和实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_client/ title=Dubbo客户端异步接口的实现背景和实践 class=md-nav__link> Dubbo客户端异步接口的实现背景和实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-fescar/ title=如何使用Fescar保证Dubbo微服务间的一致性 class=md-nav__link> 如何使用Fescar保证Dubbo微服务间的一致性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/prepare-an-apache-release/ title="如何准备Apache Release" class=md-nav__link> 如何准备Apache Release </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-protocol/ title="Dubbo protocol" class=md-nav__link> Dubbo protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-101/ title="第一个 Dubbo 应用" class=md-nav__link> 第一个 Dubbo 应用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/first-dubbo-filter/ title="第一个Dubbo Filter" class=md-nav__link> 第一个Dubbo Filter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-zk/ title="在 Dubbo 应用中使用 Zookeeper" class=md-nav__link> 在 Dubbo 应用中使用 Zookeeper </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-annotation/ title="在 Dubbo 中使用注解" class=md-nav__link> 在 Dubbo 中使用注解 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi/ title=Dubbo可扩展机制实战 class=md-nav__link> Dubbo可扩展机制实战 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/spring-boot-dubbo-start-stop-analysis/ title="Spring Boot Dubbo应用启停源码分析" class=md-nav__link> Spring Boot Dubbo应用启停源码分析 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi-2/ title=Dubbo可扩展机制源码解析 class=md-nav__link> Dubbo可扩展机制源码解析 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-qos/ title=通过QoS对服务进行动态控制 class=md-nav__link> 通过QoS对服务进行动态控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-loadbalance/ title=Dubbo的负载均衡 class=md-nav__link> Dubbo的负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/sentinel-introduction-for-dubbo/ title="Sentinel 为 Dubbo 服务保驾护航" class=md-nav__link> Sentinel 为 Dubbo 服务保驾护航 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/pinpoint/ title=使用Pinpoint做分布式跟踪 class=md-nav__link> 使用Pinpoint做分布式跟踪 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 开发者指引 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发者指引 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发者指引 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/guide_dev/ title=如何做出贡献 class=md-nav__link> 如何做出贡献 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/developers_dev/ title=开发者 class=md-nav__link> 开发者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 使用指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=使用指南 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 使用指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/user-guide/faq_dev/ title=faq class=md-nav__link> faq </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-4 type=checkbox id=nav-1-4> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-4> 贡献者指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=贡献者指南 data-md-level=2> <label class=md-nav__title for=nav-1-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 贡献者指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/new-contributor-guide_dev/ title="New contributor guide" class=md-nav__link> New contributor guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/software-donation-guide_dev/ title="Software donation guide" class=md-nav__link> Software donation guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/test-coverage-guide_dev/ title="Test coverage guide" class=md-nav__link> Test coverage guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/mailing-list-subscription-guide_dev/ title="Mailing list subscription guide" class=md-nav__link> Mailing list subscription guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/cla-signing-guide_dev/ title="CLA Signing Guide" class=md-nav__link> CLA Signing Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/dubbo-extension-guide_dev/ title="Extension guide" class=md-nav__link> Extension guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/become-a-committer_dev/ title="How to become a committer" class=md-nav__link> How to become a committer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/reporting-security-issues_dev.md title="How to report security issues" class=md-nav__link> How to report security issues </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-5 type=checkbox id=nav-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-5> 提交者指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=提交者指南 data-md-level=2> <label class=md-nav__title for=nav-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 提交者指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/new-committer-guide_dev/ title="New Committer guide" class=md-nav__link> New Committer guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/label-an-issue-guide_dev/ title="Label an Issue" class=md-nav__link> Label an Issue </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/website-guide_dev/ title="Website Guide" class=md-nav__link> Website Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/apache-dubbo-page_dev/ title="Apache Dubbo Page Maintenance" class=md-nav__link> Apache Dubbo Page Maintenance </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/release-guide_dev/ title="Release Guide" class=md-nav__link> Release Guide </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 下载 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=下载 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 下载 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/download/ title=版本列表 class=md-nav__link> 版本列表 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1.简介 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2.源码分析 </a> <nav class=md-nav aria-label=2.源码分析> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 前置工作 </a> <nav class=md-nav aria-label="2.1 前置工作"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#211 class=md-nav__link> 2.1.1 检查配置 </a> </li> <li class=md-nav__item> <a href=#212 class=md-nav__link> 2.1.2 多协议多注册中心导出服务 </a> </li> <li class=md-nav__item> <a href=#213-url class=md-nav__link> 2.1.3 组装 URL </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#22-dubbo class=md-nav__link> 2.2 导出 Dubbo 服务 </a> </li> <li class=md-nav__item> <a href=#221-invoker class=md-nav__link> 2.2.1 Invoker 创建过程 </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> 2.2.2 导出服务到本地 </a> </li> <li class=md-nav__item> <a href=#223 class=md-nav__link> 2.2.3 导出服务到远程 </a> </li> <li class=md-nav__item> <a href=#224 class=md-nav__link> 2.2.4 服务注册 </a> <nav class=md-nav aria-label="2.2.4 服务注册"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2241 class=md-nav__link> 2.2.4.1 创建注册中心 </a> </li> <li class=md-nav__item> <a href=#2242 class=md-nav__link> 2.2.4.2 节点创建 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#225-override class=md-nav__link> 2.2.5 订阅 override 数据 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3.总结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/docs/3.0/source_code_guide/export-service.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>服务导出</h1> <h2 id=1>1.简介<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>本篇文章，我们来研究一下 Dubbo 导出服务的过程。Dubbo 服务导出过程始于 Spring 容器发布刷新事件，Dubbo 在接收到事件后，会立即执行服务导出逻辑。整个逻辑大致可分为三个部分，第一部分是前置工作，主要用于检查参数，组装 URL。第二部分是导出服务，包含导出服务到本地 (JVM)，和导出服务到远程两个过程。第三部分是向注册中心注册服务，用于服务发现。本篇文章将会对这三个部分代码进行详细的分析。</p> <h2 id=2>2.源码分析<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>服务导出的入口方法是 ServiceBean 的 onApplicationEvent。onApplicationEvent 是一个事件响应方法，该方法会在收到 Spring 上下文刷新事件后执行服务导出操作。方法代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kt>void</span> <span class=nf>onApplicationEvent</span><span class=p>(</span><span class=n>ContextRefreshedEvent</span> <span class=n>event</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 是否有延迟导出 &amp;&amp; 是否已导出 &amp;&amp; 是不是已被取消导出</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isDelay</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>isExported</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>isUnexported</span><span class=p>())</span> <span class=p>{</span>
        <span class=c1>// 导出服务</span>
        <span class=n>export</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>这个方法首先会根据条件决定是否导出服务，比如有些服务设置了延时导出，那么此时就不应该在此处导出。还有一些服务已经被导出了，或者当前服务被取消导出了，此时也不能再次导出相关服务。注意这里的 isDelay 方法，这个方法字面意思是“是否延迟导出服务”，返回 true 表示延迟导出，false 表示不延迟导出。但是该方法真实意思却并非如此，当方法返回 true 时，表示无需延迟导出。返回 false 时，表示需要延迟导出。与字面意思恰恰相反，这个需要大家注意一下。下面我们来看一下这个方法的逻辑。</p> <div class=highlight><pre><span></span><code><span class=c1>// -☆- ServiceBean</span>
<span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>isDelay</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 获取 delay</span>
    <span class=n>Integer</span> <span class=n>delay</span> <span class=o>=</span> <span class=n>getDelay</span><span class=p>();</span>
    <span class=n>ProviderConfig</span> <span class=n>provider</span> <span class=o>=</span> <span class=n>getProvider</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>delay</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>provider</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 如果前面获取的 delay 为空，这里继续获取</span>
        <span class=n>delay</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getDelay</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=c1>// 判断 delay 是否为空，或者等于 -1</span>
    <span class=k>return</span> <span class=n>supportedApplicationListener</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>delay</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>delay</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>暂时忽略 supportedApplicationListener 这个条件，当 delay 为空，或者等于-1时，该方法返回 true，而不是 false。这个方法的返回值让人有点困惑。该方法目前已被重构，详细请参考 <a href=https://github.com/apache/dubbo/pull/2686>dubbo #2686</a>。</p> <p>现在解释一下 supportedApplicationListener 变量含义，该变量用于表示当前的 Spring 容器是否支持 ApplicationListener，这个值初始为 false。在 Spring 容器将自己设置到 ServiceBean 中时，ServiceBean 的 setApplicationContext 方法会检测 Spring 容器是否支持 ApplicationListener。若支持，则将 supportedApplicationListener 置为 true。ServiceBean 是 Dubbo 与 Spring 框架进行整合的关键，可以看做是两个框架之间的桥梁。具有同样作用的类还有 ReferenceBean。</p> <p>现在我们知道了 Dubbo 服务导出过程的起点，接下来对服务导出的前置逻辑进行分析。</p> <h3 id=21>2.1 前置工作<a class=headerlink href=#21 title="Permanent link">&para;</a></h3> <p>前置工作主要包含两个部分，分别是配置检查，以及 URL 装配。在导出服务之前，Dubbo 需要检查用户的配置是否合理，或者为用户补充缺省配置。配置检查完成后，接下来需要根据这些配置组装 URL。在 Dubbo 中，URL 的作用十分重要。Dubbo 使用 URL 作为配置载体，所有的拓展点都是通过 URL 获取配置。这一点，官方文档中有所说明。</p> <blockquote> <p>采用 URL 作为配置信息的统一格式，所有扩展点都通过传递 URL 携带配置信息。</p> </blockquote> <p>接下来，我们先来分析配置检查部分的源码，随后再来分析 URL 组装部分的源码。</p> <h4 id=211>2.1.1 检查配置<a class=headerlink href=#211 title="Permanent link">&para;</a></h4> <p>本节我们接着前面的源码向下分析，前面说过 onApplicationEvent 方法在经过一些判断后，会决定是否调用 export 方法导出服务。那么下面我们从 export 方法开始进行分析，如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>export</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>provider</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 获取 export 和 delay 配置</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>export</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>export</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getExport</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>delay</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>delay</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getDelay</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// 如果 export 为 false，则不导出服务</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>export</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>export</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=c1>// delay &gt; 0，延时导出服务</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>delay</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>delay</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>delayExportExecutor</span><span class=p>.</span><span class=na>schedule</span><span class=p>(</span><span class=k>new</span> <span class=n>Runnable</span><span class=p>()</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>doExport</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>},</span> <span class=n>delay</span><span class=p>,</span> <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>);</span>

    <span class=c1>// 立即导出服务</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>doExport</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>export 方法对两项配置进行了检查，并根据配置执行相应的动作。首先是 export 配置，这个配置决定了是否导出服务。有时候我们只是想本地启动服务进行一些调试工作，我们并不希望把本地启动的服务暴露出去给别人调用。此时，我们可通过配置 export 禁止服务导出，比如：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:provider</span> <span class=na>export=</span><span class=s>&quot;false&quot;</span> <span class=nt>/&gt;</span>
</code></pre></div> <p>delay 配置顾名思义，用于延迟导出服务，这个就不分析了。下面，我们继续分析源码，这次要分析的是 doExport 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>protected</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>doExport</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>unexported</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Already unexported!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>exported</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>exported</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
    <span class=c1>// 检测 interfaceName 是否合法</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>interfaceName</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>interfaceName</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;interface not allow null!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 检测 provider 是否为空，为空则新建一个，并通过系统变量为其初始化</span>
    <span class=n>checkDefault</span><span class=p>();</span>

    <span class=c1>// 下面几个 if 语句用于检测 provider、application 等核心配置类对象是否为空，</span>
    <span class=c1>// 若为空，则尝试从其他配置类对象中获取相应的实例。</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>provider</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>application</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>application</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getApplication</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>module</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>module</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getModule</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{...}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{...}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>protocols</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{...}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>module</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>registries</span> <span class=o>=</span> <span class=n>module</span><span class=p>.</span><span class=na>getRegistries</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{...}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>application</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>registries</span> <span class=o>=</span> <span class=n>application</span><span class=p>.</span><span class=na>getRegistries</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{...}</span>
    <span class=p>}</span>

    <span class=c1>// 检测 ref 是否为泛化服务类型</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ref</span> <span class=k>instanceof</span> <span class=n>GenericService</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 设置 interfaceClass 为 GenericService.class</span>
        <span class=n>interfaceClass</span> <span class=o>=</span> <span class=n>GenericService</span><span class=p>.</span><span class=na>class</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>(</span><span class=n>generic</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// 设置 generic = &quot;true&quot;</span>
            <span class=n>generic</span> <span class=o>=</span> <span class=n>Boolean</span><span class=p>.</span><span class=na>TRUE</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>
        <span class=p>}</span>

    <span class=c1>// ref 非 GenericService 类型</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>interfaceClass</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>()</span>
                    <span class=p>.</span><span class=na>getContextClassLoader</span><span class=p>());</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=c1>// 对 interfaceClass，以及 &lt;dubbo:method&gt; 标签中的必要字段进行检查</span>
        <span class=n>checkInterfaceAndMethods</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>methods</span><span class=p>);</span>
        <span class=c1>// 对 ref 合法性进行检测</span>
        <span class=n>checkRef</span><span class=p>();</span>
        <span class=c1>// 设置 generic = &quot;false&quot;</span>
        <span class=n>generic</span> <span class=o>=</span> <span class=n>Boolean</span><span class=p>.</span><span class=na>FALSE</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=c1>// local 和 stub 在功能应该是一致的，用于配置本地存根</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>local</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=s>&quot;true&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>local</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>local</span> <span class=o>=</span> <span class=n>interfaceName</span> <span class=o>+</span> <span class=s>&quot;Local&quot;</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>localClass</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 获取本地存根类</span>
            <span class=n>localClass</span> <span class=o>=</span> <span class=n>ClassHelper</span><span class=p>.</span><span class=na>forNameWithThreadContextClassLoader</span><span class=p>(</span><span class=n>local</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=c1>// 检测本地存根类是否可赋值给接口类，若不可赋值则会抛出异常，提醒使用者本地存根类类型不合法</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>interfaceClass</span><span class=p>.</span><span class=na>isAssignableFrom</span><span class=p>(</span><span class=n>localClass</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;The local implementation class &quot;</span> <span class=o>+</span> <span class=n>localClass</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; not implement interface &quot;</span> <span class=o>+</span> <span class=n>interfaceName</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>stub</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 此处的代码和上一个 if 分支的代码基本一致，这里省略</span>
    <span class=p>}</span>

    <span class=c1>// 检测各种对象是否为空，为空则新建，或者抛出异常</span>
    <span class=n>checkApplication</span><span class=p>();</span>
    <span class=n>checkRegistry</span><span class=p>();</span>
    <span class=n>checkProtocol</span><span class=p>();</span>
    <span class=n>appendProperties</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=n>checkStubAndMock</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>path</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>path</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>path</span> <span class=o>=</span> <span class=n>interfaceName</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=c1>// 导出服务</span>
    <span class=n>doExportUrls</span><span class=p>();</span>

    <span class=c1>// ProviderModel 表示服务提供者模型，此对象中存储了与服务提供者相关的信息。</span>
    <span class=c1>// 比如服务的配置信息，服务实例等。每个被导出的服务对应一个 ProviderModel。</span>
    <span class=c1>// ApplicationModel 持有所有的 ProviderModel。</span>
    <span class=n>ProviderModel</span> <span class=n>providerModel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ProviderModel</span><span class=p>(</span><span class=n>getUniqueServiceName</span><span class=p>(),</span> <span class=k>this</span><span class=p>,</span> <span class=n>ref</span><span class=p>);</span>
    <span class=n>ApplicationModel</span><span class=p>.</span><span class=na>initProviderModel</span><span class=p>(</span><span class=n>getUniqueServiceName</span><span class=p>(),</span> <span class=n>providerModel</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>以上就是配置检查的相关分析，代码比较多，需要大家耐心看一下。下面对配置检查的逻辑进行简单的总结，如下：</p> <ol> <li>检测 \&lt;dubbo:service> 标签的 interface 属性合法性，不合法则抛出异常</li> <li>检测 ProviderConfig、ApplicationConfig 等核心配置类对象是否为空，若为空，则尝试从其他配置类对象中获取相应的实例。</li> <li>检测并处理泛化服务和普通服务类</li> <li>检测本地存根配置，并进行相应的处理</li> <li>对 ApplicationConfig、RegistryConfig 等配置类进行检测，为空则尝试创建，若无法创建则抛出异常</li> </ol> <p>配置检查并非本文重点，因此这里不打算对 doExport 方法所调用的方法进行分析（doExportUrls 方法除外）。在这些方法中，除了 appendProperties 方法稍微复杂一些，其他方法逻辑不是很复杂。因此，大家可自行分析。</p> <h4 id=212>2.1.2 多协议多注册中心导出服务<a class=headerlink href=#212 title="Permanent link">&para;</a></h4> <p>Dubbo 允许我们使用不同的协议导出服务，也允许我们向多个注册中心注册服务。Dubbo 在 doExportUrls 方法中对多协议，多注册中心进行了支持。相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>doExportUrls</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 加载注册中心链接</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>registryURLs</span> <span class=o>=</span> <span class=n>loadRegistries</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
    <span class=c1>// 遍历 protocols，并在每个协议下导出服务</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>ProtocolConfig</span> <span class=n>protocolConfig</span> <span class=p>:</span> <span class=n>protocols</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>doExportUrlsFor1Protocol</span><span class=p>(</span><span class=n>protocolConfig</span><span class=p>,</span> <span class=n>registryURLs</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码首先是通过 loadRegistries 加载注册中心链接，然后再遍历 ProtocolConfig 集合导出每个服务。并在导出服务的过程中，将服务注册到注册中心。下面，我们先来看一下 loadRegistries 方法的逻辑。</p> <div class=highlight><pre><span></span><code><span class=kd>protected</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=nf>loadRegistries</span><span class=p>(</span><span class=kt>boolean</span> <span class=n>provider</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 检测是否存在注册中心配置类，不存在则抛出异常</span>
    <span class=n>checkRegistry</span><span class=p>();</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>registryList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>registries</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>RegistryConfig</span> <span class=n>config</span> <span class=p>:</span> <span class=n>registries</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>address</span> <span class=o>=</span> <span class=n>config</span><span class=p>.</span><span class=na>getAddress</span><span class=p>();</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>address</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>address</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 若 address 为空，则将其设为 0.0.0.0</span>
                <span class=n>address</span> <span class=o>=</span> <span class=n>Constants</span><span class=p>.</span><span class=na>ANYHOST_VALUE</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=c1>// 从系统属性中加载注册中心地址</span>
            <span class=n>String</span> <span class=n>sysaddress</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;dubbo.registry.address&quot;</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>sysaddress</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>sysaddress</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>address</span> <span class=o>=</span> <span class=n>sysaddress</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=c1>// 检测 address 是否合法</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>address</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>RegistryConfig</span><span class=p>.</span><span class=na>NO_AVAILABLE</span><span class=p>.</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>address</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>
                <span class=c1>// 添加 ApplicationConfig 中的字段信息到 map 中</span>
                <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>application</span><span class=p>);</span>
                <span class=c1>// 添加 RegistryConfig 字段信息到 map 中</span>
                <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>config</span><span class=p>);</span>

                <span class=c1>// 添加 path、pid，protocol 等信息到 map 中</span>
                <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;path&quot;</span><span class=p>,</span> <span class=n>RegistryService</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
                <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;dubbo&quot;</span><span class=p>,</span> <span class=n>Version</span><span class=p>.</span><span class=na>getProtocolVersion</span><span class=p>());</span>
                <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>TIMESTAMP_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()));</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PID_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()));</span>
                <span class=p>}</span>
                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>map</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=s>&quot;protocol&quot;</span><span class=p>))</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>RegistryFactory</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>hasExtension</span><span class=p>(</span><span class=s>&quot;remote&quot;</span><span class=p>))</span> <span class=p>{</span>
                        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;protocol&quot;</span><span class=p>,</span> <span class=s>&quot;remote&quot;</span><span class=p>);</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;protocol&quot;</span><span class=p>,</span> <span class=s>&quot;dubbo&quot;</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>

                <span class=c1>// 解析得到 URL 列表，address 可能包含多个注册中心 ip，</span>
                <span class=c1>// 因此解析得到的是一个 URL 列表</span>
                <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>urls</span> <span class=o>=</span> <span class=n>UrlUtils</span><span class=p>.</span><span class=na>parseURLs</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=n>map</span><span class=p>);</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>URL</span> <span class=n>url</span> <span class=p>:</span> <span class=n>urls</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_KEY</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>());</span>
                    <span class=c1>// 将 URL 协议头设置为 registry</span>
                    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>setProtocol</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_PROTOCOL</span><span class=p>);</span>
                    <span class=c1>// 通过判断条件，决定是否添加 url 到 registryList 中，条件如下：</span>
                    <span class=c1>// (服务提供者 &amp;&amp; register = true 或 null) </span>
                    <span class=c1>//    || (非服务提供者 &amp;&amp; subscribe = true 或 null)</span>
                    <span class=k>if</span> <span class=p>((</span><span class=n>provider</span> <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTER_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span>
                            <span class=o>||</span> <span class=p>(</span><span class=o>!</span><span class=n>provider</span> <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SUBSCRIBE_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>)))</span> <span class=p>{</span>
                        <span class=n>registryList</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>registryList</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>loadRegistries 方法主要包含如下的逻辑：</p> <ol> <li>检测是否存在注册中心配置类，不存在则抛出异常</li> <li>构建参数映射集合，也就是 map</li> <li>构建注册中心链接列表</li> <li>遍历链接列表，并根据条件决定是否将其添加到 registryList 中</li> </ol> <p>关于多协议多注册中心导出服务就先分析到这，代码不是很多，接下来分析 URL 组装过程。</p> <h4 id=213-url>2.1.3 组装 URL<a class=headerlink href=#213-url title="Permanent link">&para;</a></h4> <p>配置检查完毕后，紧接着要做的事情是根据配置，以及其他一些信息组装 URL。前面说过，URL 是 Dubbo 配置的载体，通过 URL 可让 Dubbo 的各种配置在各个模块之间传递。URL 之于 Dubbo，犹如水之于鱼，非常重要。大家在阅读 Dubbo 服务导出相关源码的过程中，要注意 URL 内容的变化。既然 URL 如此重要，那么下面我们来了解一下 URL 组装的过程。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>doExportUrlsFor1Protocol</span><span class=p>(</span><span class=n>ProtocolConfig</span> <span class=n>protocolConfig</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>registryURLs</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>protocolConfig</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
    <span class=c1>// 如果协议名为空，或空串，则将协议名变量设置为 dubbo</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>name</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>name</span> <span class=o>=</span> <span class=s>&quot;dubbo&quot;</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=c1>// 添加 side、版本、时间戳以及进程号等信息到 map 中</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SIDE_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>PROVIDER_SIDE</span><span class=p>);</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DUBBO_VERSION_KEY</span><span class=p>,</span> <span class=n>Version</span><span class=p>.</span><span class=na>getProtocolVersion</span><span class=p>());</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>TIMESTAMP_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()));</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PID_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()));</span>
    <span class=p>}</span>

    <span class=c1>// 通过反射将对象的字段信息添加到 map 中</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>application</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>module</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>provider</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_KEY</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>protocolConfig</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=k>this</span><span class=p>);</span>

    <span class=c1>// methods 为 MethodConfig 集合，MethodConfig 中存储了 &lt;dubbo:method&gt; 标签的配置信息</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>methods</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>methods</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
        <span class=c1>// 这段代码用于添加 Callback 配置到 map 中，代码太长，待会单独分析</span>
    <span class=p>}</span>

    <span class=c1>// 检测 generic 是否为 &quot;true&quot;，并根据检测结果向 map 中添加不同的信息</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ProtocolUtils</span><span class=p>.</span><span class=na>isGeneric</span><span class=p>(</span><span class=n>generic</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>GENERIC_KEY</span><span class=p>,</span> <span class=n>generic</span><span class=p>);</span>
        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>METHODS_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>ANY_VALUE</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>revision</span> <span class=o>=</span> <span class=n>Version</span><span class=p>.</span><span class=na>getVersion</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>version</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>revision</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>revision</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;revision&quot;</span><span class=p>,</span> <span class=n>revision</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 为接口生成包裹类 Wrapper，Wrapper 中包含了接口的详细信息，比如接口方法名数组，字段信息等</span>
        <span class=n>String</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>Wrapper</span><span class=p>.</span><span class=na>getWrapper</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>).</span><span class=na>getMethodNames</span><span class=p>();</span>
        <span class=c1>// 添加方法名到 map 中，如果包含多个方法名，则用逗号隔开，比如 method = init,destroy</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>methods</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>logger</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=s>&quot;NO method found in service interface ...&quot;</span><span class=p>);</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>METHODS_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>ANY_VALUE</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// 将逗号作为分隔符连接方法名，并将连接后的字符串放入 map 中</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>METHODS_KEY</span><span class=p>,</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>methods</span><span class=p>)),</span> <span class=s>&quot;,&quot;</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 添加 token 到 map 中</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>(</span><span class=n>token</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>isDefault</span><span class=p>(</span><span class=n>token</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// 随机生成 token</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>TOKEN_KEY</span><span class=p>,</span> <span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>().</span><span class=na>toString</span><span class=p>());</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>TOKEN_KEY</span><span class=p>,</span> <span class=n>token</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// 判断协议名是否为 injvm</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>LOCAL_PROTOCOL</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>protocolConfig</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span> <span class=p>{</span>
        <span class=n>protocolConfig</span><span class=p>.</span><span class=na>setRegister</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;notify&quot;</span><span class=p>,</span> <span class=s>&quot;false&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 获取上下文路径</span>
    <span class=n>String</span> <span class=n>contextPath</span> <span class=o>=</span> <span class=n>protocolConfig</span><span class=p>.</span><span class=na>getContextpath</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>((</span><span class=n>contextPath</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>contextPath</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>provider</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>contextPath</span> <span class=o>=</span> <span class=n>provider</span><span class=p>.</span><span class=na>getContextpath</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=c1>// 获取 host 和 port</span>
    <span class=n>String</span> <span class=n>host</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=na>findConfigedHosts</span><span class=p>(</span><span class=n>protocolConfig</span><span class=p>,</span> <span class=n>registryURLs</span><span class=p>,</span> <span class=n>map</span><span class=p>);</span>
    <span class=n>Integer</span> <span class=n>port</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=na>findConfigedPorts</span><span class=p>(</span><span class=n>protocolConfig</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>map</span><span class=p>);</span>
    <span class=c1>// 组装 URL</span>
    <span class=n>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>host</span><span class=p>,</span> <span class=n>port</span><span class=p>,</span> <span class=p>(</span><span class=n>contextPath</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>contextPath</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>?</span> <span class=s>&quot;&quot;</span> <span class=p>:</span> <span class=n>contextPath</span> <span class=o>+</span> <span class=s>&quot;/&quot;</span><span class=p>)</span> <span class=o>+</span> <span class=n>path</span><span class=p>,</span> <span class=n>map</span><span class=p>);</span>

    <span class=c1>// 省略无关代码</span>
<span class=p>}</span>
</code></pre></div> <p>上面的代码首先是将一些信息，比如版本、时间戳、方法名以及各种配置对象的字段信息放入到 map 中，map 中的内容将作为 URL 的查询字符串。构建好 map 后，紧接着是获取上下文路径、主机名以及端口号等信息。最后将 map 和主机名等数据传给 URL 构造方法创建 URL 对象。需要注意的是，这里出现的 URL 并非 java.net.URL，而是 com.alibaba.dubbo.common.URL。</p> <p>上面省略了一段代码，这里简单分析一下。这段代码用于检测 \&lt;dubbo:method> 标签中的配置信息，并将相关配置添加到 map 中。代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>doExportUrlsFor1Protocol</span><span class=p>(</span><span class=n>ProtocolConfig</span> <span class=n>protocolConfig</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>registryURLs</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// ...</span>

    <span class=c1>// methods 为 MethodConfig 集合，MethodConfig 中存储了 &lt;dubbo:method&gt; 标签的配置信息</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>methods</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>methods</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>MethodConfig</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 添加 MethodConfig 对象的字段信息到 map 中，键 = 方法名.属性名。</span>
            <span class=c1>// 比如存储 &lt;dubbo:method name=&quot;sayHello&quot; retries=&quot;2&quot;&gt; 对应的 MethodConfig，</span>
            <span class=c1>// 键 = sayHello.retries，map = {&quot;sayHello.retries&quot;: 2, &quot;xxx&quot;: &quot;yyy&quot;}</span>
            <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>

            <span class=n>String</span> <span class=n>retryKey</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.retry&quot;</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>map</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>retryKey</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>String</span> <span class=n>retryValue</span> <span class=o>=</span> <span class=n>map</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>retryKey</span><span class=p>);</span>
                <span class=c1>// 检测 MethodConfig retry 是否为 false，若是，则设置重试次数为0</span>
                <span class=k>if</span> <span class=p>(</span><span class=s>&quot;false&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>retryValue</span><span class=p>))</span> <span class=p>{</span>
                    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.retries&quot;</span><span class=p>,</span> <span class=s>&quot;0&quot;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 获取 ArgumentConfig 列表</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>ArgumentConfig</span><span class=o>&gt;</span> <span class=n>arguments</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getArguments</span><span class=p>();</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>arguments</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>arguments</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>ArgumentConfig</span> <span class=n>argument</span> <span class=p>:</span> <span class=n>arguments</span><span class=p>)</span> <span class=p>{</span>
                    <span class=c1>// 检测 type 属性是否为空，或者空串（分支1 ⭐️）</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getType</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>argument</span><span class=p>.</span><span class=na>getType</span><span class=p>().</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>interfaceClass</span><span class=p>.</span><span class=na>getMethods</span><span class=p>();</span>
                        <span class=k>if</span> <span class=p>(</span><span class=n>methods</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>methods</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>methods</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                                <span class=n>String</span> <span class=n>methodName</span> <span class=o>=</span> <span class=n>methods</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
                                <span class=c1>// 比对方法名，查找目标方法</span>
                                <span class=k>if</span> <span class=p>(</span><span class=n>methodName</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span> <span class=p>{</span>
                                    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>argtypes</span> <span class=o>=</span> <span class=n>methods</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
                                    <span class=k>if</span> <span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>()</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
                                        <span class=c1>// 检测 ArgumentConfig 中的 type 属性与方法参数列表</span>
                                        <span class=c1>// 中的参数名称是否一致，不一致则抛出异常(分支2 ⭐️)</span>
                                        <span class=k>if</span> <span class=p>(</span><span class=n>argtypes</span><span class=o>[</span><span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>()</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getType</span><span class=p>()))</span> <span class=p>{</span>
                                            <span class=c1>// 添加 ArgumentConfig 字段信息到 map 中，</span>
                                            <span class=c1>// 键前缀 = 方法名.index，比如:</span>
                                            <span class=c1>// map = {&quot;sayHello.3&quot;: true}</span>
                                            <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>argument</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>());</span>
                                        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                                            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;argument config error: ...&quot;</span><span class=p>);</span>
                                        <span class=p>}</span>
                                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>    <span class=c1>// 分支3 ⭐️</span>
                                        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>argtypes</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                                            <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>argclazz</span> <span class=o>=</span> <span class=n>argtypes</span><span class=o>[</span><span class=n>j</span><span class=o>]</span><span class=p>;</span>
                                            <span class=c1>// 从参数类型列表中查找类型名称为 argument.type 的参数</span>
                                            <span class=k>if</span> <span class=p>(</span><span class=n>argclazz</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getType</span><span class=p>()))</span> <span class=p>{</span>
                                                <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>argument</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>j</span><span class=p>);</span>
                                                <span class=k>if</span> <span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>()</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>()</span> <span class=o>!=</span> <span class=n>j</span><span class=p>)</span> <span class=p>{</span>
                                                    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;argument config error: ...&quot;</span><span class=p>);</span>
                                                <span class=p>}</span>
                                            <span class=p>}</span>
                                        <span class=p>}</span>
                                    <span class=p>}</span>
                                <span class=p>}</span>
                            <span class=p>}</span>
                        <span class=p>}</span>

                    <span class=c1>// 用户未配置 type 属性，但配置了 index 属性，且 index != -1</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>()</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>    <span class=c1>// 分支4 ⭐️</span>
                        <span class=c1>// 添加 ArgumentConfig 字段信息到 map 中</span>
                        <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>argument</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>argument</span><span class=p>.</span><span class=na>getIndex</span><span class=p>());</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;argument config must set index or type&quot;</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div> <p>上面这段代码 for 循环和 if else 分支嵌套太多，导致层次太深，不利于阅读，需要耐心看一下。大家在看这段代码时，注意把几个重要的条件分支找出来。只要理解了这几个分支的意图，就可以弄懂这段代码。请注意上面代码中⭐️符号，这几个符号标识出了4个重要的分支，下面用伪代码解释一下这几个分支的含义。</p> <div class=highlight><pre><span></span><code><span class=c1>// 获取 ArgumentConfig 列表</span>
<span class=k>for</span> <span class=p>(</span><span class=n>遍历</span> <span class=n>ArgumentConfig</span> <span class=n>列表</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=n>不为</span> <span class=kc>null</span><span class=err>，</span><span class=n>也不为空串</span><span class=p>)</span> <span class=p>{</span>    <span class=c1>// 分支1</span>
        <span class=mf>1.</span> <span class=n>通过反射获取</span> <span class=n>interfaceClass</span> <span class=n>的方法列表</span>
        <span class=nf>for</span> <span class=p>(</span><span class=n>遍历方法列表</span><span class=p>)</span> <span class=p>{</span>
            <span class=mf>1.</span> <span class=n>比对方法名</span><span class=err>，</span><span class=n>查找目标方法</span>
            <span class=mf>2.</span> <span class=n>通过反射获取目标方法的参数类型数组</span> <span class=n>argtypes</span>
            <span class=nf>if</span> <span class=p>(</span><span class=n>index</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>    <span class=c1>// 分支2</span>
                <span class=mf>1.</span> <span class=n>从</span> <span class=n>argtypes</span> <span class=n>数组中获取下标</span> <span class=n>index</span> <span class=n>处的元素</span> <span class=n>argType</span>
                <span class=mf>2.</span> <span class=n>检测</span> <span class=n>argType</span> <span class=n>的名称与</span> <span class=n>ArgumentConfig</span> <span class=n>中的</span> <span class=n>type</span> <span class=n>属性是否一致</span>
                <span class=mf>3.</span> <span class=n>添加</span> <span class=n>ArgumentConfig</span> <span class=n>字段信息到</span> <span class=n>map</span> <span class=n>中</span><span class=err>，</span><span class=n>或抛出异常</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>    <span class=c1>// 分支3</span>
                <span class=mf>1.</span> <span class=n>遍历参数类型数组</span> <span class=n>argtypes</span><span class=err>，</span><span class=n>查找</span> <span class=n>argument</span><span class=p>.</span><span class=na>type</span> <span class=n>类型的参数</span>
                <span class=mf>2.</span> <span class=n>添加</span> <span class=n>ArgumentConfig</span> <span class=n>字段信息到</span> <span class=n>map</span> <span class=n>中</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>index</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>    <span class=c1>// 分支4</span>
        <span class=mf>1.</span> <span class=n>添加</span> <span class=n>ArgumentConfig</span> <span class=n>字段信息到</span> <span class=n>map</span> <span class=n>中</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>在本节分析的源码中，appendParameters 这个方法出现的次数比较多，该方法用于将对象字段信息添加到 map 中。实现上则是通过反射获取目标对象的 getter 方法，并调用该方法获取属性值。然后再通过 getter 方法名解析出属性名，比如从方法名 getName 中可解析出属性 name。如果用户传入了属性名前缀，此时需要将属性名加入前缀内容。最后将 \&lt;属性名，属性值> 键值对存入到 map 中就行了。限于篇幅原因，这里就不分析 appendParameters 方法的源码了，大家请自行分析。</p> <h3 id=22-dubbo>2.2 导出 Dubbo 服务<a class=headerlink href=#22-dubbo title="Permanent link">&para;</a></h3> <p>前置工作做完，接下来就可以进行服务导出了。服务导出分为导出到本地 (JVM)，和导出到远程。在深入分析服务导出的源码前，我们先来从宏观层面上看一下服务导出逻辑。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>doExportUrlsFor1Protocol</span><span class=p>(</span><span class=n>ProtocolConfig</span> <span class=n>protocolConfig</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>registryURLs</span><span class=p>)</span> <span class=p>{</span>

    <span class=c1>// 省略无关代码</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>ConfiguratorFactory</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
            <span class=p>.</span><span class=na>hasExtension</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()))</span> <span class=p>{</span>
        <span class=c1>// 加载 ConfiguratorFactory，并生成 Configurator 实例，然后通过实例配置 url</span>
        <span class=n>url</span> <span class=o>=</span> <span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>ConfiguratorFactory</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
                <span class=p>.</span><span class=na>getExtension</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()).</span><span class=na>getConfigurator</span><span class=p>(</span><span class=n>url</span><span class=p>).</span><span class=na>configure</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>String</span> <span class=n>scope</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SCOPE_KEY</span><span class=p>);</span>
    <span class=c1>// 如果 scope = none，则什么都不做</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>SCOPE_NONE</span><span class=p>.</span><span class=na>toString</span><span class=p>().</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>scope</span><span class=p>))</span> <span class=p>{</span>
        <span class=c1>// scope != remote，导出到本地</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>SCOPE_REMOTE</span><span class=p>.</span><span class=na>toString</span><span class=p>().</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>scope</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>exportLocal</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// scope != local，导出到远程</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>SCOPE_LOCAL</span><span class=p>.</span><span class=na>toString</span><span class=p>().</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>scope</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>registryURLs</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>registryURLs</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>URL</span> <span class=n>registryURL</span> <span class=p>:</span> <span class=n>registryURLs</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DYNAMIC_KEY</span><span class=p>,</span> <span class=n>registryURL</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DYNAMIC_KEY</span><span class=p>));</span>
                    <span class=c1>// 加载监视器链接</span>
                    <span class=n>URL</span> <span class=n>monitorUrl</span> <span class=o>=</span> <span class=n>loadMonitor</span><span class=p>(</span><span class=n>registryURL</span><span class=p>);</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>monitorUrl</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                        <span class=c1>// 将监视器链接作为参数添加到 url 中</span>
                        <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterAndEncoded</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>MONITOR_KEY</span><span class=p>,</span> <span class=n>monitorUrl</span><span class=p>.</span><span class=na>toFullString</span><span class=p>());</span>
                    <span class=p>}</span>

                    <span class=n>String</span> <span class=n>proxy</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PROXY_KEY</span><span class=p>);</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>isNotEmpty</span><span class=p>(</span><span class=n>proxy</span><span class=p>))</span> <span class=p>{</span>
                        <span class=n>registryURL</span> <span class=o>=</span> <span class=n>registryURL</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PROXY_KEY</span><span class=p>,</span> <span class=n>proxy</span><span class=p>);</span>
                    <span class=p>}</span>

                    <span class=c1>// 为服务提供类(ref)生成 Invoker</span>
                    <span class=n>Invoker</span><span class=o>&lt;?&gt;</span> <span class=n>invoker</span> <span class=o>=</span> <span class=n>proxyFactory</span><span class=p>.</span><span class=na>getInvoker</span><span class=p>(</span><span class=n>ref</span><span class=p>,</span> <span class=p>(</span><span class=n>Class</span><span class=p>)</span> <span class=n>interfaceClass</span><span class=p>,</span> <span class=n>registryURL</span><span class=p>.</span><span class=na>addParameterAndEncoded</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>EXPORT_KEY</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>toFullString</span><span class=p>()));</span>
                    <span class=c1>// DelegateProviderMetaDataInvoker 用于持有 Invoker 和 ServiceConfig</span>
                    <span class=n>DelegateProviderMetaDataInvoker</span> <span class=n>wrapperInvoker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DelegateProviderMetaDataInvoker</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=k>this</span><span class=p>);</span>

                    <span class=c1>// 导出服务，并生成 Exporter</span>
                    <span class=n>Exporter</span><span class=o>&lt;?&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=n>protocol</span><span class=p>.</span><span class=na>export</span><span class=p>(</span><span class=n>wrapperInvoker</span><span class=p>);</span>
                    <span class=n>exporters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>exporter</span><span class=p>);</span>
                <span class=p>}</span>

            <span class=c1>// 不存在注册中心，仅导出服务</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=n>Invoker</span><span class=o>&lt;?&gt;</span> <span class=n>invoker</span> <span class=o>=</span> <span class=n>proxyFactory</span><span class=p>.</span><span class=na>getInvoker</span><span class=p>(</span><span class=n>ref</span><span class=p>,</span> <span class=p>(</span><span class=n>Class</span><span class=p>)</span> <span class=n>interfaceClass</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
                <span class=n>DelegateProviderMetaDataInvoker</span> <span class=n>wrapperInvoker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DelegateProviderMetaDataInvoker</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=k>this</span><span class=p>);</span>

                <span class=n>Exporter</span><span class=o>&lt;?&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=n>protocol</span><span class=p>.</span><span class=na>export</span><span class=p>(</span><span class=n>wrapperInvoker</span><span class=p>);</span>
                <span class=n>exporters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>exporter</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>this</span><span class=p>.</span><span class=na>urls</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码根据 url 中的 scope 参数决定服务导出方式，分别如下：</p> <ul> <li>scope = none，不导出服务</li> <li>scope != remote，导出到本地</li> <li>scope != local，导出到远程</li> </ul> <p>不管是导出到本地，还是远程。进行服务导出之前，均需要先创建 Invoker，这是一个很重要的步骤。因此下面先来分析 Invoker 的创建过程。</p> <h3 id=221-invoker>2.2.1 Invoker 创建过程<a class=headerlink href=#221-invoker title="Permanent link">&para;</a></h3> <p>在 Dubbo 中，Invoker 是一个非常重要的模型。在服务提供端，以及服务引用端均会出现 Invoker。Dubbo 官方文档中对 Invoker 进行了说明，这里引用一下。</p> <blockquote> <p>Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。</p> </blockquote> <p>既然 Invoker 如此重要，那么我们很有必要搞清楚 Invoker 的用途。Invoker 是由 ProxyFactory 创建而来，Dubbo 默认的 ProxyFactory 实现类是 JavassistProxyFactory。下面我们到 JavassistProxyFactory 代码中，探索 Invoker 的创建过程。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>getInvoker</span><span class=p>(</span><span class=n>T</span> <span class=n>proxy</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>type</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 为目标类创建 Wrapper</span>
    <span class=kd>final</span> <span class=n>Wrapper</span> <span class=n>wrapper</span> <span class=o>=</span> <span class=n>Wrapper</span><span class=p>.</span><span class=na>getWrapper</span><span class=p>(</span><span class=n>proxy</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getName</span><span class=p>().</span><span class=na>indexOf</span><span class=p>(</span><span class=sc>&#39;$&#39;</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>proxy</span><span class=p>.</span><span class=na>getClass</span><span class=p>()</span> <span class=p>:</span> <span class=n>type</span><span class=p>);</span>
    <span class=c1>// 创建匿名 Invoker 类对象，并实现 doInvoke 方法。</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>AbstractProxyInvoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>proxy</span><span class=p>,</span> <span class=n>type</span><span class=p>,</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>protected</span> <span class=n>Object</span> <span class=nf>doInvoke</span><span class=p>(</span><span class=n>T</span> <span class=n>proxy</span><span class=p>,</span> <span class=n>String</span> <span class=n>methodName</span><span class=p>,</span>
                                  <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>parameterTypes</span><span class=p>,</span>
                                  <span class=n>Object</span><span class=o>[]</span> <span class=n>arguments</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=p>{</span>
            <span class=c1>// 调用 Wrapper 的 invokeMethod 方法，invokeMethod 最终会调用目标方法</span>
            <span class=k>return</span> <span class=n>wrapper</span><span class=p>.</span><span class=na>invokeMethod</span><span class=p>(</span><span class=n>proxy</span><span class=p>,</span> <span class=n>methodName</span><span class=p>,</span> <span class=n>parameterTypes</span><span class=p>,</span> <span class=n>arguments</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
<span class=p>}</span>
</code></pre></div> <p>如上，JavassistProxyFactory 创建了一个继承自 AbstractProxyInvoker 类的匿名对象，并覆写了抽象方法 doInvoke。覆写后的 doInvoke 逻辑比较简单，仅是将调用请求转发给了 Wrapper 类的 invokeMethod 方法。Wrapper 用于“包裹”目标类，Wrapper 是一个抽象类，仅可通过 getWrapper(Class) 方法创建子类。在创建 Wrapper 子类的过程中，子类代码生成逻辑会对 getWrapper 方法传入的 Class 对象进行解析，拿到诸如类方法，类成员变量等信息。以及生成 invokeMethod 方法代码和其他一些方法代码。代码生成完毕后，通过 Javassist 生成 Class 对象，最后再通过反射创建 Wrapper 实例。相关的代码如下：</p> <div class=highlight><pre><span></span><code> <span class=kd>public</span> <span class=kd>static</span> <span class=n>Wrapper</span> <span class=nf>getWrapper</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span> 
    <span class=k>while</span> <span class=p>(</span><span class=n>ClassGenerator</span><span class=p>.</span><span class=na>isDynamicClass</span><span class=p>(</span><span class=n>c</span><span class=p>))</span>
        <span class=n>c</span> <span class=o>=</span> <span class=n>c</span><span class=p>.</span><span class=na>getSuperclass</span><span class=p>();</span>

    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=n>Object</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>OBJECT_WRAPPER</span><span class=p>;</span>

    <span class=c1>// 从缓存中获取 Wrapper 实例</span>
    <span class=n>Wrapper</span> <span class=n>ret</span> <span class=o>=</span> <span class=n>WRAPPER_MAP</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ret</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 缓存未命中，创建 Wrapper</span>
        <span class=n>ret</span> <span class=o>=</span> <span class=n>makeWrapper</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>
        <span class=c1>// 写入缓存</span>
        <span class=n>WRAPPER_MAP</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>ret</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>ret</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>getWrapper 方法仅包含一些缓存操作逻辑，不难理解。下面我们看一下 makeWrapper 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kd>static</span> <span class=n>Wrapper</span> <span class=nf>makeWrapper</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>c</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 检测 c 是否为基本类型，若是则抛出异常</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=na>isPrimitive</span><span class=p>())</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;Can not create wrapper for primitive type: &quot;</span> <span class=o>+</span> <span class=n>c</span><span class=p>);</span>

    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>c</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
    <span class=n>ClassLoader</span> <span class=n>cl</span> <span class=o>=</span> <span class=n>ClassHelper</span><span class=p>.</span><span class=na>getClassLoader</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>

    <span class=c1>// c1 用于存储 setPropertyValue 方法代码</span>
    <span class=n>StringBuilder</span> <span class=n>c1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=s>&quot;public void setPropertyValue(Object o, String n, Object v){ &quot;</span><span class=p>);</span>
    <span class=c1>// c2 用于存储 getPropertyValue 方法代码</span>
    <span class=n>StringBuilder</span> <span class=n>c2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=s>&quot;public Object getPropertyValue(Object o, String n){ &quot;</span><span class=p>);</span>
    <span class=c1>// c3 用于存储 invokeMethod 方法代码</span>
    <span class=n>StringBuilder</span> <span class=n>c3</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=s>&quot;public Object invokeMethod(Object o, String n, Class[] p, Object[] v) throws &quot;</span> <span class=o>+</span> <span class=n>InvocationTargetException</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;{ &quot;</span><span class=p>);</span>

    <span class=c1>// 生成类型转换代码及异常捕捉代码，比如：</span>
    <span class=c1>//   DemoService w; try { w = ((DemoServcie) $1); }}catch(Throwable e){ throw new IllegalArgumentException(e); }</span>
    <span class=n>c1</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; w; try{ w = ((&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;)$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }&quot;</span><span class=p>);</span>
    <span class=n>c2</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; w; try{ w = ((&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;)$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }&quot;</span><span class=p>);</span>
    <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; w; try{ w = ((&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>name</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;)$1); }catch(Throwable e){ throw new IllegalArgumentException(e); }&quot;</span><span class=p>);</span>

    <span class=c1>// pts 用于存储成员变量名和类型</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;&gt;</span> <span class=n>pts</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;&gt;</span><span class=p>();</span>
    <span class=c1>// ms 用于存储方法描述信息（可理解为方法签名）及 Method 实例</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Method</span><span class=o>&gt;</span> <span class=n>ms</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Method</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=c1>// mns 为方法名列表</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>mns</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=c1>// dmns 用于存储“定义在当前类中的方法”的名称</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>dmns</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>

    <span class=c1>// --------------------------------✨ 分割线1 ✨-------------------------------------</span>

    <span class=c1>// 获取 public 访问级别的字段，并为所有字段生成条件判断语句</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>Field</span> <span class=n>f</span> <span class=p>:</span> <span class=n>c</span><span class=p>.</span><span class=na>getFields</span><span class=p>())</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>fn</span> <span class=o>=</span> <span class=n>f</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>ft</span> <span class=o>=</span> <span class=n>f</span><span class=p>.</span><span class=na>getType</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>Modifier</span><span class=p>.</span><span class=na>isStatic</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>())</span> <span class=o>||</span> <span class=n>Modifier</span><span class=p>.</span><span class=na>isTransient</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()))</span>
            <span class=c1>// 忽略关键字 static 或 transient 修饰的变量</span>
            <span class=k>continue</span><span class=p>;</span>

        <span class=c1>// 生成条件判断及赋值语句，比如：</span>
        <span class=c1>// if( $2.equals(&quot;name&quot;) ) { w.name = (java.lang.String) $3; return;}</span>
        <span class=c1>// if( $2.equals(&quot;age&quot;) ) { w.age = ((Number) $3).intValue(); return;}</span>
        <span class=n>c1</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( $2.equals(\&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>fn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;) ){ w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>fn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;=&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>arg</span><span class=p>(</span><span class=n>ft</span><span class=p>,</span> <span class=s>&quot;$3&quot;</span><span class=p>)).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;; return; }&quot;</span><span class=p>);</span>

        <span class=c1>// 生成条件判断及返回语句，比如：</span>
        <span class=c1>// if( $2.equals(&quot;name&quot;) ) { return ($w)w.name; }</span>
        <span class=n>c2</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( $2.equals(\&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>fn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;) ){ return ($w)w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>fn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;; }&quot;</span><span class=p>);</span>

        <span class=c1>// 存储 &lt;字段名, 字段类型&gt; 键值对到 pts 中</span>
        <span class=n>pts</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>fn</span><span class=p>,</span> <span class=n>ft</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// --------------------------------✨ 分割线2 ✨-------------------------------------</span>

    <span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>c</span><span class=p>.</span><span class=na>getMethods</span><span class=p>();</span>
    <span class=c1>// 检测 c 中是否包含在当前类中声明的方法</span>
    <span class=kt>boolean</span> <span class=n>hasMethod</span> <span class=o>=</span> <span class=n>hasMethods</span><span class=p>(</span><span class=n>methods</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>hasMethod</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; try{&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getDeclaringClass</span><span class=p>()</span> <span class=o>==</span> <span class=n>Object</span><span class=p>.</span><span class=na>class</span><span class=p>)</span>
            <span class=c1>// 忽略 Object 中定义的方法</span>
            <span class=k>continue</span><span class=p>;</span>

        <span class=n>String</span> <span class=n>mn</span> <span class=o>=</span> <span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
        <span class=c1>// 生成方法名判断语句，比如：</span>
        <span class=c1>// if ( &quot;sayHello&quot;.equals( $2 )</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( \&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>mn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;.equals( $2 ) &quot;</span><span class=p>);</span>
        <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>().</span><span class=na>length</span><span class=p>;</span>
        <span class=c1>// 生成“运行时传入的参数数量与方法参数列表长度”判断语句，比如：</span>
        <span class=c1>// &amp;&amp; $3.length == 2</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; &amp;&amp; &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; $3.length == &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>len</span><span class=p>);</span>

        <span class=kt>boolean</span> <span class=n>override</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>m2</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 检测方法是否存在重载情况，条件为：方法对象不同 &amp;&amp; 方法名相同</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>m</span> <span class=o>!=</span> <span class=n>m2</span> <span class=o>&amp;&amp;</span> <span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>m2</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span> <span class=p>{</span>
                <span class=n>override</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=c1>// 对重载方法进行处理，考虑下面的方法：</span>
        <span class=c1>//    1. void sayHello(Integer, String)</span>
        <span class=c1>//    2. void sayHello(Integer, Integer)</span>
        <span class=c1>// 方法名相同，参数列表长度也相同，因此不能仅通过这两项判断两个方法是否相等。</span>
        <span class=c1>// 需要进一步判断方法的参数类型</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>override</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>len</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>l</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>l</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                    <span class=c1>// 生成参数类型进行检测代码，比如：</span>
                    <span class=c1>// &amp;&amp; $3[0].getName().equals(&quot;java.lang.Integer&quot;) </span>
                    <span class=c1>//    &amp;&amp; $3[1].getName().equals(&quot;java.lang.String&quot;)</span>
                    <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; &amp;&amp; &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; $3[&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>l</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;].getName().equals(\&quot;&quot;</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>()</span><span class=o>[</span><span class=n>l</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;)&quot;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=c1>// 添加 ) {，完成方法判断语句，此时生成的代码可能如下（已格式化）：</span>
        <span class=c1>// if (&quot;sayHello&quot;.equals($2) </span>
        <span class=c1>//     &amp;&amp; $3.length == 2</span>
        <span class=c1>//     &amp;&amp; $3[0].getName().equals(&quot;java.lang.Integer&quot;) </span>
        <span class=c1>//     &amp;&amp; $3[1].getName().equals(&quot;java.lang.String&quot;)) {</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; ) { &quot;</span><span class=p>);</span>

        <span class=c1>// 根据返回值类型生成目标方法调用语句</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>()</span> <span class=o>==</span> <span class=n>Void</span><span class=p>.</span><span class=na>TYPE</span><span class=p>)</span>
            <span class=c1>// w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]); return null;</span>
            <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>mn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=sc>&#39;(&#39;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>args</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>(),</span> <span class=s>&quot;$4&quot;</span><span class=p>)).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;);&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; return null;&quot;</span><span class=p>);</span>
        <span class=k>else</span>
            <span class=c1>// return w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]);</span>
            <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; return ($w)w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>mn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=sc>&#39;(&#39;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>args</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>(),</span> <span class=s>&quot;$4&quot;</span><span class=p>)).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;);&quot;</span><span class=p>);</span>

        <span class=c1>// 添加 }, 生成的代码形如（已格式化）：</span>
        <span class=c1>// if (&quot;sayHello&quot;.equals($2) </span>
        <span class=c1>//     &amp;&amp; $3.length == 2</span>
        <span class=c1>//     &amp;&amp; $3[0].getName().equals(&quot;java.lang.Integer&quot;) </span>
        <span class=c1>//     &amp;&amp; $3[1].getName().equals(&quot;java.lang.String&quot;)) {</span>
        <span class=c1>//</span>
        <span class=c1>//     w.sayHello((java.lang.Integer)$4[0], (java.lang.String)$4[1]); </span>
        <span class=c1>//     return null;</span>
        <span class=c1>// }</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; }&quot;</span><span class=p>);</span>

        <span class=c1>// 添加方法名到 mns 集合中</span>
        <span class=n>mns</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>mn</span><span class=p>);</span>
        <span class=c1>// 检测当前方法是否在 c 中被声明的</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getDeclaringClass</span><span class=p>()</span> <span class=o>==</span> <span class=n>c</span><span class=p>)</span>
            <span class=c1>// 若是，则将当前方法名添加到 dmns 中</span>
            <span class=n>dmns</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>mn</span><span class=p>);</span>
        <span class=n>ms</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>ReflectUtils</span><span class=p>.</span><span class=na>getDesc</span><span class=p>(</span><span class=n>m</span><span class=p>),</span> <span class=n>m</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>hasMethod</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 添加异常捕捉语句</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; } catch(Throwable e) { &quot;</span><span class=p>);</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;     throw new java.lang.reflect.InvocationTargetException(e); &quot;</span><span class=p>);</span>
        <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; }&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 添加 NoSuchMethodException 异常抛出代码</span>
    <span class=n>c3</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; throw new &quot;</span> <span class=o>+</span> <span class=n>NoSuchMethodException</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;(\&quot;Not found method \\\&quot;\&quot;+$2+\&quot;\\\&quot; in class &quot;</span> <span class=o>+</span> <span class=n>c</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.\&quot;); }&quot;</span><span class=p>);</span>

    <span class=c1>// --------------------------------✨ 分割线3 ✨-------------------------------------</span>

    <span class=n>Matcher</span> <span class=n>matcher</span><span class=p>;</span>
    <span class=c1>// 处理 get/set 方法</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Method</span><span class=o>&gt;</span> <span class=n>entry</span> <span class=p>:</span> <span class=n>ms</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>md</span> <span class=o>=</span> <span class=n>entry</span><span class=p>.</span><span class=na>getKey</span><span class=p>();</span>
        <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=p>(</span><span class=n>Method</span><span class=p>)</span> <span class=n>entry</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span>
        <span class=c1>// 匹配以 get 开头的方法</span>
        <span class=k>if</span> <span class=p>((</span><span class=n>matcher</span> <span class=o>=</span> <span class=n>ReflectUtils</span><span class=p>.</span><span class=na>GETTER_METHOD_DESC_PATTERN</span><span class=p>.</span><span class=na>matcher</span><span class=p>(</span><span class=n>md</span><span class=p>)).</span><span class=na>matches</span><span class=p>())</span> <span class=p>{</span>
            <span class=c1>// 获取属性名</span>
            <span class=n>String</span> <span class=n>pn</span> <span class=o>=</span> <span class=n>propertyName</span><span class=p>(</span><span class=n>matcher</span><span class=p>.</span><span class=na>group</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
            <span class=c1>// 生成属性判断以及返回语句，示例如下：</span>
            <span class=c1>// if( $2.equals(&quot;name&quot;) ) { return ($w).w.getName(); }</span>
            <span class=n>c2</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( $2.equals(\&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>pn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;) ){ return ($w)w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;(); }&quot;</span><span class=p>);</span>
            <span class=n>pts</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>pn</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>());</span>

        <span class=c1>// 匹配以 is/has/can 开头的方法</span>
        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>((</span><span class=n>matcher</span> <span class=o>=</span> <span class=n>ReflectUtils</span><span class=p>.</span><span class=na>IS_HAS_CAN_METHOD_DESC_PATTERN</span><span class=p>.</span><span class=na>matcher</span><span class=p>(</span><span class=n>md</span><span class=p>)).</span><span class=na>matches</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>pn</span> <span class=o>=</span> <span class=n>propertyName</span><span class=p>(</span><span class=n>matcher</span><span class=p>.</span><span class=na>group</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
            <span class=c1>// 生成属性判断以及返回语句，示例如下：</span>
            <span class=c1>// if( $2.equals(&quot;dream&quot;) ) { return ($w).w.hasDream(); }</span>
            <span class=n>c2</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( $2.equals(\&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>pn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;) ){ return ($w)w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;(); }&quot;</span><span class=p>);</span>
            <span class=n>pts</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>pn</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>());</span>

        <span class=c1>// 匹配以 set 开头的方法</span>
        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>((</span><span class=n>matcher</span> <span class=o>=</span> <span class=n>ReflectUtils</span><span class=p>.</span><span class=na>SETTER_METHOD_DESC_PATTERN</span><span class=p>.</span><span class=na>matcher</span><span class=p>(</span><span class=n>md</span><span class=p>)).</span><span class=na>matches</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>pt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>()</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>;</span>
            <span class=n>String</span> <span class=n>pn</span> <span class=o>=</span> <span class=n>propertyName</span><span class=p>(</span><span class=n>matcher</span><span class=p>.</span><span class=na>group</span><span class=p>(</span><span class=mi>1</span><span class=p>));</span>
            <span class=c1>// 生成属性判断以及 setter 调用语句，示例如下：</span>
            <span class=c1>// if( $2.equals(&quot;name&quot;) ) { w.setName((java.lang.String)$3); return; }</span>
            <span class=n>c1</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; if( $2.equals(\&quot;&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>pn</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\&quot;) ){ w.&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;(&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>arg</span><span class=p>(</span><span class=n>pt</span><span class=p>,</span> <span class=s>&quot;$3&quot;</span><span class=p>)).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;); return; }&quot;</span><span class=p>);</span>
            <span class=n>pts</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>pn</span><span class=p>,</span> <span class=n>pt</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 添加 NoSuchPropertyException 异常抛出代码</span>
    <span class=n>c1</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; throw new &quot;</span> <span class=o>+</span> <span class=n>NoSuchPropertyException</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;(\&quot;Not found property \\\&quot;\&quot;+$2+\&quot;\\\&quot; filed or setter method in class &quot;</span> <span class=o>+</span> <span class=n>c</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.\&quot;); }&quot;</span><span class=p>);</span>
    <span class=n>c2</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; throw new &quot;</span> <span class=o>+</span> <span class=n>NoSuchPropertyException</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;(\&quot;Not found property \\\&quot;\&quot;+$2+\&quot;\\\&quot; filed or setter method in class &quot;</span> <span class=o>+</span> <span class=n>c</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.\&quot;); }&quot;</span><span class=p>);</span>

    <span class=c1>// --------------------------------✨ 分割线4 ✨-------------------------------------</span>

    <span class=kt>long</span> <span class=n>id</span> <span class=o>=</span> <span class=n>WRAPPER_CLASS_COUNTER</span><span class=p>.</span><span class=na>getAndIncrement</span><span class=p>();</span>
    <span class=c1>// 创建类生成器</span>
    <span class=n>ClassGenerator</span> <span class=n>cc</span> <span class=o>=</span> <span class=n>ClassGenerator</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>cl</span><span class=p>);</span>
    <span class=c1>// 设置类名及超类</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>setClassName</span><span class=p>((</span><span class=n>Modifier</span><span class=p>.</span><span class=na>isPublic</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>())</span> <span class=o>?</span> <span class=n>Wrapper</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=p>:</span> <span class=n>c</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;$sw&quot;</span><span class=p>)</span> <span class=o>+</span> <span class=n>id</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>setSuperClass</span><span class=p>(</span><span class=n>Wrapper</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>

    <span class=c1>// 添加默认构造方法</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addDefaultConstructor</span><span class=p>();</span>

    <span class=c1>// 添加字段</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static String[] pns;&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static &quot;</span> <span class=o>+</span> <span class=n>Map</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; pts;&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static String[] mns;&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static String[] dmns;&quot;</span><span class=p>);</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>len</span> <span class=o>=</span> <span class=n>ms</span><span class=p>.</span><span class=na>size</span><span class=p>();</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>cc</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static Class[] mts&quot;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s>&quot;;&quot;</span><span class=p>);</span>

    <span class=c1>// 添加方法代码</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public String[] getPropertyNames(){ return pns; }&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public boolean hasProperty(String n){ return pts.containsKey($1); }&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public Class getPropertyType(String n){ return (Class)pts.get($1); }&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public String[] getMethodNames(){ return mns; }&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public String[] getDeclaredMethodNames(){ return dmns; }&quot;</span><span class=p>);</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=n>c1</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=n>c2</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
    <span class=n>cc</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=n>c3</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>

    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 生成类</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>wc</span> <span class=o>=</span> <span class=n>cc</span><span class=p>.</span><span class=na>toClass</span><span class=p>();</span>

        <span class=c1>// 设置字段值</span>
        <span class=n>wc</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;pts&quot;</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>pts</span><span class=p>);</span>
        <span class=n>wc</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;pns&quot;</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>pts</span><span class=p>.</span><span class=na>keySet</span><span class=p>().</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span> <span class=n>String</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>));</span>
        <span class=n>wc</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;mns&quot;</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>mns</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span> <span class=n>String</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>));</span>
        <span class=n>wc</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;dmns&quot;</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>dmns</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span> <span class=n>String</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>));</span>
        <span class=kt>int</span> <span class=n>ix</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>ms</span><span class=p>.</span><span class=na>values</span><span class=p>())</span>
            <span class=n>wc</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;mts&quot;</span> <span class=o>+</span> <span class=n>ix</span><span class=o>++</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>());</span>

        <span class=c1>// 创建 Wrapper 实例</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>Wrapper</span><span class=p>)</span> <span class=n>wc</span><span class=p>.</span><span class=na>newInstance</span><span class=p>();</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=n>e</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
        <span class=n>cc</span><span class=p>.</span><span class=na>release</span><span class=p>();</span>
        <span class=n>ms</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>
        <span class=n>mns</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>
        <span class=n>dmns</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码很长，大家耐心看一下。我们在上面代码中做了大量的注释，并按功能对代码进行了分块，以帮助大家理解代码逻辑。下面对这段代码进行讲解。首先我们把目光移到分割线1之上的代码，这段代码主要用于进行一些初始化操作。比如创建 c1、c2、c3 以及 pts、ms、mns 等变量，以及向 c1、c2、c3 中添加方法定义和类型转换代码。接下来是分割线1到分割线2之间的代码，这段代码用于为 public 级别的字段生成条件判断取值与赋值代码。这段代码不是很难看懂，就不多说了。继续向下看，分割线2和分隔线3之间的代码用于为定义在当前类中的方法生成判断语句，和方法调用语句。因为需要对方法重载进行校验，因此到这这段代码看起来有点复杂。不过耐心看一下，也不是很难理解。接下来是分割线3和分隔线4之间的代码，这段代码用于处理 getter、setter 以及以 is/has/can 开头的方法。处理方式是通过正则表达式获取方法类型（get/set/is/...），以及属性名。之后为属性名生成判断语句，然后为方法生成调用语句。最后我们再来看一下分隔线4以下的代码，这段代码通过 ClassGenerator 为刚刚生成的代码构建 Class 类，并通过反射创建对象。ClassGenerator 是 Dubbo 自己封装的，该类的核心是 toClass() 的重载方法 toClass(ClassLoader, ProtectionDomain)，该方法通过 javassist 构建 Class。这里就不分析 toClass 方法了，大家请自行分析。</p> <p>阅读 Wrapper 类代码需要对 javassist 框架有所了解。关于 javassist，大家如果不熟悉，请自行查阅资料，本节不打算介绍 javassist 相关内容。</p> <p>好了，关于 Wrapper 类生成过程就分析到这。如果大家看的不是很明白，可以单独为 Wrapper 创建单元测试，然后单步调试。并将生成的代码拷贝出来，格式化后再进行观察和理解。</p> <h3 id=222>2.2.2 导出服务到本地<a class=headerlink href=#222 title="Permanent link">&para;</a></h3> <p>本节我们来看一下服务导出相关的代码，按照代码执行顺序，本节先来分析导出服务到本地的过程。相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>exportLocal</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 如果 URL 的协议头等于 injvm，说明已经导出到本地了，无需再次导出</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>LOCAL_PROTOCOL</span><span class=p>.</span><span class=na>equalsIgnoreCase</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()))</span> <span class=p>{</span>
        <span class=n>URL</span> <span class=n>local</span> <span class=o>=</span> <span class=n>URL</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>toFullString</span><span class=p>())</span>
            <span class=p>.</span><span class=na>setProtocol</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>LOCAL_PROTOCOL</span><span class=p>)</span>    <span class=c1>// 设置协议头为 injvm</span>
            <span class=p>.</span><span class=na>setHost</span><span class=p>(</span><span class=n>LOCALHOST</span><span class=p>)</span>
            <span class=p>.</span><span class=na>setPort</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
        <span class=n>ServiceClassHolder</span><span class=p>.</span><span class=na>getInstance</span><span class=p>().</span><span class=na>pushServiceClass</span><span class=p>(</span><span class=n>getServiceClass</span><span class=p>(</span><span class=n>ref</span><span class=p>));</span>
        <span class=c1>// 创建 Invoker，并导出服务，这里的 protocol 会在运行时调用 InjvmProtocol 的 export 方法</span>
        <span class=n>Exporter</span><span class=o>&lt;?&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=n>protocol</span><span class=p>.</span><span class=na>export</span><span class=p>(</span>
            <span class=n>proxyFactory</span><span class=p>.</span><span class=na>getInvoker</span><span class=p>(</span><span class=n>ref</span><span class=p>,</span> <span class=p>(</span><span class=n>Class</span><span class=p>)</span> <span class=n>interfaceClass</span><span class=p>,</span> <span class=n>local</span><span class=p>));</span>
        <span class=n>exporters</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>exporter</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>exportLocal 方法比较简单，首先根据 URL 协议头决定是否导出服务。若需导出，则创建一个新的 URL 并将协议头、主机名以及端口设置成新的值。然后创建 Invoker，并调用 InjvmProtocol 的 export 方法导出服务。下面我们来看一下 InjvmProtocol 的 export 方法都做了哪些事情。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Exporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>export</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=c1>// 创建 InjvmExporter</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>InjvmExporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=n>invoker</span><span class=p>.</span><span class=na>getUrl</span><span class=p>().</span><span class=na>getServiceKey</span><span class=p>(),</span> <span class=n>exporterMap</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>如上，InjvmProtocol 的 export 方法仅创建了一个 InjvmExporter，无其他逻辑。到此导出服务到本地就分析完了，接下来，我们继续分析导出服务到远程的过程。</p> <h3 id=223>2.2.3 导出服务到远程<a class=headerlink href=#223 title="Permanent link">&para;</a></h3> <p>与导出服务到本地相比，导出服务到远程的过程要复杂不少，其包含了服务导出与服务注册两个过程。这两个过程涉及到了大量的调用，比较复杂。按照代码执行顺序，本节先来分析服务导出逻辑，服务注册逻辑将在下一节进行分析。下面开始分析，我们把目光移动到 RegistryProtocol 的 export 方法上。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Exporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>export</span><span class=p>(</span><span class=kd>final</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>originInvoker</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=c1>// 导出服务</span>
    <span class=kd>final</span> <span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=n>doLocalExport</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>);</span>

    <span class=c1>// 获取注册中心 URL，以 zookeeper 注册中心为例，得到的示例 URL 如下：</span>
    <span class=c1>// zookeeper://127.0.0.1:2181/com.alibaba.dubbo.registry.RegistryService?application=demo-provider&amp;dubbo=2.0.2&amp;export=dubbo%3A%2F%2F172.17.48.52%3A20880%2Fcom.alibaba.dubbo.demo.DemoService%3Fanyhost%3Dtrue%26application%3Ddemo-provider</span>
    <span class=n>URL</span> <span class=n>registryUrl</span> <span class=o>=</span> <span class=n>getRegistryUrl</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>);</span>

    <span class=c1>// 根据 URL 加载 Registry 实现类，比如 ZookeeperRegistry</span>
    <span class=kd>final</span> <span class=n>Registry</span> <span class=n>registry</span> <span class=o>=</span> <span class=n>getRegistry</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>);</span>

    <span class=c1>// 获取已注册的服务提供者 URL，比如：</span>
    <span class=c1>// dubbo://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello</span>
    <span class=kd>final</span> <span class=n>URL</span> <span class=n>registeredProviderUrl</span> <span class=o>=</span> <span class=n>getRegisteredProviderUrl</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>);</span>

    <span class=c1>// 获取 register 参数</span>
    <span class=kt>boolean</span> <span class=n>register</span> <span class=o>=</span> <span class=n>registeredProviderUrl</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;register&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>

    <span class=c1>// 向服务提供者与消费者注册表中注册服务提供者</span>
    <span class=n>ProviderConsumerRegTable</span><span class=p>.</span><span class=na>registerProvider</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>,</span> <span class=n>registryUrl</span><span class=p>,</span> <span class=n>registeredProviderUrl</span><span class=p>);</span>

    <span class=c1>// 根据 register 的值决定是否注册服务</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>register</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 向注册中心注册服务</span>
        <span class=n>register</span><span class=p>(</span><span class=n>registryUrl</span><span class=p>,</span> <span class=n>registeredProviderUrl</span><span class=p>);</span>
        <span class=n>ProviderConsumerRegTable</span><span class=p>.</span><span class=na>getProviderWrapper</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>).</span><span class=na>setReg</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 获取订阅 URL，比如：</span>
    <span class=c1>// provider://172.17.48.52:20880/com.alibaba.dubbo.demo.DemoService?category=configurators&amp;check=false&amp;anyhost=true&amp;application=demo-provider&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello</span>
    <span class=kd>final</span> <span class=n>URL</span> <span class=n>overrideSubscribeUrl</span> <span class=o>=</span> <span class=n>getSubscribedOverrideUrl</span><span class=p>(</span><span class=n>registeredProviderUrl</span><span class=p>);</span>
    <span class=c1>// 创建监听器</span>
    <span class=kd>final</span> <span class=n>OverrideListener</span> <span class=n>overrideSubscribeListener</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OverrideListener</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>originInvoker</span><span class=p>);</span>
    <span class=n>overrideListeners</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>overrideSubscribeListener</span><span class=p>);</span>
    <span class=c1>// 向注册中心进行订阅 override 数据</span>
    <span class=n>registry</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>overrideSubscribeListener</span><span class=p>);</span>
    <span class=c1>// 创建并返回 DestroyableExporter</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>DestroyableExporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>exporter</span><span class=p>,</span> <span class=n>originInvoker</span><span class=p>,</span> <span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>registeredProviderUrl</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码看起来比较复杂，主要做如下一些操作：</p> <ol> <li>调用 doLocalExport 导出服务</li> <li>向注册中心注册服务</li> <li>向注册中心进行订阅 override 数据</li> <li>创建并返回 DestroyableExporter</li> </ol> <p>在以上操作中，除了创建并返回 DestroyableExporter 没什么难度外，其他几步操作都不是很简单。这其中，导出服务和注册服务是本章要重点分析的逻辑。 订阅 override 数据并非本文重点内容，后面会简单介绍一下。下面先来分析 doLocalExport 方法的逻辑，如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>doLocalExport</span><span class=p>(</span><span class=kd>final</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>originInvoker</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>getCacheKey</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>);</span>
    <span class=c1>// 访问缓存</span>
    <span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=p>(</span><span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=n>bounds</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>exporter</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>synchronized</span> <span class=p>(</span><span class=n>bounds</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>exporter</span> <span class=o>=</span> <span class=p>(</span><span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=n>bounds</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>exporter</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 创建 Invoker 为委托类对象</span>
                <span class=kd>final</span> <span class=n>Invoker</span><span class=o>&lt;?&gt;</span> <span class=n>invokerDelegete</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InvokerDelegete</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>,</span> <span class=n>getProviderUrl</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>));</span>
                <span class=c1>// 调用 protocol 的 export 方法导出服务</span>
                <span class=n>exporter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ExporterChangeableWrapper</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>((</span><span class=n>Exporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>)</span> <span class=n>protocol</span><span class=p>.</span><span class=na>export</span><span class=p>(</span><span class=n>invokerDelegete</span><span class=p>),</span> <span class=n>originInvoker</span><span class=p>);</span>

                <span class=c1>// 写缓存</span>
                <span class=n>bounds</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>exporter</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>exporter</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>上面的代码是典型的双重检查锁，大家在阅读 Dubbo 的源码中，会多次见到。接下来，我们把重点放在 Protocol 的 export 方法上。假设运行时协议为 dubbo，此处的 protocol 变量会在运行时加载 DubboProtocol，并调用 DubboProtocol 的 export 方法。所以，接下来我们目光转移到 DubboProtocol 的 export 方法上，相关分析如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Exporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>export</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=n>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=n>invoker</span><span class=p>.</span><span class=na>getUrl</span><span class=p>();</span>

    <span class=c1>// 获取服务标识，理解成服务坐标也行。由服务组名，服务名，服务版本号以及端口组成。比如：</span>
    <span class=c1>// demoGroup/com.alibaba.dubbo.demo.DemoService:1.0.1:20880</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>serviceKey</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=c1>// 创建 DubboExporter</span>
    <span class=n>DubboExporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>exporter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DubboExporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>exporterMap</span><span class=p>);</span>
    <span class=c1>// 将 &lt;key, exporter&gt; 键值对放入缓存中</span>
    <span class=n>exporterMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>exporter</span><span class=p>);</span>

    <span class=c1>// 本地存根相关代码</span>
    <span class=n>Boolean</span> <span class=n>isStubSupportEvent</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>STUB_EVENT_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_STUB_EVENT</span><span class=p>);</span>
    <span class=n>Boolean</span> <span class=n>isCallbackservice</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>IS_CALLBACK_SERVICE</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isStubSupportEvent</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>isCallbackservice</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>stubServiceMethods</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>STUB_EVENT_METHODS_KEY</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>stubServiceMethods</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>stubServiceMethods</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 省略日志打印代码</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>stubServiceMethodsMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getServiceKey</span><span class=p>(),</span> <span class=n>stubServiceMethods</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 启动服务器</span>
    <span class=n>openServer</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=c1>// 优化序列化</span>
    <span class=n>optimizeSerialization</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>exporter</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>如上，我们重点关注 DubboExporter 的创建以及 openServer 方法，其他逻辑看不懂也没关系，不影响理解服务导出过程。另外，DubboExporter 的代码比较简单，就不分析了。下面分析 openServer 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>openServer</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 获取 host:port，并将其作为服务器实例的 key，用于标识当前的服务器实例</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getAddress</span><span class=p>();</span>
    <span class=kt>boolean</span> <span class=n>isServer</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>IS_SERVER_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isServer</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 访问缓存</span>
        <span class=n>ExchangeServer</span> <span class=n>server</span> <span class=o>=</span> <span class=n>serverMap</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>server</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 创建服务器实例</span>
            <span class=n>serverMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>createServer</span><span class=p>(</span><span class=n>url</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// 服务器已创建，则根据 url 中的配置重置服务器</span>
            <span class=n>server</span><span class=p>.</span><span class=na>reset</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>如上，在同一台机器上（单网卡），同一个端口上仅允许启动一个服务器实例。若某个端口上已有服务器实例，此时则调用 reset 方法重置服务器的一些配置。考虑到篇幅问题，关于服务器实例重置的代码就不分析了。接下来分析服务器实例的创建过程。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>ExchangeServer</span> <span class=nf>createServer</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CHANNEL_READONLYEVENT_SENT_KEY</span><span class=p>,</span>
    <span class=c1>// 添加心跳检测配置到 url 中</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>HEARTBEAT_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_HEARTBEAT</span><span class=p>));</span>
    <span class=c1>// 获取 server 参数，默认为 netty</span>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SERVER_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_REMOTING_SERVER</span><span class=p>);</span>

    <span class=c1>// 通过 SPI 检测是否存在 server 参数所代表的 Transporter 拓展，不存在则抛出异常</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>str</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>str</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>Transporter</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>hasExtension</span><span class=p>(</span><span class=n>str</span><span class=p>))</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Unsupported server type: &quot;</span> <span class=o>+</span> <span class=n>str</span> <span class=o>+</span> <span class=s>&quot;, url: &quot;</span> <span class=o>+</span> <span class=n>url</span><span class=p>);</span>

    <span class=c1>// 添加编码解码器参数</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CODEC_KEY</span><span class=p>,</span> <span class=n>DubboCodec</span><span class=p>.</span><span class=na>NAME</span><span class=p>);</span>
    <span class=n>ExchangeServer</span> <span class=n>server</span><span class=p>;</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 创建 ExchangeServer</span>
        <span class=n>server</span> <span class=o>=</span> <span class=n>Exchangers</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>requestHandler</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RemotingException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Fail to start server...&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 获取 client 参数，可指定 netty，mina</span>
    <span class=n>str</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CLIENT_KEY</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>str</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>str</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 获取所有的 Transporter 实现类名称集合，比如 supportedTypes = [netty, mina]</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>supportedTypes</span> <span class=o>=</span> <span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>Transporter</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getSupportedExtensions</span><span class=p>();</span>
        <span class=c1>// 检测当前 Dubbo 所支持的 Transporter 实现类名称列表中，</span>
        <span class=c1>// 是否包含 client 所表示的 Transporter，若不包含，则抛出异常</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>supportedTypes</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>str</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Unsupported client type...&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>server</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>如上，createServer 包含三个核心的逻辑。第一是检测是否存在 server 参数所代表的 Transporter 拓展，不存在则抛出异常。第二是创建服务器实例。第三是检测是否支持 client 参数所表示的 Transporter 拓展，不存在也是抛出异常。两次检测操作所对应的代码比较直白了，无需多说。但创建服务器的操作目前还不是很清晰，我们继续往下看。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=n>ExchangeServer</span> <span class=nf>bind</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ExchangeHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handler</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;handler == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CODEC_KEY</span><span class=p>,</span> <span class=s>&quot;exchange&quot;</span><span class=p>);</span>
    <span class=c1>// 获取 Exchanger，默认为 HeaderExchanger。</span>
    <span class=c1>// 紧接着调用 HeaderExchanger 的 bind 方法创建 ExchangeServer 实例</span>
    <span class=k>return</span> <span class=n>getExchanger</span><span class=p>(</span><span class=n>url</span><span class=p>).</span><span class=na>bind</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码比较简单，就不多说了。下面看一下 HeaderExchanger 的 bind 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>ExchangeServer</span> <span class=nf>bind</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ExchangeHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=c1>// 创建 HeaderExchangeServer 实例，该方法包含了多个逻辑，分别如下：</span>
    <span class=c1>//   1. new HeaderExchangeHandler(handler)</span>
    <span class=c1>//   2. new DecodeHandler(new HeaderExchangeHandler(handler))</span>
    <span class=c1>//   3. Transporters.bind(url, new DecodeHandler(new HeaderExchangeHandler(handler)))</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>HeaderExchangeServer</span><span class=p>(</span><span class=n>Transporters</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=k>new</span> <span class=n>DecodeHandler</span><span class=p>(</span><span class=k>new</span> <span class=n>HeaderExchangeHandler</span><span class=p>(</span><span class=n>handler</span><span class=p>))));</span>
<span class=p>}</span>
</code></pre></div> <p>HeaderExchanger 的 bind 方法包含的逻辑比较多，但目前我们仅需关心 Transporters 的 bind 方法逻辑即可。该方法的代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=n>Server</span> <span class=nf>bind</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span><span class=p>...</span> <span class=n>handlers</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handlers</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>handlers</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;handlers == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handlers</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=n>handlers</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// 如果 handlers 元素数量大于1，则创建 ChannelHandler 分发器</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChannelHandlerDispatcher</span><span class=p>(</span><span class=n>handlers</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 获取自适应 Transporter 实例，并调用实例方法</span>
    <span class=k>return</span> <span class=n>getTransporter</span><span class=p>().</span><span class=na>bind</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>如上，getTransporter() 方法获取的 Transporter 是在运行时动态创建的，类名为 Transporter<span class=arithmatex>\(Adaptive，也就是自适应拓展类。Transporter\)</span>Adaptive 会在运行时根据传入的 URL 参数决定加载什么类型的 Transporter，默认为 NettyTransporter。下面我们继续跟下去，这次分析的是 NettyTransporter 的 bind 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>Server</span> <span class=nf>bind</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>listener</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=c1>// 创建 NettyServer</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>NettyServer</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>listener</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>这里仅有一句创建 NettyServer 的代码，无需多说，我们继续向下看。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NettyServer</span> <span class=kd>extends</span> <span class=n>AbstractServer</span> <span class=kd>implements</span> <span class=n>Server</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>NettyServer</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
        <span class=c1>// 调用父类构造方法</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandlers</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=n>handler</span><span class=p>,</span> <span class=n>ExecutorUtil</span><span class=p>.</span><span class=na>setThreadName</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>SERVER_THREAD_POOL_NAME</span><span class=p>)));</span>
    <span class=p>}</span>
<span class=p>}</span>


<span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>AbstractServer</span> <span class=kd>extends</span> <span class=n>AbstractEndpoint</span> <span class=kd>implements</span> <span class=n>Server</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>AbstractServer</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
        <span class=c1>// 调用父类构造方法，这里就不用跟进去了，没什么复杂逻辑</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
        <span class=n>localAddress</span> <span class=o>=</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>toInetSocketAddress</span><span class=p>();</span>

        <span class=c1>// 获取 ip 和端口</span>
        <span class=n>String</span> <span class=n>bindIp</span> <span class=o>=</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>BIND_IP_KEY</span><span class=p>,</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getHost</span><span class=p>());</span>
        <span class=kt>int</span> <span class=n>bindPort</span> <span class=o>=</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>BIND_PORT_KEY</span><span class=p>,</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getPort</span><span class=p>());</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>ANYHOST_KEY</span><span class=p>,</span> <span class=kc>false</span><span class=p>)</span> <span class=o>||</span> <span class=n>NetUtils</span><span class=p>.</span><span class=na>isInvalidLocalHost</span><span class=p>(</span><span class=n>bindIp</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// 设置 ip 为 0.0.0.0</span>
            <span class=n>bindIp</span> <span class=o>=</span> <span class=n>NetUtils</span><span class=p>.</span><span class=na>ANYHOST</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=n>bindAddress</span> <span class=o>=</span> <span class=k>new</span> <span class=n>InetSocketAddress</span><span class=p>(</span><span class=n>bindIp</span><span class=p>,</span> <span class=n>bindPort</span><span class=p>);</span>
        <span class=c1>// 获取最大可接受连接数</span>
        <span class=k>this</span><span class=p>.</span><span class=na>accepts</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>ACCEPTS_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_ACCEPTS</span><span class=p>);</span>
        <span class=k>this</span><span class=p>.</span><span class=na>idleTimeout</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>IDLE_TIMEOUT_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_IDLE_TIMEOUT</span><span class=p>);</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 调用模板方法 doOpen 启动服务器</span>
            <span class=n>doOpen</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RemotingException</span><span class=p>(</span><span class=s>&quot;Failed to bind &quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=n>DataStore</span> <span class=n>dataStore</span> <span class=o>=</span> <span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>DataStore</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getDefaultExtension</span><span class=p>();</span>
        <span class=n>executor</span> <span class=o>=</span> <span class=p>(</span><span class=n>ExecutorService</span><span class=p>)</span> <span class=n>dataStore</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>EXECUTOR_SERVICE_COMPONENT_KEY</span><span class=p>,</span> <span class=n>Integer</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getPort</span><span class=p>()));</span>
    <span class=p>}</span>

    <span class=kd>protected</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>doOpen</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Throwable</span><span class=p>;</span>

    <span class=kd>protected</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>doClose</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Throwable</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码多为赋值代码，不需要多讲。我们重点关注 doOpen 抽象方法，该方法需要子类实现。下面回到 NettyServer 中。</p> <div class=highlight><pre><span></span><code><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doOpen</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=p>{</span>
    <span class=n>NettyHelper</span><span class=p>.</span><span class=na>setNettyLoggerFactory</span><span class=p>();</span>
    <span class=c1>// 创建 boss 和 worker 线程池</span>
    <span class=n>ExecutorService</span> <span class=n>boss</span> <span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newCachedThreadPool</span><span class=p>(</span><span class=k>new</span> <span class=n>NamedThreadFactory</span><span class=p>(</span><span class=s>&quot;NettyServerBoss&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>));</span>
    <span class=n>ExecutorService</span> <span class=n>worker</span> <span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newCachedThreadPool</span><span class=p>(</span><span class=k>new</span> <span class=n>NamedThreadFactory</span><span class=p>(</span><span class=s>&quot;NettyServerWorker&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>));</span>
    <span class=n>ChannelFactory</span> <span class=n>channelFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NioServerSocketChannelFactory</span><span class=p>(</span><span class=n>boss</span><span class=p>,</span> <span class=n>worker</span><span class=p>,</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getPositiveParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>IO_THREADS_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_IO_THREADS</span><span class=p>));</span>

    <span class=c1>// 创建 ServerBootstrap</span>
    <span class=n>bootstrap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ServerBootstrap</span><span class=p>(</span><span class=n>channelFactory</span><span class=p>);</span>

    <span class=kd>final</span> <span class=n>NettyHandler</span> <span class=n>nettyHandler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NettyHandler</span><span class=p>(</span><span class=n>getUrl</span><span class=p>(),</span> <span class=k>this</span><span class=p>);</span>
    <span class=n>channels</span> <span class=o>=</span> <span class=n>nettyHandler</span><span class=p>.</span><span class=na>getChannels</span><span class=p>();</span>
    <span class=n>bootstrap</span><span class=p>.</span><span class=na>setOption</span><span class=p>(</span><span class=s>&quot;child.tcpNoDelay&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
    <span class=c1>// 设置 PipelineFactory</span>
    <span class=n>bootstrap</span><span class=p>.</span><span class=na>setPipelineFactory</span><span class=p>(</span><span class=k>new</span> <span class=n>ChannelPipelineFactory</span><span class=p>()</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>ChannelPipeline</span> <span class=nf>getPipeline</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>NettyCodecAdapter</span> <span class=n>adapter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NettyCodecAdapter</span><span class=p>(</span><span class=n>getCodec</span><span class=p>(),</span> <span class=n>getUrl</span><span class=p>(),</span> <span class=n>NettyServer</span><span class=p>.</span><span class=na>this</span><span class=p>);</span>
            <span class=n>ChannelPipeline</span> <span class=n>pipeline</span> <span class=o>=</span> <span class=n>Channels</span><span class=p>.</span><span class=na>pipeline</span><span class=p>();</span>
            <span class=n>pipeline</span><span class=p>.</span><span class=na>addLast</span><span class=p>(</span><span class=s>&quot;decoder&quot;</span><span class=p>,</span> <span class=n>adapter</span><span class=p>.</span><span class=na>getDecoder</span><span class=p>());</span>
            <span class=n>pipeline</span><span class=p>.</span><span class=na>addLast</span><span class=p>(</span><span class=s>&quot;encoder&quot;</span><span class=p>,</span> <span class=n>adapter</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>());</span>
            <span class=n>pipeline</span><span class=p>.</span><span class=na>addLast</span><span class=p>(</span><span class=s>&quot;handler&quot;</span><span class=p>,</span> <span class=n>nettyHandler</span><span class=p>);</span>
            <span class=k>return</span> <span class=n>pipeline</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>});</span>
    <span class=c1>// 绑定到指定的 ip 和端口上</span>
    <span class=n>channel</span> <span class=o>=</span> <span class=n>bootstrap</span><span class=p>.</span><span class=na>bind</span><span class=p>(</span><span class=n>getBindAddress</span><span class=p>());</span>
<span class=p>}</span>
</code></pre></div> <p>以上就是 NettyServer 创建的过程，dubbo 默认使用的 NettyServer 是基于 netty 3.x 版本实现的，比较老了。因此 Dubbo 另外提供了 netty 4.x 版本的 NettyServer，大家可在使用 Dubbo 的过程中按需进行配置。</p> <p>到此，关于服务导出的过程就分析完了。整个过程比较复杂，大家在分析的过程中耐心一些。并且多写 Demo 进行调试，以便能够更好的理解代码逻辑。</p> <p>本节内容先到这里，接下来分析服务导出的另一块逻辑 — 服务注册。</p> <h3 id=224>2.2.4 服务注册<a class=headerlink href=#224 title="Permanent link">&para;</a></h3> <p>本节我们来分析服务注册过程，服务注册操作对于 Dubbo 来说不是必需的，通过服务直连的方式就可以绕过注册中心。但通常我们不会这么做，直连方式不利于服务治理，仅推荐在测试服务时使用。对于 Dubbo 来说，注册中心虽不是必需，但却是必要的。因此，关于注册中心以及服务注册相关逻辑，我们也需要搞懂。</p> <p>本节内容以 Zookeeper 注册中心作为分析目标，其他类型注册中心大家可自行分析。下面从服务注册的入口方法开始分析，我们把目光再次移到 RegistryProtocol 的 export 方法上。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Exporter</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>export</span><span class=p>(</span><span class=kd>final</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>originInvoker</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>

    <span class=c1>// ${导出服务}</span>

    <span class=c1>// 省略其他代码</span>

    <span class=kt>boolean</span> <span class=n>register</span> <span class=o>=</span> <span class=n>registeredProviderUrl</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;register&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>register</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 注册服务</span>
        <span class=n>register</span><span class=p>(</span><span class=n>registryUrl</span><span class=p>,</span> <span class=n>registeredProviderUrl</span><span class=p>);</span>
        <span class=n>ProviderConsumerRegTable</span><span class=p>.</span><span class=na>getProviderWrapper</span><span class=p>(</span><span class=n>originInvoker</span><span class=p>).</span><span class=na>setReg</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>final</span> <span class=n>URL</span> <span class=n>overrideSubscribeUrl</span> <span class=o>=</span> <span class=n>getSubscribedOverrideUrl</span><span class=p>(</span><span class=n>registeredProviderUrl</span><span class=p>);</span>
    <span class=kd>final</span> <span class=n>OverrideListener</span> <span class=n>overrideSubscribeListener</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OverrideListener</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>originInvoker</span><span class=p>);</span>
    <span class=n>overrideListeners</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>overrideSubscribeListener</span><span class=p>);</span>
    <span class=c1>// 订阅 override 数据</span>
    <span class=n>registry</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>overrideSubscribeUrl</span><span class=p>,</span> <span class=n>overrideSubscribeListener</span><span class=p>);</span>

    <span class=c1>// 省略部分代码</span>
<span class=p>}</span>
</code></pre></div> <p>RegistryProtocol 的 export 方法包含了服务导出，注册，以及数据订阅等逻辑。其中服务导出逻辑上一节已经分析过了，本节将分析服务注册逻辑，相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kt>void</span> <span class=nf>register</span><span class=p>(</span><span class=n>URL</span> <span class=n>registryUrl</span><span class=p>,</span> <span class=n>URL</span> <span class=n>registedProviderUrl</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 获取 Registry</span>
    <span class=n>Registry</span> <span class=n>registry</span> <span class=o>=</span> <span class=n>registryFactory</span><span class=p>.</span><span class=na>getRegistry</span><span class=p>(</span><span class=n>registryUrl</span><span class=p>);</span>
    <span class=c1>// 注册服务</span>
    <span class=n>registry</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>registedProviderUrl</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>register 方法包含两步操作，第一步是获取注册中心实例，第二步是向注册中心注册服务。接下来分两节内容对这两步操作进行分析。</p> <h4 id=2241>2.2.4.1 创建注册中心<a class=headerlink href=#2241 title="Permanent link">&para;</a></h4> <p>本节内容以 Zookeeper 注册中心为例进行分析。下面先来看一下 getRegistry 方法的源码，这个方法由 AbstractRegistryFactory 实现。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>Registry</span> <span class=nf>getRegistry</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>setPath</span><span class=p>(</span><span class=n>RegistryService</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>())</span>
            <span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>INTERFACE_KEY</span><span class=p>,</span> <span class=n>RegistryService</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>())</span>
            <span class=p>.</span><span class=na>removeParameters</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>EXPORT_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>REFER_KEY</span><span class=p>);</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>toServiceString</span><span class=p>();</span>
    <span class=n>LOCK</span><span class=p>.</span><span class=na>lock</span><span class=p>();</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 访问缓存</span>
        <span class=n>Registry</span> <span class=n>registry</span> <span class=o>=</span> <span class=n>REGISTRIES</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registry</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>registry</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=c1>// 缓存未命中，创建 Registry 实例</span>
        <span class=n>registry</span> <span class=o>=</span> <span class=n>createRegistry</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registry</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Can not create registry...&quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 写入缓存</span>
        <span class=n>REGISTRIES</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>registry</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>registry</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
        <span class=n>LOCK</span><span class=p>.</span><span class=na>unlock</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kd>protected</span> <span class=kd>abstract</span> <span class=n>Registry</span> <span class=nf>createRegistry</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>);</span>
</code></pre></div> <p>如上，getRegistry 方法先访问缓存，缓存未命中则调用 createRegistry 创建 Registry，然后写入缓存。这里的 createRegistry 是一个模板方法，由具体的子类实现。因此，下面我们到 ZookeeperRegistryFactory 中探究一番。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZookeeperRegistryFactory</span> <span class=kd>extends</span> <span class=n>AbstractRegistryFactory</span> <span class=p>{</span>

    <span class=c1>// zookeeperTransporter 由 SPI 在运行时注入，类型为 ZookeeperTransporter$Adaptive</span>
    <span class=kd>private</span> <span class=n>ZookeeperTransporter</span> <span class=n>zookeeperTransporter</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setZookeeperTransporter</span><span class=p>(</span><span class=n>ZookeeperTransporter</span> <span class=n>zookeeperTransporter</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>zookeeperTransporter</span> <span class=o>=</span> <span class=n>zookeeperTransporter</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Registry</span> <span class=nf>createRegistry</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 创建 ZookeeperRegistry</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>ZookeeperRegistry</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>zookeeperTransporter</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>ZookeeperRegistryFactory 的 createRegistry 方法仅包含一句代码，无需解释，继续跟下去。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=nf>ZookeeperRegistry</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ZookeeperTransporter</span> <span class=n>zookeeperTransporter</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>isAnyHost</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;registry address == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 获取组名，默认为 dubbo</span>
    <span class=n>String</span> <span class=n>group</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>GROUP_KEY</span><span class=p>,</span> <span class=n>DEFAULT_ROOT</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>group</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PATH_SEPARATOR</span><span class=p>))</span> <span class=p>{</span>
        <span class=c1>// group = &quot;/&quot; + group</span>
        <span class=n>group</span> <span class=o>=</span> <span class=n>Constants</span><span class=p>.</span><span class=na>PATH_SEPARATOR</span> <span class=o>+</span> <span class=n>group</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>this</span><span class=p>.</span><span class=na>root</span> <span class=o>=</span> <span class=n>group</span><span class=p>;</span>
    <span class=c1>// 创建 Zookeeper 客户端，默认为 CuratorZookeeperTransporter</span>
    <span class=n>zkClient</span> <span class=o>=</span> <span class=n>zookeeperTransporter</span><span class=p>.</span><span class=na>connect</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=c1>// 添加状态监听器</span>
    <span class=n>zkClient</span><span class=p>.</span><span class=na>addStateListener</span><span class=p>(</span><span class=k>new</span> <span class=n>StateListener</span><span class=p>()</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateChanged</span><span class=p>(</span><span class=kt>int</span> <span class=n>state</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>RECONNECTED</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=n>recover</span><span class=p>();</span>
                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>logger</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>});</span>
<span class=p>}</span>
</code></pre></div> <p>在上面的代码代码中，我们重点关注 ZookeeperTransporter 的 connect 方法调用，这个方法用于创建 Zookeeper 客户端。创建好 Zookeeper 客户端，意味着注册中心的创建过程就结束了。接下来，再来分析一下 Zookeeper 客户端的创建过程。</p> <p>前面说过，这里的 zookeeperTransporter 类型为自适应拓展类，因此 connect 方法会在被调用时决定加载什么类型的 ZookeeperTransporter 拓展，默认为 CuratorZookeeperTransporter。下面我们到 CuratorZookeeperTransporter 中看一看。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>ZookeeperClient</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 创建 CuratorZookeeperClient</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>CuratorZookeeperClient</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>继续向下看。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CuratorZookeeperClient</span> <span class=kd>extends</span> <span class=n>AbstractZookeeperClient</span><span class=o>&lt;</span><span class=n>CuratorWatcher</span><span class=o>&gt;</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=kd>final</span> <span class=n>CuratorFramework</span> <span class=n>client</span><span class=p>;</span>

    <span class=kd>public</span> <span class=nf>CuratorZookeeperClient</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 创建 CuratorFramework 构造器</span>
            <span class=n>CuratorFrameworkFactory</span><span class=p>.</span><span class=na>Builder</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>CuratorFrameworkFactory</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span>
                    <span class=p>.</span><span class=na>connectString</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getBackupAddress</span><span class=p>())</span>
                    <span class=p>.</span><span class=na>retryPolicy</span><span class=p>(</span><span class=k>new</span> <span class=n>RetryNTimes</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=p>))</span>
                    <span class=p>.</span><span class=na>connectionTimeoutMs</span><span class=p>(</span><span class=mi>5000</span><span class=p>);</span>
            <span class=n>String</span> <span class=n>authority</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getAuthority</span><span class=p>();</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>authority</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>authority</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=p>.</span><span class=na>authorization</span><span class=p>(</span><span class=s>&quot;digest&quot;</span><span class=p>,</span> <span class=n>authority</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span>
            <span class=p>}</span>
            <span class=c1>// 构建 CuratorFramework 实例</span>
            <span class=n>client</span> <span class=o>=</span> <span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
            <span class=c1>// 添加监听器</span>
            <span class=n>client</span><span class=p>.</span><span class=na>getConnectionStateListenable</span><span class=p>().</span><span class=na>addListener</span><span class=p>(</span><span class=k>new</span> <span class=n>ConnectionStateListener</span><span class=p>()</span> <span class=p>{</span>
                <span class=nd>@Override</span>
                <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateChanged</span><span class=p>(</span><span class=n>CuratorFramework</span> <span class=n>client</span><span class=p>,</span> <span class=n>ConnectionState</span> <span class=n>state</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>ConnectionState</span><span class=p>.</span><span class=na>LOST</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>CuratorZookeeperClient</span><span class=p>.</span><span class=na>this</span><span class=p>.</span><span class=na>stateChanged</span><span class=p>(</span><span class=n>StateListener</span><span class=p>.</span><span class=na>DISCONNECTED</span><span class=p>);</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>ConnectionState</span><span class=p>.</span><span class=na>CONNECTED</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>CuratorZookeeperClient</span><span class=p>.</span><span class=na>this</span><span class=p>.</span><span class=na>stateChanged</span><span class=p>(</span><span class=n>StateListener</span><span class=p>.</span><span class=na>CONNECTED</span><span class=p>);</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>state</span> <span class=o>==</span> <span class=n>ConnectionState</span><span class=p>.</span><span class=na>RECONNECTED</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>CuratorZookeeperClient</span><span class=p>.</span><span class=na>this</span><span class=p>.</span><span class=na>stateChanged</span><span class=p>(</span><span class=n>StateListener</span><span class=p>.</span><span class=na>RECONNECTED</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>});</span>

            <span class=c1>// 启动客户端</span>
            <span class=n>client</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>CuratorZookeeperClient 构造方法主要用于创建和启动 CuratorFramework 实例。以上基本上都是 Curator 框架的代码，大家如果对 Curator 框架不是很了解，可以参考 Curator 官方文档。</p> <p>本节分析了 ZookeeperRegistry 实例的创建过程，整个过程并不是很复杂。大家在看完分析后，可以自行调试，以加深理解。现在注册中心实例创建好了，接下来要做的事情是向注册中心注册服务，我们继续往下看。</p> <h4 id=2242>2.2.4.2 节点创建<a class=headerlink href=#2242 title="Permanent link">&para;</a></h4> <p>以 Zookeeper 为例，所谓的服务注册，本质上是将服务配置数据写入到 Zookeeper 的某个路径的节点下。为了让大家有一个直观的了解，下面我们将 Dubbo 的 demo 跑起来，然后通过 Zookeeper 可视化客户端 <a href=https://github.com/apache/zookeeper/tree/b79af153d0f98a4f3f3516910ed47234d7b3d74e/src/contrib/zooinspector>ZooInspector</a> 查看节点数据。如下：</p> <p><img alt src=../sources/images/service-registry.png></p> <p>从上图中可以看到 com.alibaba.dubbo.demo.DemoService 这个服务对应的配置信息（存储在 URL 中）最终被注册到了 /dubbo/com.alibaba.dubbo.demo.DemoService/providers/ 节点下。搞懂了服务注册的本质，那么接下来我们就可以去阅读服务注册的代码了。服务注册的接口为 register(URL)，这个方法定义在 FailbackRegistry 抽象类中。代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kt>void</span> <span class=nf>register</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=n>failedRegistered</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=n>failedUnregistered</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 模板方法，由子类实现</span>
        <span class=n>doRegister</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Throwable</span> <span class=n>t</span> <span class=o>=</span> <span class=n>e</span><span class=p>;</span>

        <span class=c1>// 获取 check 参数，若 check = true 将会直接抛出异常</span>
        <span class=kt>boolean</span> <span class=n>check</span> <span class=o>=</span> <span class=n>getUrl</span><span class=p>().</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CHECK_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
                <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CHECK_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
                <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>CONSUMER_PROTOCOL</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>());</span>
        <span class=kt>boolean</span> <span class=n>skipFailback</span> <span class=o>=</span> <span class=n>t</span> <span class=k>instanceof</span> <span class=n>SkipFailbackWrapperException</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>check</span> <span class=o>||</span> <span class=n>skipFailback</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>skipFailback</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>t</span> <span class=o>=</span> <span class=n>t</span><span class=p>.</span><span class=na>getCause</span><span class=p>();</span>
            <span class=p>}</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Failed to register&quot;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>logger</span><span class=p>.</span><span class=na>error</span><span class=p>(</span><span class=s>&quot;Failed to register&quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 记录注册失败的链接</span>
        <span class=n>failedRegistered</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kd>protected</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>doRegister</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>);</span>
</code></pre></div> <p>如上，我们重点关注 doRegister 方法调用即可，其他的代码先忽略。doRegister 方法是一个模板方法，因此我们到 FailbackRegistry 子类 ZookeeperRegistry 中进行分析。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doRegister</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 通过 Zookeeper 客户端创建节点，节点路径由 toUrlPath 方法生成，路径格式如下:</span>
        <span class=c1>//   /${group}/${serviceInterface}/providers/${url}</span>
        <span class=c1>// 比如</span>
        <span class=c1>//   /dubbo/org.apache.dubbo.DemoService/providers/dubbo%3A%2F%2F127.0.0.1......</span>
        <span class=n>zkClient</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>toUrlPath</span><span class=p>(</span><span class=n>url</span><span class=p>),</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DYNAMIC_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>));</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Failed to register...&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>如上，ZookeeperRegistry 在 doRegister 中调用了 Zookeeper 客户端创建服务节点。节点路径由 toUrlPath 方法生成，该方法逻辑不难理解，就不分析了。接下来分析 create 方法，如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kt>void</span> <span class=nf>create</span><span class=p>(</span><span class=n>String</span> <span class=n>path</span><span class=p>,</span> <span class=kt>boolean</span> <span class=n>ephemeral</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>ephemeral</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 如果要创建的节点类型非临时节点，那么这里要检测节点是否存在</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>checkExists</span><span class=p>(</span><span class=n>path</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>return</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>path</span><span class=p>.</span><span class=na>lastIndexOf</span><span class=p>(</span><span class=sc>&#39;/&#39;</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 递归创建上一级路径</span>
        <span class=n>create</span><span class=p>(</span><span class=n>path</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>),</span> <span class=kc>false</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 根据 ephemeral 的值创建临时或持久节点</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ephemeral</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>createEphemeral</span><span class=p>(</span><span class=n>path</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>createPersistent</span><span class=p>(</span><span class=n>path</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>上面方法先是通过递归创建当前节点的上一级路径，然后再根据 ephemeral 的值决定创建临时还是持久节点。createEphemeral 和 createPersistent 这两个方法都比较简单，这里简单分析其中的一个。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kt>void</span> <span class=nf>createEphemeral</span><span class=p>(</span><span class=n>String</span> <span class=n>path</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 通过 Curator 框架创建节点</span>
        <span class=n>client</span><span class=p>.</span><span class=na>create</span><span class=p>().</span><span class=na>withMode</span><span class=p>(</span><span class=n>CreateMode</span><span class=p>.</span><span class=na>EPHEMERAL</span><span class=p>).</span><span class=na>forPath</span><span class=p>(</span><span class=n>path</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>NodeExistsException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>好了，到此关于服务注册的过程就分析完了。整个过程可简单总结为：先创建注册中心实例，之后再通过注册中心实例注册服务。本节先到这，接下来分析数据订阅过程。</p> <h3 id=225-override>2.2.5 订阅 override 数据<a class=headerlink href=#225-override title="Permanent link">&para;</a></h3> <p>// 待补充</p> <h2 id=3>3.总结<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>本篇文章详细分析了 Dubbo 服务导出过程，包括配置检测，URL 组装，Invoker 创建过程、导出服务以及注册服务等等。篇幅比较大，需要大家耐心阅读。本篇文章先就到这，如果文章有不妥错误之处，希望大家能够进行反馈或修正。</p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=http://www.apache.org target=_blank rel=noopener title=Fundation class=md-footer-social__link> <!-- Created with Inkscape (http://www.inkscape.org/) --> <svg id=svg2 xmlns:rdf=http://www.w3.org/1999/02/22-rdf-syntax-ns# xmlns=http://www.w3.org/2000/svg version=1.0 xmlns:cc=http://creativecommons.org/ns# xmlns:xlink=http://www.w3.org/1999/xlink xmlns:dc=http://purl.org/dc/elements/1.1/ viewbox="0 0 100 100"> <defs id=defs4></defs> <metadata id=metadata7> <rdf:rdf> <cc:work rdf:about> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource=http://purl.org/dc/dcmitype/StillImage /> <dc:title/> <dc:creator> <cc:agent> <dc:title>hrum</dc:title> </cc:agent> </dc:creator> <dc:subject> <rdf:bag> <rdf:li>feather</rdf:li> <rdf:li>bird</rdf:li> </rdf:bag> </dc:subject> <cc:license rdf:resource=http://creativecommons.org/licenses/publicdomain/ /> </cc:work> <cc:license rdf:about=http://creativecommons.org/licenses/publicdomain/ > <cc:permits rdf:resource=http://creativecommons.org/ns#Reproduction /> <cc:permits rdf:resource=http://creativecommons.org/ns#Distribution /> <cc:permits rdf:resource=http://creativecommons.org/ns#DerivativeWorks /> </cc:license> </rdf:rdf> </metadata> <g id=layer1 transform=translate(-41.7017,-537.54073)> <g id=g4360 transform=matrix(0.15183836,0,0,0.15183768,35.369777,531.73802)> <path id=path2383 d=m96.031,0.5c-0.11611,0.00905-0.21242,0.048559-0.3125,0.09375-0.01283,0.005794-0.01874,0.024769-0.03125,0.03125-0.1786,0.010474-0.37198,0.01281-0.5625,0.03125-0.48231-0.1012-1.2249,0.09014-1.6562,0.21875-0.02198,0.004551-0.04048,0.026713-0.0625,0.03125-0.01064,0.001936-0.02058-0.001954-0.03125,0-0.37705,0.07741-0.75408,0.17201-1.125,0.25-0.11794,0.026255-0.22334,0.034381-0.34375,0.0625-0.25616,0.05799-0.51562,0.11856-0.75,0.1875-0.29027,0.074001-0.57253,0.13524-0.875,0.21875-0.0629,0.15674-0.15229,0.33489-0.21875,0.5-0.32718,0.53485-0.55142,1.2906-0.8125,2.0312-0.08476,0.20698-0.16919,0.42932-0.25,0.625-0.11753,0.2846-0.05639,0.16641-0.15625,0.40625-0.01601,0.038442-0.01569,0.025179-0.03125,0.0625-0.0091,0.021933-0.02226,0.0097-0.03125,0.03125-0.07806,0.13316-0.1588,0.25776-0.25,0.375-0.02468,0.15462-0.03959,0.25842-0.0625,0.375-0.0019,0.00947,0.0021,0.021613,0,0.03125-0.06921,0.16338-0.13727,0.32005-0.1875,0.4375-0.01776,0.041518-0.04706,0.12026-0.0625,0.15625-0.03266,0.071089-0.07809,0.1513-0.09375,0.1875-0.0993,0.013748-0.12753-0.23997-0.09375-0.59375,0.0022-0.022625-0.0029-0.039158,0-0.0625,0.04221-0.2299,0.04549-0.20195,0.09375-0.46875,0.0017-0.00939-0.0017-0.021822,0-0.03125,0.0042-0.012389,0.02655-0.018696,0.03125-0.03125,0.03816-0.102,0.0731-0.21479,0.125-0.3125,0.06341-0.52902,0.09063-0.86367,0.125-1.2188,0.01233-0.077645,0.02035-0.14453,0.03125-0.21875,0.0017-0.0108-0.0017-0.020532,0-0.03125,0.04858-0.31393,0.08164-0.58275,0.125-0.875,0.0019-0.00867-0.0019-0.022528,0-0.03125,0.0019-0.0087-0.002-0.022515,0-0.03125,0.0508-0.22677,0.12871-0.46196,0.21875-0.75-0.02627,0.00749-0.06669,0.023215-0.09375,0.03125,0.0031-0.0285-0.0029-0.065707,0-0.09375-0.67942,0.20952-1.3995,0.43847-2.125,0.6875-0.22113,0.040554-0.45688,0.077095-0.6875,0.09375-0.17688,0.11654-0.37152,0.24094-0.5625,0.34375-0.02018,0.010866-0.04218,0.02052-0.0625,0.03125-0.52999,0.1916-1.0446,0.38376-1.5938,0.59375-0.88593,0.33238-1.778,0.67256-2.7188,1.0625-0.01281,0.00529-0.01843,0.025948-0.03125,0.03125-0.08058,0.035042-0.17025,0.060457-0.25,0.09375-0.07998,0.033919-0.17176,0.058538-0.25,0.09375-0.18559,0.080466-0.37666,0.16781-0.5625,0.25-0.37804,0.16103-0.77334,0.33133-1.1562,0.5-0.19405,0.084859-0.39903,0.16257-0.59375,0.25-0.01286,0.00571-0.01839,0.025536-0.03125,0.03125-0.05,0.022186-0.10617,0.040202-0.15625,0.0625-0.38536,0.17408-0.76476,0.35248-1.1562,0.53125-0.06392,0.029525-0.12347,0.06405-0.1875,0.09375-0.36319,0.16652-0.72706,0.32796-1.0938,0.5-0.72818,0.34328-1.4447,0.69857-2.1875,1.0625-1.0198,0.4999-2.0282,1.0252-3.0625,1.5625-0.0083,0.0043-0.02294-0.00432-0.03125,0-0.02093,0.01087-0.04157,0.02037-0.0625,0.03125-0.02896,0.01506-0.06478,0.01617-0.09375,0.03125-0.62,0.274-1.219,0.561-1.784,0.938-0.04269,0.03063-0.08287,0.0634-0.125,0.09375-0.03038,0.02188-0.06254,0.04166-0.09375,0.0625-0.51982,0.2809-1.0421,0.55451-1.5625,0.84375-0.17665,0.09551-0.35544,0.18268-0.53125,0.28125-0.08605,0.04802-0.16403,0.10777-0.25,0.15625-0.22385,0.118-0.44162,0.24501-0.65625,0.375-0.98276,0.56061-1.9613,1.1313-2.9375,1.7188-0.21693,0.12919-0.44065,0.24381-0.65625,0.375-0.11629,0.0706-0.2278,0.14766-0.34375,0.21875-0.17035,0.08122-0.31241,0.20292-0.46875,0.3125-0.14267,0.08824-0.29513,0.16124-0.4375,0.25-0.0076,0.0047-0.02369-0.0047-0.03125,0-0.75333,0.27006-1.3421,0.83453-1.9688,1.2812-0.01862,0.01328-0.04382,0.01816-0.0625,0.03125-0.01939,0.01258-0.04312,0.01866-0.0625,0.03125-0.01286,0.0057-0.01957,0.02365-0.03125,0.03125-0.01937,0.01259-0.04313,0.01865-0.0625,0.03125-0.19316,0.1283-0.38322,0.25172-0.59375,0.34375-0.09694,0.09197-0.20774,0.16748-0.3125,0.25-0.01151,0.0091-0.01983,0.02209-0.03125,0.03125-0.04057,0.03254-0.0836,0.06222-0.125,0.09375-0.03859,0.02566-0.08645,0.0368-0.125,0.0625-0.25449,0.17098-0.49662,0.3595-0.75,0.53125-0.03815,0.02598-0.08691,0.03648-0.125,0.0625-0.03327,0.01741-0.06278,0.04143-0.09375,0.0625-0.8407,0.49023-1.7095,0.94719-2.375,1.625-0.38659,0.30315-0.80514,0.62819-1.2188,0.9375-0.06051,0.04525-0.12765,0.08003-0.1875,0.125-0.10824,0.08028-0.20518,0.16964-0.3125,0.25-0.23954,0.1682-0.48848,0.32484-0.71875,0.5-0.19592,0.14901-0.36849,0.3188-0.5625,0.46875-0.12308,0.09525-0.2522,0.18545-0.375,0.28125-0.03077,0.02329-0.06298,0.03916-0.09375,0.0625-0.33367,0.26123-0.67257,0.5175-1,0.78125-0.65632,0.51336-1.2871,1.0497-1.9062,1.5938-0.0793,0.06773-0.17116,0.11964-0.25,0.1875-0.10365,0.09293-0.21073,0.18729-0.3125,0.28125-0.09455,0.08326-0.18719,0.16638-0.28125,0.25-0.1537,0.13465-0.31699,0.27116-0.46875,0.40625-0.06041,0.0545-0.12791,0.10097-0.1875,0.15625-0.14642,0.13148-0.29297,0.27442-0.4375,0.40625-0.14899,0.14235-0.28658,0.29727-0.4375,0.4375-0.43949,0.40737-0.89241,0.8081-1.3125,1.2188-0.1596,0.15224-0.30971,0.31599-0.46875,0.46875-0.0328,0.03217-0.06103,0.06164-0.09375,0.09375-0.04363,0.04282-0.0815,0.08228-0.125,0.125-0.05419,0.05324-0.10228,0.10316-0.15625,0.15625-1.0499,1.0097-2.1036,2.0159-3.1562,3.0312-0.08939,0.13409-0.18386,0.24977-0.28125,0.375-0.03226,0.03253-0.06177,0.06143-0.09375,0.09375-0.36981,0.37315-0.70391,0.72855-1.0625,1.0938-0.07138,0.07319-0.14669,0.14521-0.21875,0.21875-0.07361,0.07278-0.14687,0.14525-0.21875,0.21875-0.05418,0.04812-0.10209,0.10832-0.15625,0.15625-0.6873,0.60825-1.3566,1.199-1.875,1.9375-0.0098,0.01017-0.02152,0.0211-0.03125,0.03125-0.02293,0.02958-0.04163,0.06215-0.0625,0.09375-0.11999,0.12663-0.25262,0.24251-0.375,0.375-0.15042,0.14713-0.30247,0.29536-0.4375,0.4375-0.0049,0.0052,0.0049,0.0261,0,0.03125-0.90058,0.9482-1.7125,1.8287-2.5312,2.7188-0.01237,0.0091-0.01877,0.02219-0.03125,0.03125-0.0062,0.0136-0.02491,0.01777-0.03125,0.03125-0.22873,0.24884-0.4304,0.50271-0.65625,0.75-0.11355,0.12476-0.26304,0.2514-0.375,0.375-0.11804,0.13031-0.22675,0.24557-0.34375,0.375-0.07257,0.08041-0.14742,0.17055-0.21875,0.25-0.01104,0.0086-0.02029,0.02266-0.03125,0.03125-0.03044,0.03393-0.06343,0.05991-0.09375,0.09375-0.26141,0.21433-0.49765,0.43018-0.65625,0.71875-0.01132,0.02061-0.02057,0.04121-0.03125,0.0625-0.08867,0.10015-0.16198,0.21077-0.25,0.3125-0.23115,0.26062-0.49777,0.52738-0.71875,0.78125-0.55744,0.64086-1.0833,1.2677-1.5938,1.875-0.01826,0.02168-0.04432,0.04084-0.0625,0.0625-0.04471,0.05326-0.0807,0.10322-0.125,0.15625-0.08524,0.09547-0.17368,0.18961-0.25,0.28125-0.20894,0.25123-0.41706,0.49176-0.625,0.75-0.20818,0.25731-0.42579,0.52999-0.625,0.78125-0.06276,0.07865-0.12662,0.17389-0.1875,0.25-0.43479,0.55175-0.85205,1.1048-1.25,1.625-0.30879,0.40388-0.65409,0.83399-0.9375,1.2188-0.03093,0.04198-0.0631,0.08322-0.09375,0.125-0.10294,0.14034-0.18258,0.26949-0.28125,0.40625-0.03749,0.05148-0.08834,0.10524-0.125,0.15625-0.07053,0.09815-0.11847,0.18422-0.1875,0.28125-0.20643,0.29123-0.42961,0.59018-0.625,0.875-0.24296,0.35439-0.49761,0.72385-0.71875,1.0625-0.0581,0.08889-0.09962,0.16227-0.15625,0.25-0.01898,0.02945-0.04369,0.06443-0.0625,0.09375-0.25727,0.40116-0.49656,0.807-0.71875,1.1875-0.22382,0.3728-0.42975,0.74168-0.625,1.0938-0.27165,0.48982-0.56258,0.98354-0.78125,1.4375-0.17374,0.36071-0.32657,0.72319-0.46875,1.0625-0.0085,0.0204-0.02282,0.04229-0.03125,0.0625-0.12366,0.29789-0.24392,0.59455-0.34375,0.875-0.0217,0.05934-0.04189,0.12893-0.0625,0.1875-0.07827,0.22262-0.15736,0.44434-0.21875,0.65625-0.03575,0.12177-0.06326,0.25682-0.09375,0.375-0.01865,0.07303-0.04552,0.14758-0.0625,0.21875-0.07852,0.33009-0.14502,0.66533-0.1875,0.96875-0.0342,0.24409-0.05032,0.45978-0.0625,0.6875-0.0042,0.07759,0.00049,0.14378,0,0.21875-0.000422,0.01968,0.000261,0.04292,0,0.0625-0.0029,0.21573,0.01474,0.42379,0.03125,0.625,0.0018,0.01997-0.0018,0.04259,0,0.0625,0.01502,0.16655,0.0036,0.34299,0.03125,0.5,0.01966,0.10867,0.06827,0.20824,0.09375,0.3125,0.008,0.03154,0.02313,0.06297,0.03125,0.09375,0.02506,0.09566,0.06386,0.18925,0.09375,0.28125,0.01604,0.04918,0.01388,0.10808,0.03125,0.15625,0.02512,0.06933,0.03468,0.15148,0.0625,0.21875-0.77537,0.98099-1.5109,1.9373-2.25,2.9062-0.32102,0.41317-0.65891,0.8379-0.96875,1.25-0.04411,0.05865-0.08103,0.12893-0.125,0.1875-0.10897,0.1452-0.23571,0.29283-0.34375,0.4375-1.5333,2.0531-2.9225,4.0143-4.25,5.9062-0.63407,0.90333-1.2941,1.8382-1.875,2.6875-0.54506,0.79753-1.0366,1.5098-1.5312,2.25-0.1726,0.266-0.3614,0.564-0.5286,0.816-0.1339,0.202-0.214,0.334-0.3437,0.531-0.0971,0.147-0.2178,0.325-0.3125,0.469-0.72056,1.0998-1.3956,2.1626-1.9688,3.0625-0.025009,0.0393-0.069036,0.08612-0.09375,0.125-0.10881,0.16721-0.21857,0.35114-0.3125,0.5-0.051976,0.08069-0.1058,0.16977-0.15625,0.25-0.085634,0.136-0.16883,0.24549-0.25,0.375-0.28116,0.44105-0.56814,0.90528-0.78125,1.25-0.010208,0.01653-0.021154,0.04614-0.03125,0.0625-0.20162,0.33011-0.48004,0.7923-0.625,1.0312-0.22291,0.372-0.6562,1.095-0.6562,1.095l0.28125,0.25,6.0312-6.25s0.24131-0.42207,0.375-0.65625c0.017337-0.02973,0.064714-0.07821,0.09375-0.125,0.072241-0.12464,0.056555-0.11385,0.15625-0.28125,0.02077-0.03496,0.041312-0.09007,0.0625-0.125,0.12515-0.20771,0.33862-0.52129,0.5-0.78125,0.14196-0.22979,0.24926-0.40852,0.40625-0.65625,0.00988-0.01555,0.01721-0.04174,0.03125-0.0625,0.00674-0.01058,0.024461-0.02061,0.03125-0.03125,0.0068-0.012,0.0247-0.023,0.0314-0.033,0.42069-0.65967,0.99248-1.5204,1.5938-2.4062,0.099631-0.14787,0.14552-0.25386,0.25-0.40625,0.00783-0.01142,0.023387-0.0198,0.03125-0.03125,0.3933-0.57312,0.81339-1.1559,1.2812-1.8125,0.09923-0.13913,0.20985-0.32595,0.3125-0.46875,0.52426-0.72912,1.1026-1.5204,1.7188-2.3438,0.0095-0.01271,0.02172-0.01852,0.03125-0.03125,0.02144-0.02863,0.04065-0.06479,0.0625-0.09375,0.22488-0.29988,0.51277-0.65684,0.75-0.96875,0.62874-0.82658,1.3133-1.7141,2.0312-2.625,0.0085-0.01073,0.02276-0.0205,0.03125-0.03125,0.0677-0.08584,0.11895-0.16352,0.1875-0.25,0.95022-1.1987,1.9528-2.4466,3.0625-3.7812,0.05176-0.01898,0.10346-0.04154,0.15625-0.0625l-0.125,0.125,2.0625-0.59375s0.73975-0.27282,1.2812-0.46875c0.18474-0.0683,0.53265-0.1995,0.75-0.28125,0.73616-0.19447,1.4325-0.36279,2.0938-0.5,0.05156-0.0107,0.10556-0.01572,0.15625-0.03125,0.69198-0.14116,1.312-0.24664,1.9375-0.34375,0.01956-0.003,0.04299,0.003,0.0625,0,0.59682-0.09116,1.168-0.18278,1.7188-0.25,0.45233-0.0552,0.88256-0.10748,1.3125-0.15625,0.11747-0.01353,0.2276-0.01782,0.34375-0.03125,1.0729-0.12241,2.0941-0.2433,3.125-0.4375,0.27684-0.05215,0.56224-0.12636,0.84375-0.1875s0.55912-0.10923,0.84375-0.1875c0.03055-0.0084,0.06312-0.02267,0.09375-0.03125,0.04084-0.01128,0.08403-0.01964,0.125-0.03125,0.11367-0.03266,0.22812-0.08841,0.34375-0.125,0.09247-0.0266,0.18887-0.03705,0.28125-0.0625,0.02204-0.0073,0.04042-0.02383,0.0625-0.03125,0.03189-0.01047,0.06176-0.02055,0.09375-0.03125,0.06132-0.02033,0.12523-0.04235,0.1875-0.0625,0.15218-0.05262,0.31426-0.09712,0.46875-0.15625,0.04911-0.01849,0.10684-0.04344,0.15625-0.0625h0.03125c0.03461-0.01265,0.05937-0.0492,0.09375-0.0625,0.3349-0.12953,0.66938-0.26405,1-0.40625,0.16353-0.07034,0.34014-0.1128,0.5-0.1875,0.71301-0.17104,1.3067-0.61474,1.875-1.0312,0.02417-0.01772,0.03824-0.04684,0.0625-0.0625,0.0852-0.0503,0.19491-0.10416,0.28125-0.15625,0.20682-0.12432,0.41128-0.24007,0.625-0.375,0.03059-0.01931,0.06301-0.04296,0.09375-0.0625,0.23168-0.11112,0.46075-0.21134,0.71875-0.25,1.9689-1.5011,4.1265-3.2242,5.9375-4.6562,0.61676-0.6195,1.2883-1.2524,1.9688-1.875,0.17178-0.15367,0.3872-0.34155,0.5625-0.5l0.03-0.033c0.33064-0.30342,0.63743-0.63056,0.96875-0.9375,0.19266-0.17734,0.39692-0.3483,0.59375-0.53125,0.49666-0.46166,1.0703-1.0299,1.5938-1.5312,0.01586-0.01519,0.04646-0.01608,0.0625-0.03125,0.1375-0.13115,0.29807-0.30378,0.4375-0.4375,0.59317-0.56924,1.2771-1.2268,1.9062-1.8438,2.3912-2.287,4.7767-4.592,7.2812-6.75,0.01109-0.0096,0.02016-0.0217,0.03125-0.03125,0.0726-0.06249,0.14596-0.12523,0.21875-0.1875,0.20587-0.16977,0.41795-0.3324,0.625-0.5,0.08119-0.06578,0.16836-0.12266,0.25-0.1875,0.39435-0.31736,0.7892-0.62672,1.1875-0.9375,0.44532-0.34666,0.89441-0.69246,1.3438-1.0312,0.06509-0.04921,0.12247-0.10709,0.1875-0.15625,0.7891-0.59394,1.5779-1.1775,2.375-1.75,0.1576-0.11322,0.31095-0.2313,0.46875-0.34375,0.63777-0.45859,1.293-0.89688,1.9375-1.3438,1.1514-0.79715,2.2929-1.5786,3.4375-2.3438,0.10488-0.07012,0.20581-0.14878,0.3125-0.21875,0.11193-0.07464,0.22806-0.14605,0.34375-0.21875,0.14268-0.09496,0.2951-0.1867,0.4375-0.28125,0.0866-0.05723,0.16337-0.13032,0.25-0.1875,0.97864-0.6493,1.9162-1.2727,2.875-1.9062,0.59018-0.38925,1.1924-0.7639,1.7812-1.1562,0.55459-0.36889,1.082-0.7278,1.625-1.0938,1.2371-0.71014,2.3922-1.5594,3.5312-2.4375,0.44109-0.34004,0.90338-0.65621,1.3438-1,0.67747-0.49834,1.3305-0.9988,1.9688-1.5,0.55692-0.43636,1.1003-0.87195,1.625-1.3125,0.03048-0.02233,0.06213-0.04247,0.09375-0.0625,0.0281-0.02369,0.06575-0.0388,0.09375-0.0625,0.02216-0.01876,0.04041-0.04373,0.0625-0.0625,0.61656-0.4569,1.2068-0.93099,1.6562-1.4688,0.01877-0.02246,0.0443-0.03984,0.0625-0.0625,0.29507-0.27706,0.60034-0.55727,0.875-0.84375-0.05312-0.29561-0.14424-0.64004-0.21875-0.96875-0.01861-0.33997-0.09361-0.70448-0.28125-1.0938-0.0087-0.06982-0.04969-0.12065-0.0625-0.1875-0.09508-0.49607-0.32811-0.88718-0.59375-1.25-0.005-0.0068,0.0051-0.02444,0-0.03125-0.03545-0.04996-0.08477-0.10574-0.125-0.15625-0.11152-0.13644-0.21836-0.27765-0.34375-0.40625-0.0047-0.0053,0.0048-0.02596,0-0.03125-0.01426-0.01583-0.01675-0.04662-0.03125-0.0625-0.182-0.181-0.375-0.363-0.565-0.533-0.109-0.105-0.229-0.208-0.344-0.313-0.111-0.1-0.205-0.21-0.312-0.312-0.04019-0.03507-0.0845-0.05889-0.125-0.09375-0.01048-0.01036-0.02085-0.02085-0.03125-0.03125-0.13022-0.13019-0.26001-0.26715-0.375-0.40625-0.01282,0.01233-0.10606-0.04902-0.25-0.125v-0.03125c-0.08842-0.04701-0.1823-0.12761-0.28125-0.1875-0.08526-0.06729-0.16309-0.13147-0.25-0.1875-0.03136-0.02022-0.06285-0.04214-0.09375-0.0625-0.05409-0.04196-0.10317-0.05303-0.15625-0.09375-0.0055-0.0042,0.0055-0.02709,0-0.03125,0.0041-0.01246,0.0028,0.0018,0.03125,0,0.39594,0.24883,0.65882,0.41634,0.8125,0.53125,0.02333,0.01634,0.03858,0.04575,0.0625,0.0625,0.06016,0.05119,0.13212,0.11815,0.125,0.125,0.35441,0.21033,0.69931,0.44833,1.0312,0.6875,0.09053,0.06523,0.19227,0.12031,0.28125,0.1875,0.0185,0.01296,0.01258,0.01817,0.03125,0.03125,0.0063,0.0091,0.0124,0.01806,0.03125,0.03125,0.7798,0.59601,1.5074,1.2518,2.1875,1.9688,0.0103,0.01086,0.02097,0.02036,0.03125,0.03125,0.01013,0.01073,0.02114,0.0205,0.03125,0.03125,0.03924,0.04753,0.05578,0.10884,0.09375,0.15625,0.16169,0.20137,0.3304,0.39819,0.46875,0.59375,0.17151,0.24243,0.33112,0.46943,0.46875,0.6875,0.01798-0.02295,0.04465-0.03949,0.0625-0.0625,0.17422-0.22459,0.34122-0.45249,0.5-0.6875,0.17752-0.25344,0.33823-0.51978,0.5-0.78125,0.17-0.25307,0.32415-0.50973,0.46875-0.78125,0.004-0.0074-0.0049-0.02406,0-0.03125,0.01626-0.02396,0.04939-0.03767,0.0625-0.0625,0.12795-0.24686,0.23327-0.49232,0.34375-0.75,0.0097-0.02108,0.02167-0.04137,0.03125-0.0625,0.01281-0.03034,0.01866-0.06329,0.03125-0.09375,0.01902-0.04276,0.04394-0.08211,0.0625-0.125,0.08095-0.1863,0.14662-0.37309,0.21875-0.5625,0.0081-0.02132,0.02321-0.04113,0.03125-0.0625,0.09484-0.26965,0.19831-0.53967,0.28125-0.8125,0.0059-0.01909-0.0058-0.04337,0-0.0625,0.11717-0.38293,0.22639-0.78772,0.3125-1.1875,0.0082-0.03152,0.02244-0.06197,0.03125-0.09375,0.0027-0.0097-0.0027-0.0215,0-0.03125,0.04062-0.14688,0.08918-0.29428,0.125-0.4375,0.01761-0.12425,0.02592-0.23193,0.03125-0.34375,0.000481-0.010089-0.000462-0.021093,0-0.03125,0.06145-0.41506,0.0973-0.81624,0.125-1.25,0.0021-0.032204-0.0019-0.06144,0-0.09375,0.000573-0.010079-0.000564-0.021146,0-0.03125,0.02358-0.42298,0.04089-0.87088,0.03125-1.3125-0.002-0.082882,0.0032-0.16644,0-0.25-0.033-0.2921-0.05-0.5475-0.06-0.813-0.018-0.5216-0.022-1.0483-0.187-1.5937-0.005-0.0313-0.026-0.0621-0.032-0.0938-0.031-0.1896-0.056-0.4009-0.093-0.5938-0.054-0.2792-0.122-0.5575-0.188-0.8437-0.0044-0.019058,0.0044-0.043395,0-0.0625-0.117-0.5029-0.251-1.0061-0.406-1.5312-0.05235-0.06573-0.12046-0.099317-0.1875-0.15625,0.0054-0.00816-0.01899-0.023545-0.0625-0.0625-0.06112-0.045989-0.11607-0.11652-0.1875-0.15625-0.01061-0.005861-0.02041-0.025524-0.03125-0.03125-0.03729-0.046355-0.08286-0.092677-0.125-0.125-0.07335,0.014704-0.16905,0.00047589-0.25,0-0.07924-0.027136-0.16322-0.070849-0.25-0.09375-0.03768-0.009288-0.0859-0.022859-0.125-0.03125-0.10508-0.022552-0.2286-0.015122-0.34375-0.03125-0.07494-0.005837-0.14155-0.023052-0.21875-0.03125-0.05258-0.005584-0.10167-0.027061-0.15625-0.03125-0.02832-0.002053-0.06494,0.001734-0.09375,0-0.282-0.06642-0.565-0.11312-0.813-0.09385zm-8.156,6.8438c-0.00012,0.11062-0.04058,0.1632-0.0625,0.21875,0.0075-0.054929-0.003-0.10974,0-0.125,0.02573-0.032989,0.02062-0.056927,0.0625-0.09375zm3.5,14.594,0,0.03125,0-0.03125zm-0.781,0.593,0.031,0.031-0.031-0.031zm-62.063,21.219,0.031,0.062-0.031-0.062zm-1.3125,1.7188,0,0.03125,0-0.03125zm27.688,4.5,0.03125,0-0.03125,0zm-6.75,6.2812,0,0.0625,0-0.0625zm-2.8438,2.3125-0.03125,0.03125,0.03125-0.03125zm-0.375,0.3125,0.03125,0.03125l-0.03-0.03zm-0.34375,0.09375,0,0.03125,0-0.03125zm0.0625,0.0625-0.03125,0.03125,0.03125-0.03125zm0.0625,0.09375,0,0.03125,0-0.03125zm-1.8125,1.125,0.03125,0-0.03125,0zm-0.156,0.126,0.031,0.031-0.031-0.031zm-0.5,0.15625,0,0.03125,0-0.03125zm-0.3125,0.125,0,0.03125,0-0.03125zm-0.719,0.594-0.031,0.031,0.031-0.031zm-0.15625,0.15625-0.03125,0.03125,0.03125-0.03125zm0.09375,0.0625,0,0.0625,0-0.0625zm-1.845,0.782v0.03125-0.03125zm-0.1875,0.03125,0,0.03125,0-0.03125zm0,0.09375,0,0.03125,0-0.03125zm-0.71875,0.15625,0.03125,0-0.03125,0zm-0.655,0.25-0.031,0.031,0.031-0.031z transform=matrix(6.585951,0,0,6.5859805,41.701735,38.216535) /> </g> </g> </svg> </a> <a href=http://www.apache.org/licenses/ target=_blank rel=noopener title=www.apache.org class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 10a3.04 3.04 0 013-3 3.04 3.04 0 013 3 3.04 3.04 0 01-3 3 3.04 3.04 0 01-3-3m3 9l4 1v-3.08A7.54 7.54 0 0112 18a7.54 7.54 0 01-4-1.08V20m4-16a5.78 5.78 0 00-4.24 1.74A5.78 5.78 0 006 10a5.78 5.78 0 001.76 4.23A5.78 5.78 0 0012 16a5.78 5.78 0 004.24-1.77A5.78 5.78 0 0018 10a5.78 5.78 0 00-1.76-4.26A5.78 5.78 0 0012 4m8 6a8.04 8.04 0 01-.57 2.8A7.84 7.84 0 0118 15.28V23l-6-2-6 2v-7.72A7.9 7.9 0 014 10a7.68 7.68 0 012.33-5.64A7.73 7.73 0 0112 2a7.73 7.73 0 015.67 2.36A7.68 7.68 0 0120 10z"/></svg> </a> <a href=http://www.apache.org/events/current-event target=_blank rel=noopener title=www.apache.org class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M99 414.3c1.1 5.7-2.3 11.1-8 12.3-5.4 1.1-10.9-2.3-12-8-1.1-5.4 2.3-11.1 7.7-12.3 5.4-1.2 11.1 2.3 12.3 8zm143.1 71.4c-6.3 4.6-8 13.4-3.7 20 4.6 6.6 13.4 8.3 20 3.7 6.3-4.6 8-13.4 3.4-20-4.2-6.5-13.1-8.3-19.7-3.7zm-86-462.3c6.3-1.4 10.3-7.7 8.9-14-1.1-6.6-7.4-10.6-13.7-9.1-6.3 1.4-10.3 7.7-9.1 14 1.4 6.6 7.6 10.6 13.9 9.1zM34.4 226.3c-10-6.9-23.7-4.3-30.6 6-6.9 10-4.3 24 5.7 30.9 10 7.1 23.7 4.6 30.6-5.7 6.9-10.4 4.3-24.1-5.7-31.2zm272-170.9c10.6-6.3 13.7-20 7.7-30.3-6.3-10.6-19.7-14-30-7.7s-13.7 20-7.4 30.6c6 10.3 19.4 13.7 29.7 7.4zm-191.1 58c7.7-5.4 9.4-16 4.3-23.7s-15.7-9.4-23.1-4.3c-7.7 5.4-9.4 16-4.3 23.7 5.1 7.8 15.6 9.5 23.1 4.3zm372.3 156c-7.4 1.7-12.3 9.1-10.6 16.9 1.4 7.4 8.9 12.3 16.3 10.6 7.4-1.4 12.3-8.9 10.6-16.6-1.5-7.4-8.9-12.3-16.3-10.9zm39.7-56.8c-1.1-5.7-6.6-9.1-12-8-5.7 1.1-9.1 6.9-8 12.6 1.1 5.4 6.6 9.1 12.3 8 5.4-1.5 9.1-6.9 7.7-12.6zM447 138.9c-8.6 6-10.6 17.7-4.9 26.3 5.7 8.6 17.4 10.6 26 4.9 8.3-6 10.3-17.7 4.6-26.3-5.7-8.7-17.4-10.9-25.7-4.9zm-6.3 139.4c26.3 43.1 15.1 100-26.3 129.1-17.4 12.3-37.1 17.7-56.9 17.1-12 47.1-69.4 64.6-105.1 32.6-1.1.9-2.6 1.7-3.7 2.9-39.1 27.1-92.3 17.4-119.4-22.3-9.7-14.3-14.6-30.6-15.1-46.9-65.4-10.9-90-94-41.1-139.7-28.3-46.9.6-107.4 53.4-114.9C151.6 70 234.1 38.6 290.1 82c67.4-22.3 136.3 29.4 130.9 101.1 41.1 12.6 52.8 66.9 19.7 95.2zm-70 74.3c-3.1-20.6-40.9-4.6-43.1-27.1-3.1-32 43.7-101.1 40-128-3.4-24-19.4-29.1-33.4-29.4-13.4-.3-16.9 2-21.4 4.6-2.9 1.7-6.6 4.9-11.7-.3-6.3-6-11.1-11.7-19.4-12.9-12.3-2-17.7 2-26.6 9.7-3.4 2.9-12 12.9-20 9.1-3.4-1.7-15.4-7.7-24-11.4-16.3-7.1-40 4.6-48.6 20-12.9 22.9-38 113.1-41.7 125.1-8.6 26.6 10.9 48.6 36.9 47.1 11.1-.6 18.3-4.6 25.4-17.4 4-7.4 41.7-107.7 44.6-112.6 2-3.4 8.9-8 14.6-5.1 5.7 3.1 6.9 9.4 6 15.1-1.1 9.7-28 70.9-28.9 77.7-3.4 22.9 26.9 26.6 38.6 4 3.7-7.1 45.7-92.6 49.4-98.3 4.3-6.3 7.4-8.3 11.7-8 3.1 0 8.3.9 7.1 10.9-1.4 9.4-35.1 72.3-38.9 87.7-4.6 20.6 6.6 41.4 24.9 50.6 11.4 5.7 62.5 15.7 58.5-11.1zm5.7 92.3c-10.3 7.4-12.9 22-5.7 32.6 7.1 10.6 21.4 13.1 32 6 10.6-7.4 13.1-22 6-32.6-7.4-10.6-21.7-13.5-32.3-6z"/></svg> </a> <a href=http://www.apache.org/foundation/sponsorship.html target=_blank rel=noopener title=www.apache.org class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6h-5.6z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/vendor.c3dc8c49.min.js></script> <script src=../../../../assets/javascripts/bundle.30071cf1.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../../../..",
          features: ["tabs", "search.highlight"],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>